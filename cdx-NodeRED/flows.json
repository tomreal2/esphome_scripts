[{"id":"2df3f8ea.1119b8","type":"tab","label":"Bathroom","disabled":false,"info":""},{"id":"2fd92f64.30df","type":"tab","label":"T_orig","disabled":true,"info":""},{"id":"e37f810b.f6ef","type":"tab","label":"test","disabled":true,"info":""},{"id":"d227654b.140b28","type":"tab","label":"Basement","disabled":false,"info":""},{"id":"9ee37116.944ec","type":"tab","label":"Bedroom","disabled":false,"info":""},{"id":"2891302c.19a1a","type":"tab","label":"Kitchen","disabled":false,"info":""},{"id":"35ed8594.bdcc4a","type":"tab","label":"Main Lights","disabled":false,"info":""},{"id":"2f358258.bc557e","type":"tab","label":"Living Room","disabled":false,"info":""},{"id":"bc0658fa.ce5778","type":"tab","label":"Piano Room","disabled":false,"info":""},{"id":"10165488.1423ab","type":"tab","label":"Outside","disabled":false,"info":""},{"id":"1256e471.1f69ac","type":"tab","label":"lights_bu","disabled":true,"info":""},{"id":"8255b3dd.d909c","type":"tab","label":"Screened Porch","disabled":false,"info":""},{"id":"2590f302.3da8ec","type":"tab","label":"Hallway","disabled":false,"info":""},{"id":"1e9cfcb8.4e3eb3","type":"tab","label":"Carport Driveway","disabled":false,"info":""},{"id":"8fbf17f7.e65578","type":"tab","label":"Time For Bed","disabled":false,"info":""},{"id":"a919d62a.d9be68","type":"tab","label":"Porch Power","disabled":false,"info":""},{"id":"8b5b6604.df33d8","type":"tab","label":"CL_orig","disabled":true,"info":""},{"id":"976e63d3.368c7","type":"tab","label":"CL_old","disabled":true,"info":""},{"id":"9803957e.5640c8","type":"tab","label":"Mobile 01","disabled":true,"info":""},{"id":"2b42380c.d8fd88","type":"tab","label":"T","disabled":true,"info":""},{"id":"f683349.a4593c8","type":"tab","label":"CAB","disabled":false,"info":""},{"id":"9dc989c8.dff548","type":"tab","label":"CL","disabled":true,"info":""},{"id":"b3d83d0c.2d5d5","type":"tab","label":"Blue Water","disabled":false,"info":""},{"id":"da19a66b.e91c28","type":"tab","label":"BVeggies Dry","disabled":true,"info":""},{"id":"d3389b9b.5c1778","type":"tab","label":"CBox05_BBs","disabled":true,"info":""},{"id":"14c0a537.74f21b","type":"tab","label":"CBox04_BBiLarf","disabled":true,"info":""},{"id":"5f54b4ae.ff559c","type":"tab","label":"mobile 6 heater","disabled":true,"info":""},{"id":"ee47c129.d0da4","type":"tab","label":"null humidity notifications","disabled":true,"info":""},{"id":"1299179d.0f43a8","type":"tab","label":"Alerts","disabled":false,"info":""},{"id":"b2a56d88.4d695","type":"tab","label":"BT","disabled":false,"info":""},{"id":"be4e15f2722bc10d","type":"tab","label":"CL Fan, T Heater","disabled":false,"info":"","env":[]},{"id":"07af2ec6799331c0","type":"tab","label":"LED Strip","disabled":false,"info":"","env":[]},{"id":"8f28e16ad32e533f","type":"tab","label":"Irrigation Valves","disabled":false,"info":"","env":[]},{"id":"67dec13f44640a5d","type":"tab","label":"Compost","disabled":false,"info":"","env":[]},{"id":"c28a0ad8463b1d59","type":"tab","label":"Basement Finished Veg","disabled":false,"info":"","env":[]},{"id":"63a3316a.c01fc","type":"subflow","name":"main level lights on","info":"","category":"","in":[{"x":40,"y":40,"wires":[{"id":"ed004c09.aedc5"},{"id":"e36bcb0a.837198"},{"id":"6ef0ac15.dd6e94"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"ef05d161.c6c31","type":"subflow","name":"main level lights off","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"cc4b5984.1d4d48"},{"id":"e7928b4.b54ac78"},{"id":"afb2c474.808798"},{"id":"c0abdf61.9c7b"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"6bd38239.2d4d5c","type":"subflow","name":"outdoor lights on","info":"","category":"","in":[{"x":40,"y":40,"wires":[{"id":"2f340e2c.742912"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"56970ff1.d6c68","type":"subflow","name":"outdoor lights off","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"3d5b06b.bd26efa"},{"id":"a9018a3.9dc9b78"},{"id":"b70d8fcb.61226"},{"id":"1d8b6c97.e63543"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"1ad74878.0046e8","type":"subflow","name":"main level inside brightness and color","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"b9b8e137.edc9d"},{"id":"8ed54ae9.264ee8"},{"id":"4757ef9f.0449f"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"6be10a17.1cf904","type":"subflow","name":"outside brightness and color","info":"","category":"","in":[{"x":20,"y":40,"wires":[{"id":"4e2ed8d8.36c768"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"1c8540c6.ab083f","type":"subflow","name":"if CL is on","info":"","category":"","in":[{"x":40,"y":60,"wires":[{"id":"bccd64ed.25c448"}]}],"out":[{"x":400,"y":40,"wires":[{"id":"bccd64ed.25c448","port":0}]},{"x":400,"y":120,"wires":[{"id":"bccd64ed.25c448","port":1}]}],"env":[],"color":"#DDAA99"},{"id":"1720b27f.e66bee","type":"subflow","name":"test 1","info":"","category":"","in":[{"x":50,"y":30,"wires":[]}],"out":[{"x":300,"y":20,"wires":[]}],"env":[],"color":"#DDAA99"},{"id":"5b1d81d3.fab27","type":"subflow","name":"Subflow 1","info":"","in":[{"x":60,"y":80,"wires":[{"id":"c05df622.4bfdd8"}]}],"out":[{"x":340,"y":80,"wires":[{"id":"c05df622.4bfdd8","port":0}]}]},{"id":"71a3fd81.9edc14","type":"subflow","name":"notify_toms_phone","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"b5ce09eb.10fb48"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"f2f2edc5.b030a","type":"subflow","name":"allow once in 24 hrs","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"3f6bd01.737e23"}]}],"out":[{"x":700,"y":40,"wires":[{"id":"16a79cd8.916a23","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"d3e83ea9.c31f8","type":"subflow","name":"allow once an hour","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"386d5508.6c4eba"}]}],"out":[{"x":700,"y":40,"wires":[{"id":"40657515.2256ec","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"7a95d62b.bca3b8","type":"subflow","name":"blue_lights_minute_check","info":"","category":"","in":[],"out":[],"env":[],"color":"#DDAA99"},{"id":"90dcf55e.a8a7c8","type":"subflow","name":"blue_wk_on","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"b4070a2d.459368"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"23f32820.744c18","type":"subflow","name":"blue_wk_off","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"3c0a1c54.f52a44"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"aecfccc8.83c99","type":"subflow","name":"blue_fan_cool_dehumidify","info":"","category":"","in":[{"x":40,"y":40,"wires":[{"id":"2163394a.537206"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"2971f5bb.c171da","type":"subflow","name":"blue","info":"","category":"","in":[{"x":40,"y":39,"wires":[{"id":"1f8c7be9.cef724"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"14591eab.617051","type":"subflow","name":"blue_update_lights","info":"","category":"","in":[{"x":40,"y":40,"wires":[{"id":"bb6a1411.5c9298"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"81129f40.2fca5","type":"subflow","name":"tom inside geofence","info":"","category":"","in":[{"x":42,"y":54,"wires":[{"id":"690cfda7.5f42d4"}]}],"out":[{"x":1072,"y":30,"wires":[{"id":"948dd197.7cdfb","port":0}]},{"x":1073,"y":80,"wires":[{"id":"63c2e324.fb57fc","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"923298e.d488e68","type":"subflow","name":"blue_hum_60-64","info":"","category":"","in":[{"x":31,"y":324,"wires":[{"id":"473de53d.cb806c"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"434b5120.15655","type":"subflow","name":"Run Motor","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"fe60c871.2a5248"}]}],"out":[{"x":820,"y":660,"wires":[{"id":"81aaa9bd.33d9c8","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"4ebd89af.8412c8","type":"subflow","name":"Blue Water 3","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"3a6b34e9.4ca7fc"}]}],"out":[{"x":800,"y":600,"wires":[{"id":"8930e60d.eba9f8","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"b51b88cb.e159d8","type":"subflow","name":"CCork 3perDay  (bring to 65 RH)","info":"","category":"","in":[{"x":40,"y":40,"wires":[{"id":"bd60097.f0df7f8"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"6c886e85.15e09","type":"subflow","name":"mobile heater","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"941c8bbb.fa0038"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"8d8ea42f.7508f8","type":"subflow","name":"CCork 1perWeek (1st Month)","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"40c815c7.2ce2cc"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"660afba2.b674a4","type":"subflow","name":"CCork 1perMonth (after 1st Month)","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"39bcda35.4e81c6"}]}],"out":[],"env":[],"color":"#DDAA99"},{"id":"4433b13830f60388","type":"subflow","name":"allow once in 5 sec","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"0f10655824506436"}]}],"out":[{"x":720,"y":60,"wires":[{"id":"82317b4abc1e9d45","port":0}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"17a9545b4d27ba64","type":"subflow","name":"Subflow 2","info":"","in":[{"x":60,"y":60,"wires":[{"id":"353af35d51481cfe"}]}],"out":[{"x":720,"y":120,"wires":[{"id":"720765959dd0f51a","port":0}]}]},{"id":"dd868e2fe1910714","type":"subflow","name":"allow once every 4 hours","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"f6ce9014b91e3fa9"}]}],"out":[{"x":740,"y":40,"wires":[{"id":"b002673780321e7c","port":0}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"1b7e4fe1.0da8e","type":"server","name":"Home Assistant","addon":true},{"id":"8a9210a1.55dd9","type":"ui_tab","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"e5843571.d374f8","type":"node-hue-bridge","name":"Hue Bridge","address":"192.168.1.26","key":"3qfsg-IZsVA3on9lkygdaIseheJ1zv16f4dIku8q","interval":"10000"},{"id":"6a2fe77d.18a6c8","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"69543e7577c6ab2b","type":"alexa-home-conf","username":"tomreal"},{"id":"3df35c62.6d31e4","type":"api-call-service","z":"63a3316a.c01fc","name":"turn p ceiling on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.p_ceiling_piano_level","light.p_ceiling_back_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":240,"y":340,"wires":[[]]},{"id":"e36bcb0a.837198","type":"function","z":"63a3316a.c01fc","name":"dim 35%","func":"msg.payload = {\"data\":{\"brightness\": 35 * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":300,"wires":[["3df35c62.6d31e4","89b9a83a.7d5788"]]},{"id":"873d7ab3.c3c7d8","type":"api-call-service","z":"63a3316a.c01fc","name":"turn kitchen/hallway on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.kitchen_light_level","light.kitchen_hallway_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":270,"y":480,"wires":[[]]},{"id":"6ef0ac15.dd6e94","type":"function","z":"63a3316a.c01fc","name":"dim 80%","func":"msg.payload = {\"data\":{\"brightness\": 80 * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":440,"wires":[["873d7ab3.c3c7d8"]]},{"id":"ed004c09.aedc5","type":"function","z":"63a3316a.c01fc","name":"turn on hue","func":"msg.payload = {\"on\":true, \"kelvin\":2700, \"brightness\": 100}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":210,"y":40,"wires":[["25be74c0.381e7c","a4e1f34f.97c98"]]},{"id":"52d89280.65291c","type":"node-hue-in","z":"63a3316a.c01fc","server":"e5843571.d374f8","lightID":"light9","name":"lr couch","x":240,"y":180,"wires":[]},{"id":"f52fe07e.bca6d","type":"node-hue-in","z":"63a3316a.c01fc","server":"e5843571.d374f8","lightID":"light8","name":"lr strip","x":230,"y":220,"wires":[]},{"id":"25be74c0.381e7c","type":"function","z":"63a3316a.c01fc","name":"turn on hue rgb","func":"if (typeof msg.payload === \"boolean\")\n    msg.payload = {\"on\":true};\n\n/*\nif (!msg.payload.kelvin)\n    return msg;\n    \nif (msg.payload.kelvin !== 2700)\n    return msg;\n    \ndelete msg.payload.kelvin;\n*/\n\nmsg.payload[\"red\"] = 255;\nmsg.payload[\"blue\"] = 206;\nmsg.payload[\"green\"] = 228;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":220,"y":140,"wires":[["52d89280.65291c","f52fe07e.bca6d"]]},{"id":"89b9a83a.7d5788","type":"api-call-service","z":"63a3316a.c01fc","name":"upper steps on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.upper_steps_lights_level"],"data":"{\"brightness\":100}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":240,"y":380,"wires":[[]]},{"id":"a4e1f34f.97c98","type":"node-hue-in","z":"63a3316a.c01fc","server":"e5843571.d374f8","lightID":"group3","name":"inside","x":230,"y":80,"wires":[]},{"id":"cc4b5984.1d4d48","type":"function","z":"ef05d161.c6c31","name":"turn off hue","func":"msg.payload = {\"on\":false}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":80,"wires":[["9bd3bb23.e73d28","2ee43106.f2309e","212f001c.4f9eb"]]},{"id":"9bd3bb23.e73d28","type":"node-hue-in","z":"ef05d161.c6c31","server":"e5843571.d374f8","lightID":"group3","name":"inside hue","x":270,"y":120,"wires":[]},{"id":"e7928b4.b54ac78","type":"api-call-service","z":"ef05d161.c6c31","name":"turn p ceiling off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.p_ceiling_piano_level","light.p_ceiling_back_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":240,"y":180,"wires":[[]]},{"id":"afb2c474.808798","type":"api-call-service","z":"ef05d161.c6c31","name":"turn kitchen/hallway off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.kitchen_hallway_level","light.kitchen_light_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":270,"y":220,"wires":[[]]},{"id":"c0abdf61.9c7b","type":"api-call-service","z":"ef05d161.c6c31","name":"upper steps off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.upper_steps_lights_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":240,"y":260,"wires":[[]]},{"id":"212f001c.4f9eb","type":"node-hue-in","z":"ef05d161.c6c31","server":"e5843571.d374f8","lightID":"light8","name":"lr strip","x":450,"y":120,"wires":[]},{"id":"2ee43106.f2309e","type":"node-hue-in","z":"ef05d161.c6c31","server":"e5843571.d374f8","lightID":"light9","name":"lr couch","x":460,"y":80,"wires":[]},{"id":"2f340e2c.742912","type":"function","z":"6bd38239.2d4d5c","name":"turn on hue","func":"msg.payload = {\"on\":true, \"brightness\": 100, \"kelvin\":2400}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":170,"y":100,"wires":[["bb05741a.241c28"]]},{"id":"8514cb84.61b708","type":"node-hue-in","z":"6bd38239.2d4d5c","server":"e5843571.d374f8","lightID":"group1","name":"outside hue","x":610,"y":200,"wires":[]},{"id":"c8f9a4c5.e96f08","type":"api-call-service","z":"6bd38239.2d4d5c","name":"turn upper and back deck on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.upper_deck_lights_level","light.back_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":660,"y":60,"wires":[[]]},{"id":"430e0c1e.837d24","type":"api-call-service","z":"6bd38239.2d4d5c","name":"turn driveways on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.driveway_lighting_switch","switch.driveway_side_door_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":630,"y":100,"wires":[[]]},{"id":"5a4d51a4.1b2bd","type":"function","z":"6bd38239.2d4d5c","name":"turn off outdoor light","func":"msg.payload[\"on\"]=false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":260,"wires":[["8514cb84.61b708"]]},{"id":"312a4051.a0f87","type":"function","z":"6bd38239.2d4d5c","name":"use 255 scale","func":"if (msg.payload.brightness)\n    msg.payload.brightness = (msg.payload.brightness * 2.55);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":80,"wires":[["c8f9a4c5.e96f08","430e0c1e.837d24"]]},{"id":"231f1291.cd4e9e","type":"api-call-service","z":"6bd38239.2d4d5c","name":"turn upper, screened, and back deck off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.upper_deck_lights_level","light.back_porch_level","light.screened_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":560,"y":300,"wires":[[]]},{"id":"866f6fe6.fe68a","type":"api-call-service","z":"6bd38239.2d4d5c","name":"turn driveways off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.driveway_lighting_switch","switch.driveway_side_door_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":490,"y":340,"wires":[[]]},{"id":"bb05741a.241c28","type":"time-range-switch","z":"6bd38239.2d4d5c","name":"if sunset started or night","lat":"38.810770","lon":"-77.155803","startTime":"sunsetStart","endTime":"sunrise","startOffset":0,"endOffset":0,"x":230,"y":140,"wires":[["8514cb84.61b708","312a4051.a0f87","2e0bc2eb.f9d77e"],["5a4d51a4.1b2bd","231f1291.cd4e9e","866f6fe6.fe68a","5811761d.4b24e8"]]},{"id":"2e0bc2eb.f9d77e","type":"api-call-service","z":"6bd38239.2d4d5c","name":"landscape lights on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.landscape_lights_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":630,"y":140,"wires":[[]]},{"id":"5811761d.4b24e8","type":"api-call-service","z":"6bd38239.2d4d5c","name":"landscape lights off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.landscape_lights_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":490,"y":380,"wires":[[]]},{"id":"3d5b06b.bd26efa","type":"function","z":"56970ff1.d6c68","name":"turn off hue","func":"msg.payload = {\"on\":false}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":100,"wires":[["5811a9d1.60d688"]]},{"id":"5811a9d1.60d688","type":"node-hue-in","z":"56970ff1.d6c68","server":"e5843571.d374f8","lightID":"group1","name":"outside hue","x":270,"y":140,"wires":[]},{"id":"a9018a3.9dc9b78","type":"api-call-service","z":"56970ff1.d6c68","name":"turn upper, screened, and back deck off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.upper_deck_lights_level","light.back_porch_level","light.screened_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":320,"y":240,"wires":[[]]},{"id":"b70d8fcb.61226","type":"api-call-service","z":"56970ff1.d6c68","name":"turn driveways off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.driveway_lighting_switch","switch.driveway_side_door_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":250,"y":300,"wires":[[]]},{"id":"1d8b6c97.e63543","type":"api-call-service","z":"56970ff1.d6c68","name":"landscape lights off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.landscape_lights_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":250,"y":40,"wires":[[]]},{"id":"bf2523f2.e1aaf","type":"api-call-service","z":"1ad74878.0046e8","name":"turn p ceiling on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.p_ceiling_piano_level","light.p_ceiling_back_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":240,"y":220,"wires":[[]]},{"id":"9d4e128a.2c94c","type":"api-call-service","z":"1ad74878.0046e8","name":"turn kitchen/hallway on/upper steps","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.kitchen_light_level","light.kitchen_hallway_level","light.upper_steps_lights_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":630,"y":20,"wires":[[]]},{"id":"b9b8e137.edc9d","type":"function","z":"1ad74878.0046e8","name":"change brightness non-hue","func":"//FOR NON DIMMABLE OUTDOOR LIGHTS\n//IF COLOR - TURN ON, OTHERWISE, TURN OFF\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\") {\n    //NUMBER IS BRIGHTNESS\n    msg.payload = 1;\n} else if (payloadType === \"object\") {\n    //OBJECT - GET BRIGHTNESS FROM PROP\n    if (msg.payload.hue || msg.payload.red || msg.payload.green || msg.payload.blue) {\n        //COLOR CHANGE - TURN NON-COLOR LIGHTS OFF\n        msg.payload = 0;\n    } else if (msg.payload.brightness) {\n        msg.payload = 1;\n    } else {\n        msg.payload = 0;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":80,"wires":[["c136270a.c0cda8"]]},{"id":"b5167724.0c1718","type":"api-call-service","z":"1ad74878.0046e8","name":"turn upper, screened, and back deck on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.upper_deck_lights_level","light.back_porch_level","light.screened_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":320,"y":300,"wires":[[]]},{"id":"8ed54ae9.264ee8","type":"function","z":"1ad74878.0046e8","name":"set brightness on hue","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\")\n\tmsg.payload = {\"brightness\": msg.payload};\n//IF COLOR - CHANGE BRIGHTNESS TO 100%\nif (msg.payload.hasOwnProperty(\"hue\") || !msg.payload.brightness)\n    msg.payload[\"brightness\"] = 100;\n\n//if (!msg.payload.hasOwnProperty(\"hue\"))\n//    msg.payload[\"kelvin\"] = 2400;\n    \nmsg.payload[\"on\"]=true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":480,"wires":[["f485b1ad.b4f03","51fd4f54.d6155"]]},{"id":"52221556.d0c7bc","type":"node-hue-in","z":"1ad74878.0046e8","server":"e5843571.d374f8","lightID":"light9","name":"lr couch","x":520,"y":520,"wires":[]},{"id":"f485b1ad.b4f03","type":"function","z":"1ad74878.0046e8","name":"turn on hue rgb","func":"if (!msg.payload.kelvin)\n    return msg;\n    \nif (msg.payload.kelvin !== 2700)\n    return msg;\n    \ndelete msg.payload.kelvin;\n\nmsg.payload[\"red\"] = 255;\nmsg.payload[\"blue\"] = 206;\nmsg.payload[\"green\"] = 228;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":500,"y":480,"wires":[["52221556.d0c7bc","916bf48c.f22ea8"]]},{"id":"916bf48c.f22ea8","type":"node-hue-in","z":"1ad74878.0046e8","server":"e5843571.d374f8","lightID":"light8","name":"lr strip","x":510,"y":560,"wires":[]},{"id":"51fd4f54.d6155","type":"node-hue-in","z":"1ad74878.0046e8","server":"e5843571.d374f8","lightID":"group3","name":"inside","x":230,"y":520,"wires":[]},{"id":"c136270a.c0cda8","type":"switch","z":"1ad74878.0046e8","name":"if brightness > 0","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":240,"y":140,"wires":[["bf2523f2.e1aaf","b5167724.0c1718"],["6c1cfe9c.1ae67","b3b51132.04b71","72b8815a.af499"]]},{"id":"6c1cfe9c.1ae67","type":"api-call-service","z":"1ad74878.0046e8","name":"turn p ceiling off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.p_ceiling_piano_level","light.p_ceiling_back_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":600,"y":220,"wires":[[]]},{"id":"b3b51132.04b71","type":"api-call-service","z":"1ad74878.0046e8","name":"turn kitchen/hallway off/upper steps","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.kitchen_light_level","light.kitchen_hallway_level","light.upper_steps_lights_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":670,"y":260,"wires":[[]]},{"id":"72b8815a.af499","type":"api-call-service","z":"1ad74878.0046e8","name":"turn upper, screened, and back deck off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.upper_deck_lights_level","light.back_porch_level","light.screened_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":680,"y":300,"wires":[[]]},{"id":"4757ef9f.0449f","type":"function","z":"1ad74878.0046e8","name":"change for non-hue dimmer","func":"//if (msg.payload.brightness)\n//    msg.payload = {\"brightness\":msg.payload.brightness};\n    \n//FOR NON DIMMABLE OUTDOOR LIGHTS\n//IF COLOR - TURN ON, OTHERWISE, TURN OFF\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\") {\n    //NUMBER IS BRIGHTNESS\n    msg.payload = {\"data\":{\"brightness\":(msg.payload * 2.55)}};\n    //msg.payload = 1;\n} else if (payloadType === \"object\") {\n    //OBJECT - GET BRIGHTNESS FROM PROP\n    //if (msg.payload.brightness)\n    //    msg.payload = {\"data\":{\"brightness\":msg.payload.brightness}};\n    \n    if (msg.payload.hue || msg.payload.red || msg.payload.green || msg.payload.blue) {\n        //COLOR CHANGE - TURN NON-COLOR LIGHTS OFF\n        msg.payload = 0;\n    } else if (msg.payload.brightness) {\n        msg.payload = {\"data\":{\"brightness\":(msg.payload.brightness * 2.55)}};\n    } else {\n        msg.payload = 0;\n    }\n    \n}\n   \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":20,"wires":[["9d4e128a.2c94c"]]},{"id":"2cbde47a.bddb8c","type":"node-hue-in","z":"6be10a17.1cf904","server":"e5843571.d374f8","lightID":"group1","name":"outside hue","x":550,"y":380,"wires":[]},{"id":"aa5455bf.cbd8d8","type":"function","z":"6be10a17.1cf904","name":"turn off outdoor light","func":"msg.payload[\"on\"]=false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":460,"wires":[["2cbde47a.bddb8c"]]},{"id":"b8da751f.b92388","type":"time-range-switch","z":"6be10a17.1cf904","name":"if sunset started or night","lat":"38.810770","lon":"-77.155803","startTime":"sunsetStart","endTime":"sunrise","startOffset":"-95","endOffset":0,"x":190,"y":420,"wires":[["2cbde47a.bddb8c","99c4e890.170628","3548438c.8c5a5c","6f8729f4.1016e8"],["aa5455bf.cbd8d8","f019a8ed.3b1b68","3c5e1993.3cb8b6","81b335f4.8d2ab8"]]},{"id":"4e2ed8d8.36c768","type":"function","z":"6be10a17.1cf904","name":"set brightness on hue","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\")\n\tmsg.payload = {\"brightness\": msg.payload};\n//IF COLOR - CHANGE BRIGHTNESS TO 100%\nif (msg.payload.hasOwnProperty(\"hue\") || !msg.payload.brightness)\n    msg.payload[\"brightness\"] = 100;\n\nmsg.payload[\"on\"]=true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":180,"y":100,"wires":[["b8da751f.b92388"]]},{"id":"1b219a69.6c4a76","type":"api-call-service","z":"6be10a17.1cf904","name":"outside switch on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.driveway_side_door_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":610,"y":266,"wires":[[]]},{"id":"45d56615.6f6828","type":"api-call-service","z":"6be10a17.1cf904","name":"oustide dimmable non-hue on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.upper_deck_lights_level","light.back_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":650,"y":120,"wires":[[]]},{"id":"99c4e890.170628","type":"function","z":"6be10a17.1cf904","name":"set brightness on non-hue (255 scale)","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\")\n\tmsg.payload = {\"brightness\": msg.payload};\n\n\nif (msg.payload.hasOwnProperty(\"hue\") || !msg.payload.brightness)\n    msg.payload[\"brightness\"] = 100;\n\nif (msg.payload.brightness)\n    msg.payload = {brightness: (msg.payload.brightness * 2.55)};\n    \nmsg.payload[\"on\"]=true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":80,"wires":[["45d56615.6f6828"]]},{"id":"3c5e1993.3cb8b6","type":"api-call-service","z":"6be10a17.1cf904","name":"outside switch off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.driveway_side_door_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":570,"y":540,"wires":[[]]},{"id":"f019a8ed.3b1b68","type":"api-call-service","z":"6be10a17.1cf904","name":"oustide dimmable non-hue off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.upper_deck_lights_level","light.back_porch_level","light.screened_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":610,"y":500,"wires":[[]]},{"id":"3548438c.8c5a5c","type":"api-call-service","z":"6be10a17.1cf904","name":"landscape lights on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.landscape_lights_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":570,"y":40,"wires":[[]]},{"id":"81b335f4.8d2ab8","type":"api-call-service","z":"6be10a17.1cf904","name":"landscape lights off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.landscape_lights_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":570,"y":580,"wires":[[]]},{"id":"6f8729f4.1016e8","type":"function","z":"6be10a17.1cf904","name":"on=1, off=0","func":"//FOR NON DIMMABLE OUTDOOR LIGHTS\n//IF COLOR - TURN ON, OTHERWISE, TURN OFF\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\") {\n    //NUMBER IS BRIGHTNESS\n    msg.payload = 1;\n} else if (payloadType === \"object\") {\n    //OBJECT - GET BRIGHTNESS FROM PROP\n    if (msg.payload.hue || msg.payload.red || msg.payload.green || msg.payload.blue) {\n        //COLOR CHANGE - TURN NON-COLOR LIGHTS OFF\n        msg.payload = 0;\n    } else if (msg.payload.brightness) {\n        msg.payload = 1;\n    } else {\n        msg.payload = 0;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":550,"y":160,"wires":[["2227eb93.320c34"]]},{"id":"2227eb93.320c34","type":"switch","z":"6be10a17.1cf904","name":"on (1)=top, else=bottom","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":610,"y":220,"wires":[["1b219a69.6c4a76"],["1c16e2a4.4ff54d"]]},{"id":"1c16e2a4.4ff54d","type":"api-call-service","z":"6be10a17.1cf904","name":"outside switch off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.driveway_side_door_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":610,"y":306,"wires":[[]]},{"id":"c00f8da1.5bf72","type":"inject","z":"6be10a17.1cf904","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"on\":true,\"brightness\":80,\"kelvin\":2700}","payloadType":"json","x":140,"y":40,"wires":[["4e2ed8d8.36c768"]]},{"id":"bccd64ed.25c448","type":"function","z":"1c8540c6.ab083f","name":"","func":"let onHour  = 11;\nlet offHour = 23;\n\nlet d = new Date();\nlet curHour = d.getHours();\n\nif (curHour >= onHour && curHour < offHour)\n    return [msg,null];\nelse\n    return [null,msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":200,"y":60,"wires":[[],[]]},{"id":"c05df622.4bfdd8","type":"function","z":"5b1d81d3.fab27","name":"","func":"var tester = flow.get(\"tester\");\nvar t = tester.t;\nvar tfunc = ()=>t; //JSON.parse(t);\nmsg.payload = tfunc();\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":80,"wires":[[]]},{"id":"477f22e1.99bedc","type":"api-call-service","z":"71a3fd81.9edc14","name":"","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_thomass_iphone","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":482,"y":30,"wires":[[]]},{"id":"b5ce09eb.10fb48","type":"function","z":"71a3fd81.9edc14","name":"","func":"const getPayload = (title, message) => {\n\tlet sound = \"default\";\n\tlet apnsCollapseId = title + \"_a343543\";\n\treturn {\n\t\t\"data\": {\n\t\t\t\"title\": `${title}`,\n\t\t\t\"message\": `${message}`,\n\t\t\t\"data\": {\n\t\t\t\t\"push\": {\n\t\t\t\t\t\"sound\": `${sound}`\n\t\t\t\t},\n\t\t\t\t\"apns_headers\": {\n\t\t\t\t\t\"apns-collapse-id\": `${apnsCollapseId}`\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n\n\nlet payloadType = (typeof msg.payload);\n\nif (payloadType === \"string\" || payloadType === \"number\") {\n    msg.payload = getPayload(\"\", `${msg.payload}`);\n    return msg;\n}\n\nif (payloadType === \"object\") {\n    if (msg.payload.hasOwnProperty(\"message\")) {\n        let title = msg.payload.hasOwnProperty(\"title\") ?  msg.payload.title : \"\";\n        msg.payload = getPayload(title, msg.payload.message);\n        return msg;\n    } else if (msg.payload.hasOwnProperty(\"data\")) {\n\t\tif (msg.payload.data.hasOwnProperty(\"message\")) return msg;\n\t}\n}\n\nmsg.payload = getPayload(\"\", \"bad message requested\");\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":180,"y":30,"wires":[["477f22e1.99bedc"]]},{"id":"5e58bc1.1fc3f44","type":"function","z":"f2f2edc5.b030a","name":"","func":"const getCurEpoch = () => {\n\tlet now = new Date()  \n\tlet secondsSinceEpoch = Math.round(now.getTime() / 1000);\n\tlet minsSinceEpoch = Math.floor(secondsSinceEpoch/60);\n\tlet hoursSinceEpoch = Math.floor(minsSinceEpoch/60);\n\treturn hoursSinceEpoch;\n\t\n\t//test with minutes\n\t//return minsSinceEpoch; \n}\nconst set24hourIgnore = () => {\n\tlet hoursSinceEpoch = getCurEpoch();\n\tflow.set(\"ignoreUntil\", (hoursSinceEpoch + 24));\n\t\n\t//test\n\t//flow.set(\"ignoreUntil\", (hoursSinceEpoch + 5)); \n}\n\nlet ignoreUntil = flow.get(\"ignoreUntil\");\n\nlet cont = true;\n\nif (ignoreUntil) {\n\tlet hoursSinceEpoch = getCurEpoch();\n\tif (hoursSinceEpoch < ignoreUntil) cont = false;\n}\n\nif (cont) set24hourIgnore();\nif (cont) return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":40,"wires":[["16a79cd8.916a23"]]},{"id":"3f6bd01.737e23","type":"function","z":"f2f2edc5.b030a","name":"set payload to flow","func":"flow.set(\"input_payload\", msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":190,"y":60,"wires":[["5e58bc1.1fc3f44"]]},{"id":"16a79cd8.916a23","type":"function","z":"f2f2edc5.b030a","name":"get payload from flow","func":"msg.payload = flow.get(\"input_payload\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":63,"wires":[[]]},{"id":"47cfb2de.b8c6bc","type":"function","z":"d3e83ea9.c31f8","name":"","func":"const getCurEpoch = () => {\n\tlet now = new Date()  \n\tlet secondsSinceEpoch = Math.round(now.getTime() / 1000);\n\tlet minsSinceEpoch = Math.floor(secondsSinceEpoch/60);\n\tlet hoursSinceEpoch = Math.floor(minsSinceEpoch/60);\n\treturn hoursSinceEpoch;\n\t\n\t//test with minutes\n\t//return minsSinceEpoch; \n}\nconst set24hourIgnore = () => {\n\tlet hoursSinceEpoch = getCurEpoch();\n\tflow.set(\"ignoreUntil\", (hoursSinceEpoch + 1));\n\t\n\t//test\n\t//flow.set(\"ignoreUntil\", (hoursSinceEpoch + 5)); \n}\n\nlet ignoreUntil = flow.get(\"ignoreUntil\");\n\nlet cont = true;\n\nif (ignoreUntil) {\n\tlet hoursSinceEpoch = getCurEpoch();\n\tif (hoursSinceEpoch < ignoreUntil) cont = false;\n}\n\nif (cont) set24hourIgnore();\nif (cont) return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":320,"y":40,"wires":[["40657515.2256ec"]]},{"id":"40657515.2256ec","type":"function","z":"d3e83ea9.c31f8","name":"get payload from flow","func":"msg.payload = flow.get(\"input_payload\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":120,"wires":[[]]},{"id":"386d5508.6c4eba","type":"function","z":"d3e83ea9.c31f8","name":"set payload to flow","func":"flow.set(\"input_payload\", msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":150,"y":117,"wires":[["47cfb2de.b8c6bc"]]},{"id":"93726af6.90b028","type":"inject","z":"7a95d62b.bca3b8","name":"Every Min","props":[{"p":"payload"}],"repeat":"","crontab":"*/1 0-23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":90,"y":20,"wires":[["8e2b652c.3b4638"]]},{"id":"68192c53.8db544","type":"function","z":"7a95d62b.bca3b8","name":"is it One Minute WK Warning Time?","func":"let now = new Date()  \nlet secondsSinceEpoch = Math.round(now.getTime() / 1000) \nlet curTime = Math.floor(secondsSinceEpoch/60)\n\n\nlet wkEndTemp = flow.get(\"WKend\");\nlet wkEnd = wkEndTemp ? wkEndTemp : 0;\n\nif ((wkEnd - 1) == curTime)\n    return [msg,null];\nelse\n    return [null,msg];\n    ","outputs":2,"noerr":0,"initialize":"","finalize":"","x":482,"y":150,"wires":[["bbd3dead.0c775"],["9bbdabaa.36e388","79534b7a.8da5a4"]]},{"id":"bbd3dead.0c775","type":"api-current-state","z":"7a95d62b.bca3b8","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":821,"y":142,"wires":[["3980e817.ebdd78"],[]]},{"id":"40ad2f27.8ebaf","type":"delay","z":"7a95d62b.bca3b8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1123,"y":142,"wires":[["72bf7114.113af"]]},{"id":"72bf7114.113af","type":"api-call-service","z":"7a95d62b.bca3b8","name":"turn wk on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1271,"y":142,"wires":[[]]},{"id":"3980e817.ebdd78","type":"api-call-service","z":"7a95d62b.bca3b8","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":975,"y":142,"wires":[["40ad2f27.8ebaf"]]},{"id":"235d16d1.a1f76a","type":"function","z":"7a95d62b.bca3b8","name":"if WK sched on","func":"let now = new Date()  \nlet secondsSinceEpoch = Math.round(now.getTime() / 1000) \nlet curTime = Math.floor(secondsSinceEpoch/60)\n\nlet wkEndTemp = flow.get(\"WKend\");\nlet wkEnd = wkEndTemp ? wkEndTemp : 0;\n\nif (wkEnd > curTime)\n    return [msg,null];\nelse\n    return [null,msg];\n    ","outputs":2,"noerr":0,"initialize":"","finalize":"","x":229,"y":170,"wires":[["68192c53.8db544"],["27f93c7b.21a674","6a59842c.58c8bc"]]},{"id":"27f93c7b.21a674","type":"api-current-state","z":"7a95d62b.bca3b8","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":402,"y":192,"wires":[["584116ba.723b78"],[]]},{"id":"584116ba.723b78","type":"api-call-service","z":"7a95d62b.bca3b8","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":556,"y":192,"wires":[["63edfd03.926a54"]]},{"id":"6a59842c.58c8bc","type":"api-current-state","z":"7a95d62b.bca3b8","name":"if FL off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":402,"y":235,"wires":[["9ced355e.4e9078"],[]]},{"id":"9ced355e.4e9078","type":"api-call-service","z":"7a95d62b.bca3b8","name":"turn FL on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":556,"y":235,"wires":[[]]},{"id":"7d988c13.2170d4","type":"api-current-state","z":"7a95d62b.bca3b8","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":367,"y":324,"wires":[["c4fe567c.ab23b8"],[]]},{"id":"c4fe567c.ab23b8","type":"api-call-service","z":"7a95d62b.bca3b8","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":521,"y":324,"wires":[["75ee4b92.c33c74"]]},{"id":"e5a922b9.b99f8","type":"api-current-state","z":"7a95d62b.bca3b8","name":"if FL on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":370,"y":364,"wires":[["684de092.ccbba"],[]]},{"id":"684de092.ccbba","type":"api-call-service","z":"7a95d62b.bca3b8","name":"turn FL off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":524,"y":364,"wires":[["75ee4b92.c33c74"]]},{"id":"9bbdabaa.36e388","type":"api-current-state","z":"7a95d62b.bca3b8","name":"if wk off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":821,"y":192,"wires":[["5fedfe95.83b9"],[]]},{"id":"5fedfe95.83b9","type":"api-call-service","z":"7a95d62b.bca3b8","name":"turn wk on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":975,"y":192,"wires":[["cd314c75.801f9"]]},{"id":"79534b7a.8da5a4","type":"api-current-state","z":"7a95d62b.bca3b8","name":"if FL on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":824,"y":232,"wires":[["c5a1cbc6.793908"],[]]},{"id":"c5a1cbc6.793908","type":"api-call-service","z":"7a95d62b.bca3b8","name":"turn FL off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":978,"y":232,"wires":[[]]},{"id":"75ee4b92.c33c74","type":"function","z":"7a95d62b.bca3b8","name":"Turn WK sched off","func":"flow.set(\"WKend\", 0);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":704,"y":344,"wires":[["63edfd03.926a54"]]},{"id":"ebc3f2b7.2c91c","type":"function","z":"7a95d62b.bca3b8","name":"if light sched on","func":"let onHour  = flow.get(\"onHour\");  // 11;\nlet offHour = flow.get(\"offHour\"); // 23;\n\nlet d = new Date();\nlet curHour = d.getHours();\n\nif ((curHour >= onHour && curHour < offHour) || (onHour == offHour))\n    return [msg,null];\nelse\n    return [null,msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":149,"y":242,"wires":[["235d16d1.a1f76a"],["7d988c13.2170d4","e5a922b9.b99f8"]]},{"id":"cd314c75.801f9","type":"api-current-state","z":"7a95d62b.bca3b8","name":"if wk UI off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wkUI}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1130,"y":360,"wires":[["2fa7ec1a.56bda4"],[]]},{"id":"2fa7ec1a.56bda4","type":"api-call-service","z":"7a95d62b.bca3b8","name":"turn wk UI on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wkUI}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1324,"y":360,"wires":[[]]},{"id":"63edfd03.926a54","type":"api-current-state","z":"7a95d62b.bca3b8","name":"if wk UI on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wkUI}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1130,"y":420,"wires":[["acc0dfc1.6910e"],[]]},{"id":"acc0dfc1.6910e","type":"api-call-service","z":"7a95d62b.bca3b8","name":"turn wk UI off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wkUI}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1324,"y":420,"wires":[[]]},{"id":"8e2b652c.3b4638","type":"function","z":"7a95d62b.bca3b8","name":"flow","func":"if (flow.get(\"onetime\")) return msg;\n\nconst flowParent = (n) => flow.get(`$parent.${n}`) ? flow.set(`${n}`, flow.get(`$parent.${n}`)) : false;\n\nflowParent(\"wklight\");\nflowParent(\"fllight\");\nflowParent(\"onHour\");\nflowParent(\"offHour\");\nflowParent(\"fan\");\nflowParent(\"wkUI\");\nflow.set(\"onetime\", true);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":119,"y":80,"wires":[["ebc3f2b7.2c91c"]]},{"id":"28abc2cd.44498e","type":"function","z":"90dcf55e.a8a7c8","name":"Turn WK sched on","func":"let now = new Date()  \nlet secondsSinceEpoch = Math.round(now.getTime() / 1000) \nlet minsSinceEpoch = Math.floor(secondsSinceEpoch/60)\n\nlet wkend = (minsSinceEpoch + 15);\n\nif (\"$parent.$parent\") flow.set(\"$parent.$parent.WKend\", wkend);\nflow.set(\"$parent.WKend\", wkend);\nflow.set(\"WKend\", wkend);\n\nmsg.payload = wkend;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":140,"wires":[["44ae7522.1602cc","3c90f9f5.accd16"]]},{"id":"44ae7522.1602cc","type":"api-current-state","z":"90dcf55e.a8a7c8","name":"if wk off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":647,"y":140,"wires":[["c54e7601.484338"],[]]},{"id":"c54e7601.484338","type":"api-call-service","z":"90dcf55e.a8a7c8","name":"turn wk on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":801,"y":140,"wires":[["be8b40fb.0d948"]]},{"id":"3c90f9f5.accd16","type":"api-current-state","z":"90dcf55e.a8a7c8","name":"if FL on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":650,"y":180,"wires":[["539c6177.0ebc3"],[]]},{"id":"539c6177.0ebc3","type":"api-call-service","z":"90dcf55e.a8a7c8","name":"turn FL off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":804,"y":180,"wires":[[]]},{"id":"a42bf7f6.618748","type":"function","z":"90dcf55e.a8a7c8","name":"if light sched on","func":"let onHour  = flow.get(\"onHour\");  // 11;\nlet offHour = flow.get(\"offHour\"); // 23;\n\nlet d = new Date();\nlet curHour = d.getHours();\n\nif ((curHour >= onHour && curHour < offHour) || (onHour == offHour))\n    return [msg,null];\nelse\n    return [null,msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":240,"y":138,"wires":[["28abc2cd.44498e"],[]]},{"id":"be8b40fb.0d948","type":"api-current-state","z":"90dcf55e.a8a7c8","name":"if wk UI off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wkUI}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":989,"y":140,"wires":[["49946608.533558"],[]]},{"id":"49946608.533558","type":"api-call-service","z":"90dcf55e.a8a7c8","name":"turn wk UI on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wkUI}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1169,"y":140,"wires":[[]]},{"id":"b4070a2d.459368","type":"function","z":"90dcf55e.a8a7c8","name":"flow","func":"if (flow.get(\"onetime\")) return msg;\n\nconst flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));\n//const flowParent = (n) => flow.get(`$parent.${n}`) ? flow.set(`${n}`, flow.get(`$parent.${n}`)) : false;\n\nflowParent(\"wklight\");\nflowParent(\"fllight\");\nflowParent(\"onHour\");\nflowParent(\"offHour\");\nflowParent(\"fan\");\nflowParent(\"wkUI\");\nflow.set(\"onetime\", true);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":150,"y":60,"wires":[["a42bf7f6.618748"]]},{"id":"b0f09bfb.74d1b8","type":"function","z":"23f32820.744c18","name":"Turn WK sched off","func":"if (\"$parent.$parent\") flow.set(\"$parent.$parent.WKend\",0);\nflow.set(\"$parent.WKend\",0);\nflow.set(\"WKend\", 0);\n\nmsg.payload = 0;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":140,"wires":[["4f7ac8f3.382718","fe92e81a.1a67b8"]]},{"id":"4f7ac8f3.382718","type":"api-current-state","z":"23f32820.744c18","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":635,"y":140,"wires":[["bce4245f.ef90c8"],[]]},{"id":"bce4245f.ef90c8","type":"api-call-service","z":"23f32820.744c18","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":789,"y":140,"wires":[["3ef33d5d.c14d62"]]},{"id":"fe92e81a.1a67b8","type":"api-current-state","z":"23f32820.744c18","name":"if FL off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":637,"y":180,"wires":[["dbab2733.dfe9b8"],[]]},{"id":"dbab2733.dfe9b8","type":"api-call-service","z":"23f32820.744c18","name":"turn FL on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":791,"y":180,"wires":[[]]},{"id":"271c495c.e7bd46","type":"function","z":"23f32820.744c18","name":"if light sched on","func":"let onHour  = flow.get(\"onHour\");  // 11;\nlet offHour = flow.get(\"offHour\"); // 23;\n\nlet d = new Date();\nlet curHour = d.getHours();\n\nif ((curHour >= onHour && curHour < offHour) || (onHour == offHour))\n    return [msg,null];\nelse\n    return [null,msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":243,"y":140,"wires":[["b0f09bfb.74d1b8"],[]]},{"id":"3ef33d5d.c14d62","type":"api-current-state","z":"23f32820.744c18","name":"if wk UI on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wkUI}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":981,"y":140,"wires":[["318d5b67.3b76b4"],[]]},{"id":"318d5b67.3b76b4","type":"api-call-service","z":"23f32820.744c18","name":"turn wk UI off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wkUI}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1175,"y":140,"wires":[[]]},{"id":"3c0a1c54.f52a44","type":"function","z":"23f32820.744c18","name":"flow","func":"if (flow.get(\"onetime\")) return msg;\n\nconst flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));\n//const flowParent = (n) => flow.get(`$parent.${n}`) ? flow.set(`${n}`, flow.get(`$parent.${n}`)) : false;\n\nflowParent(\"wklight\");\nflowParent(\"fllight\");\nflowParent(\"onHour\");\nflowParent(\"offHour\");\nflowParent(\"fan\");\nflowParent(\"wkUI\");\nflow.set(\"onetime\", true);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":150,"y":60,"wires":[["271c495c.e7bd46"]]},{"id":"7b2aa132.40083","type":"api-current-state","z":"aecfccc8.83c99","name":"if fan off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fan}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":680,"y":160,"wires":[["9d9b8e39.3196"],[]]},{"id":"db452beb.331688","type":"api-current-state","z":"aecfccc8.83c99","name":"if fan on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fan}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":680,"y":280,"wires":[["5ab97df6.5294d4"],[]]},{"id":"5ab97df6.5294d4","type":"api-call-service","z":"aecfccc8.83c99","name":"set fan state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":840,"y":280,"wires":[[]]},{"id":"9d9b8e39.3196","type":"api-call-service","z":"aecfccc8.83c99","name":"set fan state on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":840,"y":159,"wires":[[]]},{"id":"234d98de.bdbfc8","type":"function","z":"aecfccc8.83c99","name":"create temp message","func":"let temperature = flow.get(\"temperature\");\nmsg.payload = `${temperature} Temp is ${msg.payload}`\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1060,"y":220,"wires":[["a5dab261.ca5e7"]]},{"id":"b62f7cb2.c6634","type":"subflow:f2f2edc5.b030a","z":"aecfccc8.83c99","name":"","x":880,"y":360,"wires":[["234d98de.bdbfc8"]]},{"id":"a5dab261.ca5e7","type":"subflow:71a3fd81.9edc14","z":"aecfccc8.83c99","name":"","x":1273,"y":219,"wires":[]},{"id":"5c61849f.cc25ac","type":"function","z":"aecfccc8.83c99","name":"if temp below 60","func":"if (msg.payload < 60)\n    return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":658,"y":360,"wires":[["b62f7cb2.c6634"]]},{"id":"9b0b529.36312b","type":"function","z":"aecfccc8.83c99","name":"temp is above 74 \\n temp is 74-61 \\n temp is below 61","func":"if (msg.payload >= 74)\n    return [msg, null, null];\nelse if (msg.payload < 61)\n    return [null, null, msg];\nelse\n    return [null, msg, null];\n    \n/*\ntemp is above 77 \\n temp is 77-61 \\n temp is below 61\n\nif (msg.payload >= 77)\n    return [msg, null, null];\nelse if (msg.payload < 61)\n    return [null, null, msg];\nelse\n    return [null, msg, null];\n*/","outputs":3,"noerr":0,"initialize":"","finalize":"","x":350,"y":220,"wires":[["7b2aa132.40083","f67a84ea.293478"],["2cc1a7ce.4b3a08"],["db452beb.331688","5c61849f.cc25ac"]]},{"id":"2163394a.537206","type":"function","z":"aecfccc8.83c99","name":"flow","func":"if (flow.get(\"onetime\")) return msg;\n\nconst flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));\n//const flowParent = (n) => flow.get(`$parent.${n}`) ? flow.set(`${n}`, flow.get(`$parent.${n}`)) : false;\n\nflowParent(\"wklight\");\nflowParent(\"fllight\");\nflowParent(\"onHour\");\nflowParent(\"offHour\");\nflowParent(\"fan\");\nflowParent(\"wkUI\");\nflowParent(\"temperature\");\nflowParent(\"humidity_sensor\");\nflow.set(\"onetime\", true);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":110,"y":100,"wires":[["89836958.8844c8"]]},{"id":"c22242dd.73993","type":"subflow:f2f2edc5.b030a","z":"aecfccc8.83c99","name":"","x":900,"y":80,"wires":[["234d98de.bdbfc8"]]},{"id":"f67a84ea.293478","type":"function","z":"aecfccc8.83c99","name":"if temp above 83","func":"if (msg.payload > 83)\n    return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":678,"y":80,"wires":[["c22242dd.73993"]]},{"id":"89836958.8844c8","type":"api-current-state","z":"aecfccc8.83c99","name":"get temperature","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"num","halt_if_compare":"lte","entity_id":"{{flow.temperature}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":264,"y":100,"wires":[["9b0b529.36312b"]]},{"id":"2cc1a7ce.4b3a08","type":"api-current-state","z":"aecfccc8.83c99","name":"if above 60% humidity","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"60","halt_if_type":"num","halt_if_compare":"gt","entity_id":"{{flow.humidity_sensor}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":600,"y":220,"wires":[["7b2aa132.40083"],["db452beb.331688"]]},{"id":"24a95e7c.ff9822","type":"subflow:f2f2edc5.b030a","z":"2971f5bb.c171da","name":"","x":800,"y":293,"wires":[["973b37bc.5533c8"]]},{"id":"6e647b3b.c848c4","type":"subflow:71a3fd81.9edc14","z":"2971f5bb.c171da","name":"","x":1021,"y":402,"wires":[]},{"id":"973b37bc.5533c8","type":"function","z":"2971f5bb.c171da","name":"Create Low Moisture Message","func":"// entity_id, moisture\nlet entity_id = msg.payload.entity_id.replace(\"sensor.\",\"\")\nmsg.payload = `${entity_id}: ${msg.payload.moisture}`\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":888,"y":349,"wires":[["6e647b3b.c848c4"]]},{"id":"882f28b5.5bd768","type":"subflow:90dcf55e.a8a7c8","z":"2971f5bb.c171da","name":"","env":[],"x":705,"y":105,"wires":[]},{"id":"be3f4ae7.2ea408","type":"subflow:23f32820.744c18","z":"2971f5bb.c171da","name":"","x":705,"y":149,"wires":[]},{"id":"e7ffbfa3.f78de","type":"subflow:aecfccc8.83c99","z":"2971f5bb.c171da","name":"","x":747,"y":195,"wires":[]},{"id":"3dac7f1c.6412f","type":"server-events","z":"2971f5bb.c171da","name":"","server":"1b7e4fe1.0da8e","version":2,"eventType":"state_changed","waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"x":120,"y":167,"wires":[["71ef7959.5800f8"]]},{"id":"a8eb72ea.76246","type":"function","z":"2971f5bb.c171da","name":"wkUI On \\n wkUI Off \\n temperature \\n humidity \\n moisture","func":"if (msg.payload.hasOwnProperty(\"entity_id\")) {\n    \n    let wkUI = flow.get(\"wkUI\");\n    let temperature = flow.get(\"temperature\");\n    let moistureSubstr = flow.get(\"moistureSubstr\");\n    let humidity_sensor = flow.get(\"humidity_sensor\");\n    \n    if (wkUI) {\n        if (msg.payload.entity_id == wkUI)  {\n            const flowParent = (n) => flow.get(`$parent.${n}`) ? flow.set(`${n}`, flow.get(`$parent.${n}`)) : false;\n            flowParent(\"WKend\");\n            msg.payload = msg.payload.event.new_state.state;\n            if (msg.payload == \"on\") \n                return [msg,null,null,null,null];\n            else\n                return [null,msg,null,null,null];\n        }\n    }\n    \n    if (temperature) {\n        if (msg.payload.entity_id == temperature) {\n            msg.payload = parseFloat(msg.payload.event.new_state.state);\n            return [null,null,msg,null,null];\n        }\n    }\n    \n    if (humidity_sensor) {\n        if (msg.payload.entity_id == humidity_sensor) {\n            msg.payload = parseFloat(msg.payload.event.new_state.state);\n            return [null,null,null,msg,null];\n        }\n    }\n\n    if (moistureSubstr) {\n        if (msg.payload.entity_id.substring(0, moistureSubstr.length) == moistureSubstr) {\n            let moisture = parseFloat(msg.payload.event.new_state.state);\n            let entity_id = msg.payload.entity_id;\n            msg.payload={\"moisture\":moisture,\"entity_id\":entity_id};\n            \n            return [null,null,null,null,msg];\n        }\n    }\n    \n}\n","outputs":5,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\n\n//const flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));","finalize":"","x":441,"y":171,"wires":[["882f28b5.5bd768"],["be3f4ae7.2ea408"],["e7ffbfa3.f78de"],["e7ffbfa3.f78de"],["4edd2514.687cac"]]},{"id":"4edd2514.687cac","type":"function","z":"2971f5bb.c171da","name":"if below 30","func":"if (msg.payload.moisture < 30) return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":710,"y":241,"wires":[["24a95e7c.ff9822"]]},{"id":"32cc4aa1.f00936","type":"subflow:14591eab.617051","z":"2971f5bb.c171da","name":"","env":[],"x":310,"y":40,"wires":[]},{"id":"1f8c7be9.cef724","type":"function","z":"2971f5bb.c171da","name":"flow1","func":"//if (flow.get(\"onetime\")) return msg;\n\nconst flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));\n//const flowParent = (n) => flow.get(`$parent.${n}`) ? flow.set(`${n}`, flow.get(`$parent.${n}`)) : false;\n\nflowParent(\"WKend\");\nflowParent(\"wklight\");\nflowParent(\"fllight\");\nflowParent(\"onHour\");\nflowParent(\"offHour\");\nflowParent(\"fan\");\nflowParent(\"wkUI\");\nflowParent(\"moistureSubstr\");\nflowParent(\"temperature\");\nflowParent(\"humidity_sensor\");\n//flow.set(\"onetime\", true);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":130,"y":39,"wires":[["32cc4aa1.f00936"]]},{"id":"71ef7959.5800f8","type":"function","z":"2971f5bb.c171da","name":"flow11","func":"//if (flow.get(\"onetime\")) return msg;\n\nconst flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));\n//const flowParent = (n) => flow.get(`$parent.${n}`) ? flow.set(`${n}`, flow.get(`$parent.${n}`)) : false;\n\nflowParent(\"WKend\");\nflowParent(\"wklight\");\nflowParent(\"fllight\");\nflowParent(\"onHour\");\nflowParent(\"offHour\");\nflowParent(\"fan\");\nflowParent(\"wkUI\");\nflowParent(\"moistureSubstr\");\nflowParent(\"temperature\");\nflowParent(\"humidity_sensor\");\n//flow.set(\"onetime\", true);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":167,"wires":[["a8eb72ea.76246"]]},{"id":"c34c3247.483","type":"function","z":"14591eab.617051","name":"is it One Minute WK Warning Time?","func":"let now = new Date()  \nlet secondsSinceEpoch = Math.round(now.getTime() / 1000) \nlet curTime = Math.floor(secondsSinceEpoch/60)\n\n\nlet wkEndTemp = flow.get(\"WKend\");\nlet wkEnd = wkEndTemp ? wkEndTemp : 0;\n\nif ((wkEnd - 1) == curTime)\n    return [msg,null];\nelse\n    return [null,msg];\n    ","outputs":2,"noerr":0,"initialize":"","finalize":"","x":480,"y":160,"wires":[["f1538ae3.7801a8"],["ca4a5f02.3b1ed","ac7b4923.7a4148"]]},{"id":"f1538ae3.7801a8","type":"api-current-state","z":"14591eab.617051","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":819,"y":152,"wires":[["d3eb7d13.2725a"],[]]},{"id":"e94961b6.c436e","type":"delay","z":"14591eab.617051","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1121,"y":152,"wires":[["b3dfb957.d6dca8"]]},{"id":"b3dfb957.d6dca8","type":"api-call-service","z":"14591eab.617051","name":"turn wk on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1269,"y":152,"wires":[[]]},{"id":"d3eb7d13.2725a","type":"api-call-service","z":"14591eab.617051","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":973,"y":152,"wires":[["e94961b6.c436e"]]},{"id":"aa545795.16f398","type":"function","z":"14591eab.617051","name":"if WK sched on","func":"let now = new Date()  \nlet secondsSinceEpoch = Math.round(now.getTime() / 1000) \nlet curTime = Math.floor(secondsSinceEpoch/60)\n\nlet wkEndTemp = flow.get(\"WKend\");\nlet wkEnd = wkEndTemp ? wkEndTemp : 0;\n\nif (wkEnd > curTime)\n    return [msg,null];\nelse\n    return [null,msg];\n    ","outputs":2,"noerr":0,"initialize":"","finalize":"","x":227,"y":180,"wires":[["c34c3247.483"],["e85eeb23.db9bb8","796d95f3.fe184c"]]},{"id":"e85eeb23.db9bb8","type":"api-current-state","z":"14591eab.617051","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":400,"y":202,"wires":[["6888fc55.9c3ab4"],[]]},{"id":"6888fc55.9c3ab4","type":"api-call-service","z":"14591eab.617051","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":554,"y":202,"wires":[["67763807.e9c628"]]},{"id":"796d95f3.fe184c","type":"api-current-state","z":"14591eab.617051","name":"if FL off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":400,"y":245,"wires":[["2c7da27c.0508be"],[]]},{"id":"2c7da27c.0508be","type":"api-call-service","z":"14591eab.617051","name":"turn FL on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":554,"y":245,"wires":[[]]},{"id":"7f7d2a55.5af184","type":"api-current-state","z":"14591eab.617051","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":365,"y":334,"wires":[["15e21c8e.af9853"],[]]},{"id":"15e21c8e.af9853","type":"api-call-service","z":"14591eab.617051","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":519,"y":334,"wires":[["55df1fba.891ac"]]},{"id":"266d6e9a.be6ca2","type":"api-current-state","z":"14591eab.617051","name":"if FL on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":368,"y":374,"wires":[["6d25a0bd.e8712"],[]]},{"id":"6d25a0bd.e8712","type":"api-call-service","z":"14591eab.617051","name":"turn FL off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":522,"y":374,"wires":[["55df1fba.891ac"]]},{"id":"ca4a5f02.3b1ed","type":"api-current-state","z":"14591eab.617051","name":"if wk off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":819,"y":202,"wires":[["f7a256a1.a452d8"],[]]},{"id":"f7a256a1.a452d8","type":"api-call-service","z":"14591eab.617051","name":"turn wk on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":973,"y":202,"wires":[["105e2c23.4b20c4"]]},{"id":"ac7b4923.7a4148","type":"api-current-state","z":"14591eab.617051","name":"if FL on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":822,"y":242,"wires":[["254b6efd.ff6e02"],[]]},{"id":"254b6efd.ff6e02","type":"api-call-service","z":"14591eab.617051","name":"turn FL off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":976,"y":242,"wires":[[]]},{"id":"55df1fba.891ac","type":"function","z":"14591eab.617051","name":"Turn WK sched off","func":"flow.set(\"WKend\", 0);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":702,"y":354,"wires":[["67763807.e9c628"]]},{"id":"54ac8c49.1cde14","type":"function","z":"14591eab.617051","name":"if light sched on","func":"let onHour  = flow.get(\"onHour\");  // 11;\nlet offHour = flow.get(\"offHour\"); // 23;\n\nlet d = new Date();\nlet curHour = d.getHours();\n\nif ((curHour >= onHour && curHour < offHour) || (onHour == offHour))\n    return [msg,null];\nelse\n    return [null,msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":147,"y":252,"wires":[["aa545795.16f398"],["7f7d2a55.5af184","266d6e9a.be6ca2"]]},{"id":"105e2c23.4b20c4","type":"api-current-state","z":"14591eab.617051","name":"if wk UI off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wkUI}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1128,"y":370,"wires":[["7480b861.6ff428"],[]]},{"id":"7480b861.6ff428","type":"api-call-service","z":"14591eab.617051","name":"turn wk UI on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wkUI}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1322,"y":370,"wires":[[]]},{"id":"67763807.e9c628","type":"api-current-state","z":"14591eab.617051","name":"if wk UI on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wkUI}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1128,"y":430,"wires":[["d4978b8e.ed6c88"],[]]},{"id":"d4978b8e.ed6c88","type":"api-call-service","z":"14591eab.617051","name":"turn wk UI off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wkUI}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1322,"y":430,"wires":[[]]},{"id":"bb6a1411.5c9298","type":"function","z":"14591eab.617051","name":"flow","func":"const flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));\n//const flowParent = (n) => flow.get(`$parent.${n}`) ? flow.set(`${n}`, flow.get(`$parent.${n}`)) : false;\nflowParent(\"WKend\");\n\nif (flow.get(\"onetime\")) return msg;\n\n\nflowParent(\"wklight\");\nflowParent(\"fllight\");\nflowParent(\"onHour\");\nflowParent(\"offHour\");\nflowParent(\"fan\");\nflowParent(\"wkUI\");\nflow.set(\"onetime\", true);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":117,"y":90,"wires":[["54ac8c49.1cde14"]]},{"id":"c11d1a02.250398","type":"api-current-state","z":"81129f40.2fca5","name":"toms phone","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.thomass_iphone_geocoded_location","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":352,"y":54,"wires":[["4c39ba19.200464"]]},{"id":"4c39ba19.200464","type":"function","z":"81129f40.2fca5","name":"set lat lon","func":"if (!msg.data) return msg;\nmsg.payload = \"past data\"\nif (!msg.data.attributes) return msg;\nmsg.payload = \"past data.attributes\"\nif (!msg.data.attributes.Location) return msg;\nmsg.payload = \"past data.attributes.location\"\nif (msg.data.attributes.Location.length < 2) return msg;\n\n//msg.payload[\"lat\"] = msg.data.attributes.location[0];\n//msg.payload[\"lon\"] = msg.data.attributes.location[1];\n\nmsg.payload = { \"lat\":msg.data.attributes.Location[0],\n                \"lon\":msg.data.attributes.Location[1] };\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":502,"y":54,"wires":[["d967f8a8.acd468","46c34783.6ad518"]]},{"id":"d967f8a8.acd468","type":"geofence","z":"81129f40.2fca5","name":"inside home geofence","mode":"circle","inside":"true","rad":726.7531071619542,"points":[],"centre":{"latitude":38.81383047999049,"longitude":-77.1602439880371},"outputs":1,"x":690,"y":30,"wires":[["948dd197.7cdfb"]]},{"id":"46c34783.6ad518","type":"geofence","z":"81129f40.2fca5","name":"outside home geofence","mode":"circle","inside":"false","rad":726.7531071619542,"points":[],"centre":{"latitude":38.81383047999049,"longitude":-77.1602439880371},"outputs":1,"x":700,"y":80,"wires":[["63c2e324.fb57fc"]]},{"id":"690cfda7.5f42d4","type":"function","z":"81129f40.2fca5","name":"set payload to flow","func":"flow.set(\"input_payload\", msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":170,"y":54,"wires":[["c11d1a02.250398"]]},{"id":"63c2e324.fb57fc","type":"function","z":"81129f40.2fca5","name":"get payload from flow","func":"msg.payload = flow.get(\"input_payload\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":928,"y":80,"wires":[[]]},{"id":"948dd197.7cdfb","type":"function","z":"81129f40.2fca5","name":"get payload from flow","func":"msg.payload = flow.get(\"input_payload\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":927,"y":30,"wires":[[]]},{"id":"25327c67.85e1d4","type":"api-current-state","z":"923298e.d488e68","name":"if fan off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fan}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":696,"y":240,"wires":[["4d737906.a33e78"],[]]},{"id":"cc69cdec.7286c","type":"api-current-state","z":"923298e.d488e68","name":"if fan on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fan}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":836,"y":480,"wires":[["3e28bd6.6ebaf42"],[]]},{"id":"3e28bd6.6ebaf42","type":"api-call-service","z":"923298e.d488e68","name":"set fan state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":996,"y":480,"wires":[[]]},{"id":"4d737906.a33e78","type":"api-call-service","z":"923298e.d488e68","name":"set fan state on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":856,"y":239,"wires":[["7748cb2a.575754"]]},{"id":"61b78e5e.eb001","type":"function","z":"923298e.d488e68","name":"create humidity message","func":"let humidity = flow.get(\"humidity_sensor\");\nmsg.payload = `${humidity} Humidity is ${msg.payload}`\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":946,"y":400,"wires":[["ec16c464.26eb88"]]},{"id":"de7e4e88.a4ae6","type":"function","z":"923298e.d488e68","name":"Humidity is above 70 \\n Humidity is 70 - 64 \\n Humidity is 64 - 60 \\n Humidity is 60-55 \\n Humidity is below 55","func":"if (msg.payload > 70)\n    return [msg, null, null, null, null];\nelse if (msg.payload <= 70 && msg.payload > 64)\n    return [null, msg, null, null, null];\nelse if (msg.payload <= 64 && msg.payload > 60)\n    return [null, null, msg, null, null];\nelse if (msg.payload <= 60 && msg.payload > 55)\n    return [null, null, null, msg, null];\nelse if (msg.payload <= 55)\n    return [null, null, null, null, msg];\n    \n/*\nabove 70\n\n70-65\n65-60\n60-55\n\nbelow 55\n\n\n*/","outputs":5,"noerr":0,"initialize":"","finalize":"","x":376,"y":400,"wires":[["25327c67.85e1d4","40f0f1.9198df1","1b78778f.f27248"],["25327c67.85e1d4","1b78778f.f27248"],["cc69cdec.7286c","1b78778f.f27248"],["cc69cdec.7286c","daa90b28.8ee328"],["40f0f1.9198df1","cc69cdec.7286c","daa90b28.8ee328"]]},{"id":"473de53d.cb806c","type":"function","z":"923298e.d488e68","name":"get flow entities: \\n fan \\n humidity sensor \\n humidifier","func":"//if (flow.get(\"onetime\")) return msg;\n\nconst flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));\n\nflowParent(\"humidity_sensor\");\nflowParent(\"humidifier\");\nflowParent(\"fan\");\n\n//flow.set(\"onetime\", true);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":173,"y":327,"wires":[["de7e4e88.a4ae6"]]},{"id":"40f0f1.9198df1","type":"subflow:d3e83ea9.c31f8","z":"923298e.d488e68","name":"","env":[],"x":711,"y":400,"wires":[["61b78e5e.eb001"]]},{"id":"ec16c464.26eb88","type":"subflow:71a3fd81.9edc14","z":"923298e.d488e68","name":"","x":1166,"y":400,"wires":[]},{"id":"daa90b28.8ee328","type":"api-current-state","z":"923298e.d488e68","name":"if humidifier off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.humidifier}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":716,"y":560,"wires":[["bcfb1a51.fe3128"],[]]},{"id":"bcfb1a51.fe3128","type":"api-call-service","z":"923298e.d488e68","name":"set humidifier state on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.humidifier}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":936,"y":560,"wires":[["4c75d3fc.4c54ec"]]},{"id":"1b78778f.f27248","type":"api-current-state","z":"923298e.d488e68","name":"if humidifier on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.humidifier}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":856,"y":320,"wires":[["e9820da4.682b8"],[]]},{"id":"e9820da4.682b8","type":"api-call-service","z":"923298e.d488e68","name":"set humidifier state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.humidifier}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1056,"y":320,"wires":[[]]},{"id":"7748cb2a.575754","type":"delay","z":"923298e.d488e68","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1016,"y":240,"wires":[["30410b08.943a04"]]},{"id":"4c75d3fc.4c54ec","type":"delay","z":"923298e.d488e68","name":"","pauseType":"delay","timeout":"40","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1096,"y":600,"wires":[["89a85115.263c1"]]},{"id":"30410b08.943a04","type":"api-call-service","z":"923298e.d488e68","name":"set fan state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1176,"y":240,"wires":[[]]},{"id":"89a85115.263c1","type":"api-call-service","z":"923298e.d488e68","name":"set humidifier state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.humidifier}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1196,"y":660,"wires":[[]]},{"id":"195f14d7.60752b","type":"inject","z":"923298e.d488e68","name":"Run Once","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"4.0","topic":"","payload":"","payloadType":"date","x":108,"y":35,"wires":[["91ce5e54.ee209"]]},{"id":"d91becd.fe7d01","type":"api-current-state","z":"923298e.d488e68","name":"humidity_sensor","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.humidity_sensor}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":189,"y":124,"wires":[["473de53d.cb806c","8aa98c8e.f3f8c"]]},{"id":"91ce5e54.ee209","type":"function","z":"923298e.d488e68","name":"get flow entities","func":"const flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));\n\nflowParent(\"humidity_sensor\");\nflowParent(\"humidifier\");\nflowParent(\"fan\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":153,"y":82,"wires":[["d91becd.fe7d01"]]},{"id":"8aa98c8e.f3f8c","type":"debug","z":"923298e.d488e68","name":"initial run with humidity_sensor","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":465,"y":125,"wires":[]},{"id":"fe60c871.2a5248","type":"function","z":"434b5120.15655","name":"set flow","func":"flow.set(\"motor\",`light.blue_motor_${msg.payload}`);\nflow.set(\"motor_ui\",`input_boolean.motor${msg.payload}`);\nflow.set(\"motor_ml\",`input_number.ml_motor${msg.payload}`);\nflow.set(\"motor_calibrate\",`input_number.calibrate_motor${msg.payload}`);\n\n/*\nlet loop_count = msg.payload * 2;\n\nflow.set(\"loop_count\", loop_count);\nflow.set(\"loop_pos\", -1); \n\nmsg.payload = {\"data\":{\"brightness_pct\":  100}}\n*/\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":165,"y":30,"wires":[["505329e7.902a18"]]},{"id":"505329e7.902a18","type":"api-current-state","z":"434b5120.15655","name":"","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.motor_calibrate}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":330,"y":80,"wires":[["8b7a8d10.05cd8"]]},{"id":"8b7a8d10.05cd8","type":"function","z":"434b5120.15655","name":"set flow.calibrate","func":"flow.set(\"calibrate\",msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":80,"wires":[["3e37a444.8d391c"]]},{"id":"3e37a444.8d391c","type":"api-current-state","z":"434b5120.15655","name":"","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.motor_ml}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":310,"y":140,"wires":[["ac3a4dc6.ff33b"]]},{"id":"ac3a4dc6.ff33b","type":"function","z":"434b5120.15655","name":"set flow.ml","func":"flow.set(\"ml\",msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":590,"y":140,"wires":[["4aec80c6.c26d6"]]},{"id":"4a26c4e7.0ebd9c","type":"mytimeout","z":"434b5120.15655","name":"","outtopic":"","outsafe":"","outwarning":"Warning","outunsafe":"off","warning":"0","timer":"1","debug":false,"ndebug":false,"ignoreCase":false,"repeat":false,"again":false,"x":370,"y":340,"wires":[["966443ba.b350b"],["81aaa9bd.33d9c8"]]},{"id":"674e4fda.8fed6","type":"server-events","z":"434b5120.15655","name":"state_changed","server":"1b7e4fe1.0da8e","version":2,"eventType":"state_changed","waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"x":100,"y":420,"wires":[["21bfb010.3e6dc","15a64087.f6345f","c9419946.7bb108"]]},{"id":"21bfb010.3e6dc","type":"function","z":"434b5120.15655","name":"motor is off \\n motor_ui is off","func":"if (msg.payload.hasOwnProperty(\"entity_id\")) {\n    \n    let motor = flow.get(\"motor\");\n    let motor_ui = flow.get(\"motor_ui\");\n\n    \n    if (motor) {\n        if (msg.payload.entity_id == motor)  {\n            msg.payload = msg.payload.event.new_state.state;\n            if (msg.payload == \"off\") return [msg,null];\n        }\n    }\n    \n    if (motor_ui) {\n        if (msg.payload.entity_id == motor_ui)  {\n            msg.payload = msg.payload.event.new_state.state;\n            if (msg.payload == \"off\") return [null,msg];\n        }\n    }\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":140,"y":505,"wires":[["e2d4f94f.0bf298"],["641c0846.778db8"]]},{"id":"641c0846.778db8","type":"api-current-state","z":"434b5120.15655","name":"if motor on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.motor}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":330,"y":545,"wires":[["554c8fa7.b32f5"],[]]},{"id":"e2d4f94f.0bf298","type":"api-current-state","z":"434b5120.15655","name":"if motor UI on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.motor_ui}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":340,"y":505,"wires":[["554c8fa7.b32f5"],[]]},{"id":"554c8fa7.b32f5","type":"change","z":"434b5120.15655","name":"STOP","rules":[{"t":"set","p":"payload","pt":"msg","to":"STOP","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":440,"wires":[["4a26c4e7.0ebd9c"]]},{"id":"4374487e.490ce8","type":"api-call-service","z":"434b5120.15655","name":"motor on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.motor}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":540,"y":280,"wires":[[]]},{"id":"ae907c31.4754d","type":"api-call-service","z":"434b5120.15655","name":"turn down motor controller","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.motor}}"],"data":"{\"brightness_pct\":  0}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":800,"y":340,"wires":[["bda23c1b.b600f"]]},{"id":"966443ba.b350b","type":"function","z":"434b5120.15655","name":"dim 0%","func":"msg.payload = {\"data\":{\"brightness_pct\":  0}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":580,"y":340,"wires":[["ae907c31.4754d"]]},{"id":"267ff63d.f12bda","type":"subflow:71a3fd81.9edc14","z":"434b5120.15655","name":"","x":832,"y":460,"wires":[]},{"id":"bda23c1b.b600f","type":"function","z":"434b5120.15655","name":"Motor cycle is complete!","func":"let motor = flow.get(\"motor\")\n\nmsg.payload = `${motor.replace(\"light.blue_\",\"\")} cycle is complete!`\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":400,"wires":[["267ff63d.f12bda","68507de7.b3a384"]]},{"id":"68507de7.b3a384","type":"api-current-state","z":"434b5120.15655","name":"if motor UI on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.motor_ui}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1050,"y":400,"wires":[["a54788e1.c60068"],[]]},{"id":"a54788e1.c60068","type":"api-call-service","z":"434b5120.15655","name":"turn motor UI off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.motor_ui}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1097,"y":460,"wires":[[]]},{"id":"15a64087.f6345f","type":"function","z":"434b5120.15655","name":"motor_ui is on","func":"if (msg.payload.hasOwnProperty(\"entity_id\")) {\n\n    let motor_ui = flow.get(\"motor_ui\");\n\n    if (motor_ui) {\n        if (msg.payload.entity_id == motor_ui)  {\n            msg.payload = msg.payload.event.new_state.state;\n            if (msg.payload == \"on\") {\n                flow.set('run_seconds', -1);\n                let calibrate = flow.get(\"calibrate\");\n                let ml = flow.get(\"ml\");\n                let sec = ml * calibrate;\n                \n                msg.payload = {\n                    \"payload\": \"on\",\n                    \"timeout\": sec,\n                    \"warning\": 0\n                }\n\n                return msg;\n            }\n        }\n    }\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":160,"y":310,"wires":[["4a26c4e7.0ebd9c","ea9bd3e7.ad6e9"]]},{"id":"4aec80c6.c26d6","type":"function","z":"434b5120.15655","d":true,"name":"test","func":"let calibrate = flow.get(\"calibrate\");\nlet ml = flow.get(\"ml\");\nlet sec = ml * calibrate;\n\nmsg.payload = `calibrate = ${calibrate}, ml = ${ml}, sec = ${sec}`\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":790,"y":140,"wires":[[]]},{"id":"ea9bd3e7.ad6e9","type":"function","z":"434b5120.15655","name":"turn motor on","func":"msg.payload = {\"data\":{\"brightness_pct\":  100}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":380,"y":280,"wires":[["4374487e.490ce8"]]},{"id":"c9419946.7bb108","type":"function","z":"434b5120.15655","name":"update ml or calibrate","func":"if (msg.payload.hasOwnProperty(\"entity_id\")) {\n\n    let motor_ml = flow.get(\"motor_ml\");\n    let motor_calibrate = flow.get(\"motor_calibrate\");\n    \n    if (msg.payload.entity_id == motor_ml) {\n        let new_ml = parseFloat(msg.payload.event.new_state.state);\n        flow.set(\"ml\", new_ml)\n    }\n    \n    if (msg.payload.entity_id == motor_calibrate) {\n        let new_calibrate = parseFloat(msg.payload.event.new_state.state);\n        flow.set(\"calibrate\", new_calibrate)\n    }\n    \n}\n","outputs":0,"noerr":0,"initialize":"","finalize":"","x":359,"y":419,"wires":[]},{"id":"81aaa9bd.33d9c8","type":"function","z":"434b5120.15655","name":"track seconds & report ml","func":"let calibrate = flow.get(\"calibrate\");\n\nlet run_seconds = flow.get(\"run_seconds\");\nrun_seconds++;\nflow.set(\"run_seconds\", run_seconds);\n\nlet cur_ml = run_seconds * calibrate;\n\nmsg.payload = cur_ml;\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":580,"wires":[["92b2a015.4a81"]]},{"id":"92b2a015.4a81","type":"api-call-service","z":"434b5120.15655","d":true,"name":"","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"sensor","service":"","areaId":[],"deviceId":[],"entityId":["sensor.ml_1"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":860,"y":580,"wires":[[]]},{"id":"3a6b34e9.4ca7fc","type":"function","z":"4ebd89af.8412c8","name":"set flow","func":"flow.set(\"motor\",`light.blue_motor3_${msg.payload}`);\nflow.set(\"motor_ui\",`input_boolean.motor3_${msg.payload}`);\nflow.set(\"motor_ml\",`input_number.ml_motor3_${msg.payload}`);\nflow.set(\"motor_calibrate\",`input_number.calibrate_motor3_${msg.payload}`);\n\n/*\nlet loop_count = msg.payload * 2;\n\nflow.set(\"loop_count\", loop_count);\nflow.set(\"loop_pos\", -1); \n\nmsg.payload = {\"data\":{\"brightness_pct\":  100}}\n*/\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":160,"y":40,"wires":[["dde4344f.7a0d88"]]},{"id":"dde4344f.7a0d88","type":"api-current-state","z":"4ebd89af.8412c8","name":"","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.motor_calibrate}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":325,"y":90,"wires":[["5614d163.e12f9"]]},{"id":"5614d163.e12f9","type":"function","z":"4ebd89af.8412c8","name":"set flow.calibrate","func":"flow.set(\"calibrate\",msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":605,"y":90,"wires":[["a2721053.62ef1"]]},{"id":"a2721053.62ef1","type":"api-current-state","z":"4ebd89af.8412c8","name":"","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.motor_ml}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":305,"y":150,"wires":[["4982217c.7fb28"]]},{"id":"4982217c.7fb28","type":"function","z":"4ebd89af.8412c8","name":"set flow.ml","func":"flow.set(\"ml\",msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":585,"y":150,"wires":[["3276751d.4e01da"]]},{"id":"ad995a8d.24a338","type":"mytimeout","z":"4ebd89af.8412c8","name":"","outtopic":"","outsafe":"","outwarning":"Warning","outunsafe":"off","warning":"0","timer":"1","debug":false,"ndebug":false,"ignoreCase":false,"repeat":false,"again":false,"x":365,"y":350,"wires":[["b10ce8f1.d55af8"],["8930e60d.eba9f8"]]},{"id":"942f52e0.d4871","type":"server-events","z":"4ebd89af.8412c8","name":"state_changed","server":"1b7e4fe1.0da8e","version":2,"eventType":"state_changed","waitForRunning":true,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"x":95,"y":430,"wires":[["b6691f20.07adf","aedd880c.f0fb48","eeb9737c.0a66d"]]},{"id":"b6691f20.07adf","type":"function","z":"4ebd89af.8412c8","name":"motor is off \\n motor_ui is off","func":"if (msg.payload.hasOwnProperty(\"entity_id\")) {\n    \n    let motor = flow.get(\"motor\");\n    let motor_ui = flow.get(\"motor_ui\");\n\n    \n    if (motor) {\n        if (msg.payload.entity_id == motor)  {\n            msg.payload = msg.payload.event.new_state.state;\n            if (msg.payload == \"off\") return [msg,null];\n        }\n    }\n    \n    if (motor_ui) {\n        if (msg.payload.entity_id == motor_ui)  {\n            msg.payload = msg.payload.event.new_state.state;\n            if (msg.payload == \"off\") return [null,msg];\n        }\n    }\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":135,"y":515,"wires":[["8dd945c5.bd23f8"],["d91513f6.cd88f"]]},{"id":"d91513f6.cd88f","type":"api-current-state","z":"4ebd89af.8412c8","name":"if motor on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.motor}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":325,"y":555,"wires":[["36acb8c5.8adca8"],[]]},{"id":"8dd945c5.bd23f8","type":"api-current-state","z":"4ebd89af.8412c8","name":"if motor UI on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.motor_ui}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":335,"y":515,"wires":[["36acb8c5.8adca8"],[]]},{"id":"36acb8c5.8adca8","type":"change","z":"4ebd89af.8412c8","name":"STOP","rules":[{"t":"set","p":"payload","pt":"msg","to":"STOP","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":565,"y":450,"wires":[["ad995a8d.24a338"]]},{"id":"b9762004.4d8b4","type":"api-call-service","z":"4ebd89af.8412c8","name":"motor on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.motor}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":535,"y":290,"wires":[[]]},{"id":"70b99fff.55c85","type":"api-call-service","z":"4ebd89af.8412c8","name":"turn down motor controller","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.motor}}"],"data":"{\"brightness_pct\":  0}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":795,"y":350,"wires":[["2c8c9731.403788"]]},{"id":"b10ce8f1.d55af8","type":"function","z":"4ebd89af.8412c8","name":"dim 0%","func":"msg.payload = {\"data\":{\"brightness_pct\":  0}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":575,"y":350,"wires":[["70b99fff.55c85"]]},{"id":"5b64789.00ea988","type":"subflow:71a3fd81.9edc14","z":"4ebd89af.8412c8","name":"","x":827,"y":470,"wires":[]},{"id":"2c8c9731.403788","type":"function","z":"4ebd89af.8412c8","name":"Motor cycle is complete!","func":"let motor = flow.get(\"motor\")\n\nmsg.payload = `${motor.replace(\"light.blue_\",\"\")} cycle is complete!`\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":805,"y":410,"wires":[["5b64789.00ea988","ba79af26.cc5c6"]]},{"id":"ba79af26.cc5c6","type":"api-current-state","z":"4ebd89af.8412c8","name":"if motor UI on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.motor_ui}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1045,"y":410,"wires":[["12eb9f09.2aecf1"],[]]},{"id":"12eb9f09.2aecf1","type":"api-call-service","z":"4ebd89af.8412c8","name":"turn motor UI off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.motor_ui}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1092,"y":470,"wires":[[]]},{"id":"aedd880c.f0fb48","type":"function","z":"4ebd89af.8412c8","name":"motor_ui is on","func":"if (msg.payload.hasOwnProperty(\"entity_id\")) {\n\n    let motor_ui = flow.get(\"motor_ui\");\n\n    if (motor_ui) {\n        if (msg.payload.entity_id == motor_ui)  {\n            msg.payload = msg.payload.event.new_state.state;\n            if (msg.payload == \"on\") {\n                flow.set('run_seconds', -1);\n                let calibrate = flow.get(\"calibrate\");\n                let ml = flow.get(\"ml\");\n                let sec = ml * calibrate;\n                \n                msg.payload = {\n                    \"payload\": \"on\",\n                    \"timeout\": sec,\n                    \"warning\": 0\n                }\n\n                return msg;\n            }\n        }\n    }\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":155,"y":320,"wires":[["ad995a8d.24a338","6133bffb.cee5a"]]},{"id":"3276751d.4e01da","type":"function","z":"4ebd89af.8412c8","d":true,"name":"test","func":"let calibrate = flow.get(\"calibrate\");\nlet ml = flow.get(\"ml\");\nlet sec = ml * calibrate;\n\nmsg.payload = `calibrate = ${calibrate}, ml = ${ml}, sec = ${sec}`\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":785,"y":150,"wires":[[]]},{"id":"6133bffb.cee5a","type":"function","z":"4ebd89af.8412c8","name":"turn motor on","func":"msg.payload = {\"data\":{\"brightness_pct\":  100}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":375,"y":290,"wires":[["b9762004.4d8b4"]]},{"id":"eeb9737c.0a66d","type":"function","z":"4ebd89af.8412c8","name":"update ml or calibrate","func":"if (msg.payload.hasOwnProperty(\"entity_id\")) {\n\n    let motor_ml = flow.get(\"motor_ml\");\n    let motor_calibrate = flow.get(\"motor_calibrate\");\n    \n    if (msg.payload.entity_id == motor_ml) {\n        let new_ml = parseFloat(msg.payload.event.new_state.state);\n        flow.set(\"ml\", new_ml)\n    }\n    \n    if (msg.payload.entity_id == motor_calibrate) {\n        let new_calibrate = parseFloat(msg.payload.event.new_state.state);\n        flow.set(\"calibrate\", new_calibrate)\n    }\n    \n}\n","outputs":0,"noerr":0,"initialize":"","finalize":"","x":354,"y":429,"wires":[]},{"id":"8930e60d.eba9f8","type":"function","z":"4ebd89af.8412c8","name":"track seconds & report ml","func":"let calibrate = flow.get(\"calibrate\");\n\nlet run_seconds = flow.get(\"run_seconds\");\nrun_seconds++;\nflow.set(\"run_seconds\", run_seconds);\n\nlet cur_ml = run_seconds * calibrate;\n\nmsg.payload = cur_ml;\n\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":625,"y":590,"wires":[[]]},{"id":"58bc1586.c827fc","type":"api-current-state","z":"b51b88cb.e159d8","name":"if fan off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fan}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":500,"y":400,"wires":[["52e203da.4c4bec"],[]]},{"id":"e4b563e8.22e0b","type":"api-current-state","z":"b51b88cb.e159d8","name":"if fan on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fan}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":500,"y":520,"wires":[["5a98a9cd.c86a88"],[]]},{"id":"5a98a9cd.c86a88","type":"api-call-service","z":"b51b88cb.e159d8","name":"set fan state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":660,"y":520,"wires":[[]]},{"id":"52e203da.4c4bec","type":"api-call-service","z":"b51b88cb.e159d8","name":"set fan state on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":660,"y":399,"wires":[[]]},{"id":"3009b671.b626da","type":"function","z":"b51b88cb.e159d8","name":"create humidity message","func":"let humidity = flow.get(\"humidity_sensor\");\nmsg.payload = `${humidity} Humidity is ${msg.payload}`\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":755,"y":460,"wires":[["364cc2c5.d0651e"]]},{"id":"222b0882.5eed98","type":"function","z":"b51b88cb.e159d8","name":"Humidity is above 65 \\n Humidity is 65 - 61 \\n Humidity is below 61","func":"\nif (msg.payload > 65)\n    return [msg, null, null];\nelse if (msg.payload <= 65 && msg.payload >= 61)\n    return [null, msg, null];\nelse if (msg.payload < 61)\n    return [null, null, msg];\n    \n/*\nabove 70\n\n70-65\n65-60\n60-55\n\nbelow 55\n\n\n*/","outputs":3,"noerr":0,"initialize":"","finalize":"","x":200,"y":460,"wires":[["58bc1586.c827fc","76e4b8ca.153988"],["e4b563e8.22e0b"],["e4b563e8.22e0b","76e4b8ca.153988"]]},{"id":"76e4b8ca.153988","type":"subflow:d3e83ea9.c31f8","z":"b51b88cb.e159d8","name":"","env":[],"x":530,"y":460,"wires":[["3009b671.b626da"]]},{"id":"364cc2c5.d0651e","type":"subflow:71a3fd81.9edc14","z":"b51b88cb.e159d8","name":"","x":981,"y":460,"wires":[]},{"id":"bd60097.f0df7f8","type":"function","z":"b51b88cb.e159d8","name":"flow - burp interval check","func":"//if (flow.get(\"onetime\")) return msg;\n\nconst flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));\n\nflowParent(\"humidity_sensor\");\nflowParent(\"fan\");\nflowParent(\"runminutes\");\n\n//flow.set(\"onetime\", true);\n\n\nconst today = new Date();\nlet curHour = today.getHours(); //hour of day\nlet curMinute = today.getMinutes(); //minute of hour\n\nlet runminutes = flow.get(\"runminutes\");\n//msg.payload=`curHour:${curHour},runminutes:${runminutes}`;\n//return [msg, null]; //TESTING\n\n// 3 per day (70%-65% RH)\nif ((curHour == 0 || curHour == 8 || curHour == 16) && runminutes > curMinute)\n    return [msg, null];\nelse\n    return [null, msg];\n\n/*\n// 1 per week (1st month)\nlet curDayWeek = today.getDay(); //day of week, 0=sunday\nif (curDayWeek==0 && curHour==0 && runminutes > curMinute)\n    return [msg, null];\nelse\n    return [null, msg];\n\n// 1 per month (after 1st month)\nlet curDayMonth = today.getDate(); //day of month, 0=jan\nif (curDayMonth==0 && curHour==0 && runminutes > curMinute)\n    return [msg, null];\nelse\n    return [null, msg];\n*/\n\n//return msg;","outputs":2,"noerr":0,"initialize":"","finalize":"","x":210,"y":80,"wires":[["eca779a2.8ea2f8","48ea9208.87ad4c"],["ca01e237.fd87d","c6a8dbbb.cc10b8"]]},{"id":"eca779a2.8ea2f8","type":"api-current-state","z":"b51b88cb.e159d8","name":"get humidity","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"num","halt_if_compare":"lte","entity_id":"{{flow.humidity_sensor}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":430,"y":80,"wires":[["3d4537b5.2b34c8"]]},{"id":"3d4537b5.2b34c8","type":"function","z":"b51b88cb.e159d8","name":"humidity above 57 \\n Humidity is below 57","func":"\nif (msg.payload > 57)\n    return [msg, null];\nelse \n    return [null, msg];\n    \n/*\nabove 70\n\n70-65\n65-60\n60-55\n\nbelow 55\n\n\n*/","outputs":2,"noerr":0,"initialize":"","finalize":"","x":680,"y":100,"wires":[["58bc1586.c827fc","b9ac5df2.9f0a4"],["e4b563e8.22e0b","76e4b8ca.153988","41b159ae.332668"]]},{"id":"ca01e237.fd87d","type":"api-current-state","z":"b51b88cb.e159d8","name":"get humidity","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"num","halt_if_compare":"lte","entity_id":"{{flow.humidity_sensor}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":430,"y":120,"wires":[["222b0882.5eed98"]]},{"id":"48ea9208.87ad4c","type":"debug","z":"b51b88cb.e159d8","d":true,"name":"interval time hit","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":440,"y":20,"wires":[]},{"id":"b9ac5df2.9f0a4","type":"debug","z":"b51b88cb.e159d8","d":true,"name":"interval - run cycle","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":930,"y":80,"wires":[]},{"id":"41b159ae.332668","type":"debug","z":"b51b88cb.e159d8","d":true,"name":"interval don't run hum under 58","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":970,"y":120,"wires":[]},{"id":"c6a8dbbb.cc10b8","type":"debug","z":"b51b88cb.e159d8","d":true,"name":"non-interval minute check","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":470,"y":180,"wires":[]},{"id":"f6e2d9db.d06cd8","type":"api-current-state","z":"6c886e85.15e09","name":"if heater off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.heater}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":889,"y":68,"wires":[["dd6a6f17.ab0d4"],[]]},{"id":"d5cbdac1.ba4718","type":"api-current-state","z":"6c886e85.15e09","name":"if heater on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.heater}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":889,"y":128,"wires":[["8365a57a.fc8468"],[]]},{"id":"8365a57a.fc8468","type":"api-call-service","z":"6c886e85.15e09","name":"set heater state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.heater}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1073,"y":128,"wires":[[]]},{"id":"dd6a6f17.ab0d4","type":"api-call-service","z":"6c886e85.15e09","name":"set heater state on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.heater}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1070,"y":68,"wires":[[]]},{"id":"941c8bbb.fa0038","type":"function","z":"6c886e85.15e09","name":"get flow for temperature interval check","func":"const flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));\n\nflowParent(\"temperature_sensor\");\nflowParent(\"heater\");\nflowParent(\"temperature\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":207,"y":88,"wires":[["506aa32b.bcf6ec"]]},{"id":"506aa32b.bcf6ec","type":"api-current-state","z":"6c886e85.15e09","name":"get temperature","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"num","halt_if_compare":"lte","entity_id":"{{flow.temperature_sensor}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":458,"y":88,"wires":[["ab90f9e.93d1308"]]},{"id":"ab90f9e.93d1308","type":"function","z":"6c886e85.15e09","name":"if below flow.temperature","func":"let temperature = flow.get(\"temperature\");\n\nif (msg.payload < temperature)\n    return [msg, null];\nelse \n    return [null, msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":669,"y":88,"wires":[["f6e2d9db.d06cd8"],["d5cbdac1.ba4718"]]},{"id":"75bba371.d11a3c","type":"api-current-state","z":"8d8ea42f.7508f8","name":"if fan off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fan}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":460,"y":420,"wires":[["e453cfef.cf10b"],[]]},{"id":"9df3d687.16a898","type":"api-current-state","z":"8d8ea42f.7508f8","name":"if fan on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fan}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":460,"y":540,"wires":[["8e79a2cc.d4ccd"],[]]},{"id":"8e79a2cc.d4ccd","type":"api-call-service","z":"8d8ea42f.7508f8","name":"set fan state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":620,"y":540,"wires":[[]]},{"id":"e453cfef.cf10b","type":"api-call-service","z":"8d8ea42f.7508f8","name":"set fan state on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":620,"y":419,"wires":[[]]},{"id":"d3ab7373.2eab8","type":"function","z":"8d8ea42f.7508f8","name":"create humidity message","func":"let humidity = flow.get(\"humidity_sensor\");\nmsg.payload = `${humidity} Humidity is ${msg.payload}`\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":715,"y":480,"wires":[["797a9c2f.e24b74"]]},{"id":"b4534507.a37158","type":"function","z":"8d8ea42f.7508f8","name":"Humidity is above 65 \\n Humidity is 65 - 61 \\n Humidity is below 61","func":"\nif (msg.payload > 65)\n    return [msg, null, null];\nelse if (msg.payload <= 65 && msg.payload >= 61)\n    return [null, msg, null];\nelse if (msg.payload < 61)\n    return [null, null, msg];\n    \n/*\nabove 70\n\n70-65\n65-60\n60-55\n\nbelow 55\n\n\n*/","outputs":3,"noerr":0,"initialize":"","finalize":"","x":160,"y":480,"wires":[["75bba371.d11a3c","da840d7b.1d8da"],["9df3d687.16a898"],["9df3d687.16a898","da840d7b.1d8da"]]},{"id":"da840d7b.1d8da","type":"subflow:d3e83ea9.c31f8","z":"8d8ea42f.7508f8","name":"","env":[],"x":490,"y":480,"wires":[["d3ab7373.2eab8"]]},{"id":"797a9c2f.e24b74","type":"subflow:71a3fd81.9edc14","z":"8d8ea42f.7508f8","name":"","x":941,"y":480,"wires":[]},{"id":"40c815c7.2ce2cc","type":"function","z":"8d8ea42f.7508f8","name":"flow - burp interval check","func":"//if (flow.get(\"onetime\")) return msg;\n\nconst flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));\n\nflowParent(\"humidity_sensor\");\nflowParent(\"fan\");\nflowParent(\"runminutes\");\n\n//flow.set(\"onetime\", true);\n\n\nconst today = new Date();\nlet curHour = today.getHours(); //hour of day\nlet curMinute = today.getMinutes(); //minute of hour\n\nlet runminutes = flow.get(\"runminutes\");\n//msg.payload=`curHour:${curHour},runminutes:${runminutes}`;\n//return [msg, null]; //TESTING\n\n// 1 per week (1st month)\nlet curDayWeek = today.getDay(); //day of week, 0=sunday\nif (curDayWeek==0 && curHour==0 && runminutes > curMinute)\n    return [msg, null];\nelse\n    return [null, msg];\n\n/*\n// 1 per week (1st month)\nlet curDayWeek = today.getDay(); //day of week, 0=sunday\nif (curDayWeek==0 && curHour==0 && runminutes > curMinute)\n    return [msg, null];\nelse\n    return [null, msg];\n\n// 1 per month (after 1st month)\nlet curDayMonth = today.getDate(); //day of month, 0=jan\nif (curDayMonth==0 && curHour==0 && runminutes > curMinute)\n    return [msg, null];\nelse\n    return [null, msg];\n*/\n\n//return msg;","outputs":2,"noerr":0,"initialize":"","finalize":"","x":170,"y":100,"wires":[["c2a129f6.64d878","f0bd50c8.c7142"],["4a0f0ead.459cd","f1242b0c.a8e2f8"]]},{"id":"c2a129f6.64d878","type":"api-current-state","z":"8d8ea42f.7508f8","name":"get humidity","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"num","halt_if_compare":"lte","entity_id":"{{flow.humidity_sensor}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":390,"y":100,"wires":[["dee9fcb9.22191"]]},{"id":"dee9fcb9.22191","type":"function","z":"8d8ea42f.7508f8","name":"humidity above 57 \\n Humidity is below 57","func":"\nif (msg.payload > 57)\n    return [msg, null];\nelse \n    return [null, msg];\n    \n/*\nabove 70\n\n70-65\n65-60\n60-55\n\nbelow 55\n\n\n*/","outputs":2,"noerr":0,"initialize":"","finalize":"","x":640,"y":120,"wires":[["75bba371.d11a3c","b22b9411.810288"],["9df3d687.16a898","da840d7b.1d8da","c542870f.e382d8"]]},{"id":"4a0f0ead.459cd","type":"api-current-state","z":"8d8ea42f.7508f8","name":"get humidity","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"num","halt_if_compare":"lte","entity_id":"{{flow.humidity_sensor}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":390,"y":140,"wires":[["b4534507.a37158"]]},{"id":"f0bd50c8.c7142","type":"debug","z":"8d8ea42f.7508f8","d":true,"name":"interval time hit","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":400,"y":40,"wires":[]},{"id":"b22b9411.810288","type":"debug","z":"8d8ea42f.7508f8","d":true,"name":"interval - run cycle","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":890,"y":100,"wires":[]},{"id":"c542870f.e382d8","type":"debug","z":"8d8ea42f.7508f8","d":true,"name":"interval don't run hum under 58","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":930,"y":140,"wires":[]},{"id":"f1242b0c.a8e2f8","type":"debug","z":"8d8ea42f.7508f8","d":true,"name":"non-interval minute check","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":430,"y":200,"wires":[]},{"id":"e7a06506.6d39e8","type":"api-current-state","z":"660afba2.b674a4","name":"if fan off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fan}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":460,"y":420,"wires":[["7b5c3e6b.9ab5d"],[]]},{"id":"cdc8557f.be67a8","type":"api-current-state","z":"660afba2.b674a4","name":"if fan on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fan}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":460,"y":540,"wires":[["831f4553.6ba108"],[]]},{"id":"831f4553.6ba108","type":"api-call-service","z":"660afba2.b674a4","name":"set fan state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":620,"y":540,"wires":[[]]},{"id":"7b5c3e6b.9ab5d","type":"api-call-service","z":"660afba2.b674a4","name":"set fan state on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":620,"y":419,"wires":[[]]},{"id":"d890a841.cecdd8","type":"function","z":"660afba2.b674a4","name":"create humidity message","func":"let humidity = flow.get(\"humidity_sensor\");\nmsg.payload = `${humidity} Humidity is ${msg.payload}`\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":715,"y":480,"wires":[["853fa505.a9fad8"]]},{"id":"a16f4a05.a5aca8","type":"function","z":"660afba2.b674a4","name":"Humidity is above 65 \\n Humidity is 65 - 61 \\n Humidity is below 61","func":"\nif (msg.payload > 65)\n    return [msg, null, null];\nelse if (msg.payload <= 65 && msg.payload >= 61)\n    return [null, msg, null];\nelse if (msg.payload < 61)\n    return [null, null, msg];\n    \n/*\nabove 70\n\n70-65\n65-60\n60-55\n\nbelow 55\n\n\n*/","outputs":3,"noerr":0,"initialize":"","finalize":"","x":160,"y":480,"wires":[["e7a06506.6d39e8","a6c771be.ca96e"],["cdc8557f.be67a8"],["cdc8557f.be67a8","a6c771be.ca96e"]]},{"id":"a6c771be.ca96e","type":"subflow:d3e83ea9.c31f8","z":"660afba2.b674a4","name":"","env":[],"x":490,"y":480,"wires":[["d890a841.cecdd8"]]},{"id":"853fa505.a9fad8","type":"subflow:71a3fd81.9edc14","z":"660afba2.b674a4","name":"","x":941,"y":480,"wires":[]},{"id":"39bcda35.4e81c6","type":"function","z":"660afba2.b674a4","name":"flow - burp interval check","func":"//if (flow.get(\"onetime\")) return msg;\n\nconst flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));\n\nflowParent(\"humidity_sensor\");\nflowParent(\"fan\");\nflowParent(\"runminutes\");\n\n//flow.set(\"onetime\", true);\n\n\nconst today = new Date();\nlet curHour = today.getHours(); //hour of day\nlet curMinute = today.getMinutes(); //minute of hour\n\nlet runminutes = flow.get(\"runminutes\");\n\n\n// 1 per month (after 1st month)\nlet curDayMonth = today.getDate(); //day of month, 0=jan\nif (curDayMonth==0 && curHour==0 && runminutes > curMinute)\n    return [msg, null];\nelse\n    return [null, msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":170,"y":100,"wires":[["6351a7c0.41bbd8","977737da.8044e8"],["4a651033.1050d","2dd50cea.638634"]]},{"id":"6351a7c0.41bbd8","type":"api-current-state","z":"660afba2.b674a4","name":"get humidity","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"num","halt_if_compare":"lte","entity_id":"{{flow.humidity_sensor}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":390,"y":100,"wires":[["3019c4d6.b90e9c"]]},{"id":"3019c4d6.b90e9c","type":"function","z":"660afba2.b674a4","name":"humidity above 57 \\n Humidity is below 57","func":"\nif (msg.payload > 57)\n    return [msg, null];\nelse \n    return [null, msg];\n    \n/*\nabove 70\n\n70-65\n65-60\n60-55\n\nbelow 55\n\n\n*/","outputs":2,"noerr":0,"initialize":"","finalize":"","x":640,"y":120,"wires":[["e7a06506.6d39e8","e4dbfa73.ae8a68"],["cdc8557f.be67a8","a6c771be.ca96e","bdc6779d.174138"]]},{"id":"4a651033.1050d","type":"api-current-state","z":"660afba2.b674a4","name":"get humidity","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"num","halt_if_compare":"lte","entity_id":"{{flow.humidity_sensor}}","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":390,"y":140,"wires":[["a16f4a05.a5aca8"]]},{"id":"977737da.8044e8","type":"debug","z":"660afba2.b674a4","d":true,"name":"interval time hit","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":400,"y":40,"wires":[]},{"id":"e4dbfa73.ae8a68","type":"debug","z":"660afba2.b674a4","d":true,"name":"interval - run cycle","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":890,"y":100,"wires":[]},{"id":"bdc6779d.174138","type":"debug","z":"660afba2.b674a4","d":true,"name":"interval don't run hum under 58","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":930,"y":140,"wires":[]},{"id":"2dd50cea.638634","type":"debug","z":"660afba2.b674a4","d":true,"name":"non-interval minute check","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":430,"y":200,"wires":[]},{"id":"b42d3f779238d3e3","type":"function","z":"4433b13830f60388","name":"5 seconds","func":"const getCurEpoch = () => {\n\tlet now = new Date()  \n\tlet secondsSinceEpoch = Math.round(now.getTime() / 1000);\n\t//let minsSinceEpoch = Math.floor(secondsSinceEpoch/60);\n\t//let hoursSinceEpoch = Math.floor(minsSinceEpoch/60);\n\treturn secondsSinceEpoch;\n\t\n\t//return hoursSinceEpoch;\n\t\n\t//test with minutes\n\t//return minsSinceEpoch; \n}\nconst set5secondIgnore = () => {\n\tlet secondsSinceEpoch = getCurEpoch();\n\tflow.set(\"ignoreUntil\", (secondsSinceEpoch + 5));\n\t\n\t//test\n\t//flow.set(\"ignoreUntil\", (hoursSinceEpoch + 5)); \n}\n\nlet ignoreUntil = flow.get(\"ignoreUntil\");\n\nlet cont = true;\n\nif (ignoreUntil) {\n\tlet hoursSinceEpoch = getCurEpoch();\n\tif (hoursSinceEpoch < ignoreUntil) cont = false;\n}\n\nif (cont) set5secondIgnore();\nif (cont) return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":100,"wires":[["82317b4abc1e9d45"]]},{"id":"82317b4abc1e9d45","type":"function","z":"4433b13830f60388","name":"get payload from flow","func":"msg.payload = flow.get(\"input_payload\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":520,"y":180,"wires":[[]]},{"id":"0f10655824506436","type":"function","z":"4433b13830f60388","name":"set payload to flow","func":"flow.set(\"input_payload\", msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":150,"y":177,"wires":[["b42d3f779238d3e3"]]},{"id":"f72c42389e1df204","type":"function","z":"17a9545b4d27ba64","name":"Set DrivewayLightsOnUntil To 5 Min From Now","func":"const getCurEpoch = () => {\n\tlet now = new Date()  \n\tlet secondsSinceEpoch = Math.round(now.getTime() / 1000);\n\tlet minsSinceEpoch = Math.floor(secondsSinceEpoch/60);\n\t\n\t//let hoursSinceEpoch = Math.floor(minsSinceEpoch/60);\n\t//return secondsSinceEpoch;\n\t//return hoursSinceEpoch;\n\treturn minsSinceEpoch; \n}\nconst setFlowTo5minutesAhead = (currentMinutes) => {\n\tflow.set(\"DrivewayLightsOnUntil\", (currentMinutes + 5)); \n}\n\nlet curMin = getCurEpoch();\nsetFlowTo5minutesAhead(curMin);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":60,"wires":[["720765959dd0f51a"]]},{"id":"720765959dd0f51a","type":"function","z":"17a9545b4d27ba64","name":"get payload from flow","func":"msg.payload = flow.get(\"input_payload\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":540,"y":160,"wires":[[]]},{"id":"353af35d51481cfe","type":"function","z":"17a9545b4d27ba64","name":"set payload to flow","func":"flow.set(\"input_payload\", msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":170,"y":157,"wires":[["f72c42389e1df204"]]},{"id":"7f64ecc7a0cff430","type":"function","z":"dd868e2fe1910714","name":"","func":"const getCurEpoch = () => {\n\tlet now = new Date()  \n\tlet secondsSinceEpoch = Math.round(now.getTime() / 1000);\n\tlet minsSinceEpoch = Math.floor(secondsSinceEpoch/60);\n\tlet hoursSinceEpoch = Math.floor(minsSinceEpoch/60);\n\treturn hoursSinceEpoch;\n\t\n\t//test with minutes\n\t//return minsSinceEpoch; \n}\nconst setHoursIgnore = () => {\n\tlet hoursSinceEpoch = getCurEpoch();\n\tflow.set(\"ignoreUntil\", (hoursSinceEpoch + 4));\n\t\n\t//test\n\t//flow.set(\"ignoreUntil\", (hoursSinceEpoch + 5)); \n}\n\nlet ignoreUntil = flow.get(\"ignoreUntil\");\n\nlet cont = true;\n\nif (ignoreUntil) {\n\tlet hoursSinceEpoch = getCurEpoch();\n\tif (hoursSinceEpoch < ignoreUntil) cont = false;\n}\n\nif (cont) setHoursIgnore();\nif (cont) return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":40,"wires":[["b002673780321e7c"]]},{"id":"b002673780321e7c","type":"function","z":"dd868e2fe1910714","name":"get payload from flow","func":"msg.payload = flow.get(\"input_payload\");\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":80,"wires":[[]]},{"id":"f6ce9014b91e3fa9","type":"function","z":"dd868e2fe1910714","name":"set payload to flow","func":"flow.set(\"input_payload\", msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":190,"y":80,"wires":[["7f64ecc7a0cff430"]]},{"id":"ac476e5.48d409","type":"sunrise","z":"2df3f8ea.1119b8","name":"sunrise to 45min before sunset start","lat":"38.810937","lon":"-77.155829","start":"sunrise","end":"sunsetStart","soff":"0","eoff":"-45","x":140,"y":300,"wires":[[],["f38588ad.0f23a8"]]},{"id":"a8fd66ed.4ab978","type":"api-current-state","z":"2df3f8ea.1119b8","name":"if LED power on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.bathroom_led_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":680,"y":280,"wires":[["ea0e134b.5f1a7"],[]]},{"id":"ea0e134b.5f1a7","type":"api-call-service","z":"2df3f8ea.1119b8","name":"set LED power off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.bathroom_led_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":730,"y":326,"wires":[[]]},{"id":"f38588ad.0f23a8","type":"switch","z":"2df3f8ea.1119b8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":300,"wires":[[],["a8fd66ed.4ab978"]]},{"id":"f8b1a752.167c68","type":"alexa-home","z":"2df3f8ea.1119b8","conf":"69543e7577c6ab2b","device":"114742","acknoledge":true,"name":"Bathroom LED","topic":"","x":120,"y":180,"wires":[["fd9a4fa2.1022e"]]},{"id":"fd9a4fa2.1022e","type":"switch","z":"2df3f8ea.1119b8","name":"","property":"command","propertyType":"msg","rules":[{"t":"eq","v":"TurnOnRequest","vt":"str"},{"t":"eq","v":"TurnOffRequest","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":180,"wires":[["a199c559.de9348"],["a8fd66ed.4ab978","215e5206.6bb28e"]]},{"id":"f44fa29b.f76f9","type":"server-state-changed","z":"2df3f8ea.1119b8","name":"shower fan turned on","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.shower_fan_switch","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":140,"y":659,"wires":[["6dd4aa69.602034"],[]]},{"id":"6dd4aa69.602034","type":"delay","z":"2df3f8ea.1119b8","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":355,"y":652,"wires":[["3d98b8d7.d42f88"]]},{"id":"3d98b8d7.d42f88","type":"api-call-service","z":"2df3f8ea.1119b8","name":"turn off fan","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.shower_fan_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":535,"y":653,"wires":[[]]},{"id":"f50f61a3.d4401","type":"alexa-home","z":"2df3f8ea.1119b8","conf":"69543e7577c6ab2b","device":"114858","acknoledge":true,"name":"Shower Fan","topic":"","x":110,"y":472,"wires":[["48478416.cfb66c"]]},{"id":"fa639aa6.0ccef8","type":"api-current-state","z":"2df3f8ea.1119b8","name":"if shower fan on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.shower_fan_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":543,"y":522,"wires":[["a4c28139.540b3"],[]]},{"id":"c2dd612a.e5f97","type":"api-call-service","z":"2df3f8ea.1119b8","name":"set shower fan on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.shower_fan_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":583,"y":469,"wires":[[]]},{"id":"a4c28139.540b3","type":"api-call-service","z":"2df3f8ea.1119b8","name":"set shower fan off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.shower_fan_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":587,"y":569,"wires":[[]]},{"id":"a4dc4385.e2452","type":"api-current-state","z":"2df3f8ea.1119b8","name":"if shower fan off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.shower_fan_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":543,"y":422,"wires":[["c2dd612a.e5f97"],[]]},{"id":"48478416.cfb66c","type":"switch","z":"2df3f8ea.1119b8","name":"","property":"command","propertyType":"msg","rules":[{"t":"eq","v":"TurnOnRequest","vt":"str"},{"t":"eq","v":"TurnOffRequest","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":347,"y":471,"wires":[["a4dc4385.e2452"],["fa639aa6.0ccef8"]]},{"id":"e757c608.7d9418","type":"api-call-service","z":"2df3f8ea.1119b8","name":"set LED power on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.bathroom_led_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":730,"y":225,"wires":[[]]},{"id":"a199c559.de9348","type":"api-current-state","z":"2df3f8ea.1119b8","name":"if LED power off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.bathroom_led_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":680,"y":180,"wires":[["e757c608.7d9418"],[]]},{"id":"ef857b1e.d540a8","type":"server-state-changed","z":"2df3f8ea.1119b8","name":"hibiscus soil mositure 55 or under","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.moisture3_3","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"55.0","halt_if_type":"num","halt_if_compare":"lte","output_only_on_state_change":true,"x":190,"y":820,"wires":[["1b7f5886.f1a987"],[]]},{"id":"1b7f5886.f1a987","type":"subflow:f2f2edc5.b030a","z":"2df3f8ea.1119b8","name":"","x":460,"y":820,"wires":[["36e8146d.62e81c"]]},{"id":"36e8146d.62e81c","type":"function","z":"2df3f8ea.1119b8","name":"Hibiscus Tree Needs Water","func":"msg.payload = `Hibiscus Tree Needs Water`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":700,"y":820,"wires":[["161a4f47.e329a1"]]},{"id":"161a4f47.e329a1","type":"subflow:71a3fd81.9edc14","z":"2df3f8ea.1119b8","name":"","x":752,"y":880,"wires":[]},{"id":"cb545ff0.daae","type":"nighttime","z":"2df3f8ea.1119b8","name":"sunset","lon":"-77.155829","lat":"38.810937","start":"sunrise","end":"sunsetStart","x":310,"y":340,"wires":[[],["bb5f4b98a66db2f0"]]},{"id":"d21380e5.bd062","type":"inject","z":"2df3f8ea.1119b8","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":40,"wires":[["2f291263.be7a8e","5d2a508c64a5548d","32f6465bd36ff7dd"]]},{"id":"2f291263.be7a8e","type":"function","z":"2df3f8ea.1119b8","name":"Continue if DayTime","func":"if (!global.get(\"isNight\")) return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":320,"y":60,"wires":[["6bd3172e.682358"]]},{"id":"6bd3172e.682358","type":"debug","z":"2df3f8ea.1119b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":530,"y":60,"wires":[]},{"id":"215e5206.6bb28e","type":"delay","z":"2df3f8ea.1119b8","name":"","pauseType":"delay","timeout":"35","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":585,"y":115,"wires":[["6c72d065.eb267"]]},{"id":"6c72d065.eb267","type":"function","z":"2df3f8ea.1119b8","name":"Continue if DayTime","func":"if (!global.get(\"isNight\")) return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":775,"y":115,"wires":[["a199c559.de9348"]]},{"id":"bb5f4b98a66db2f0","type":"function","z":"2df3f8ea.1119b8","name":"Continue only on sunset","func":"if (msg.payload) return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":490,"y":360,"wires":[["a8fd66ed.4ab978"]]},{"id":"9ccd1df6acd4aa3d","type":"sunrise","z":"2df3f8ea.1119b8","name":"sunrise to 5hrs & 15min after sunset start","lat":"38.810937","lon":"-77.155829","start":"sunrise","end":"sunsetStart","soff":"0","eoff":"315","x":160,"y":260,"wires":[[],["294b3372632881d4"]]},{"id":"294b3372632881d4","type":"switch","z":"2df3f8ea.1119b8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":450,"y":260,"wires":[[],["a199c559.de9348"]]},{"id":"5d2a508c64a5548d","type":"debug","z":"2df3f8ea.1119b8","name":"debug 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":200,"y":100,"wires":[]},{"id":"33316b54b9a8ee23","type":"debug","z":"2df3f8ea.1119b8","name":"debug 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":220,"y":140,"wires":[]},{"id":"32f6465bd36ff7dd","type":"delay","z":"2df3f8ea.1119b8","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":80,"y":140,"wires":[["33316b54b9a8ee23"]]},{"id":"4831706.a4d239","type":"server-state-changed","z":"2fd92f64.30df","name":"temp above 78","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.blue_multisensor_t_temperature_2","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"78","halt_if_type":"num","halt_if_compare":"gt","output_only_on_state_change":true,"x":80,"y":60,"wires":[["f8944cab.3b257"],["b997bc8b.479a6"]]},{"id":"f8944cab.3b257","type":"api-current-state","z":"2fd92f64.30df","name":"if fan off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":380,"y":120,"wires":[["a80d6f6b.938fc"],[]]},{"id":"b997bc8b.479a6","type":"api-current-state","z":"2fd92f64.30df","name":"if fan on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":120,"y":120,"wires":[["23e5bbbf.983b04"],[]]},{"id":"d332d92.439ed28","type":"switch","z":"2fd92f64.30df","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":300,"wires":[["e3f03f06.9980e"],[]]},{"id":"6a84c563.30270c","type":"sunrise","z":"2fd92f64.30df","name":"60 min before sunrise","lat":"38.810937","lon":"-77.155829","start":"sunrise","end":"sunsetStart","soff":"-60","eoff":"0","x":100,"y":300,"wires":[[],["d332d92.439ed28"]]},{"id":"e3f03f06.9980e","type":"api-current-state","z":"2fd92f64.30df","name":"if light off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch_3","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":440,"y":300,"wires":[["b88009fa.011c48"],[]]},{"id":"b88009fa.011c48","type":"api-call-service","z":"2fd92f64.30df","name":"set light,fan state on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch_3","switch.aeon_labs_dsc11_smart_strip_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":640,"y":300,"wires":[[]]},{"id":"542430.04501bd","type":"delay","z":"2fd92f64.30df","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":472,"y":620,"wires":[["318b4c47.0d4894","81a94895.beea18"]]},{"id":"f345c294.002c7","type":"alexa-home","z":"2fd92f64.30df","conf":"69543e7577c6ab2b","device":"118705","acknoledge":true,"name":"Tent Work Light","topic":"","x":80,"y":580,"wires":[["3c79a992.a299a6"]]},{"id":"3c79a992.a299a6","type":"switch","z":"2fd92f64.30df","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":232,"y":580,"wires":[["2eed8560.e30c4a","62e536be.e73898","542430.04501bd","ec8c59e7.068aa8"],["318b4c47.0d4894","81a94895.beea18"]]},{"id":"2eed8560.e30c4a","type":"api-call-service","z":"2fd92f64.30df","name":"wk lights on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch_4"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":472,"y":480,"wires":[[]]},{"id":"318b4c47.0d4894","type":"api-call-service","z":"2fd92f64.30df","name":"wk lights off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch_4"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":472,"y":700,"wires":[[]]},{"id":"81a94895.beea18","type":"api-call-service","z":"2fd92f64.30df","name":"t lights on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch_3"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":462,"y":740,"wires":[[]]},{"id":"62e536be.e73898","type":"api-call-service","z":"2fd92f64.30df","name":"t lights off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch_3"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":462,"y":540,"wires":[[]]},{"id":"3e1dd5d1.a00b4a","type":"delay","z":"2fd92f64.30df","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":762,"y":540,"wires":[["2eed8560.e30c4a"]]},{"id":"ec8c59e7.068aa8","type":"delay","z":"2fd92f64.30df","name":"","pauseType":"delay","timeout":"14","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":572,"y":580,"wires":[["1e6e454d.e4b62b"]]},{"id":"1e6e454d.e4b62b","type":"api-current-state","z":"2fd92f64.30df","name":"if wk light on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch_4","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":732,"y":580,"wires":[["318b4c47.0d4894","3e1dd5d1.a00b4a"],[]]},{"id":"23e5bbbf.983b04","type":"api-call-service","z":"2fd92f64.30df","name":"set fan state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":180,"y":180,"wires":[[]]},{"id":"a80d6f6b.938fc","type":"api-call-service","z":"2fd92f64.30df","name":"set fan state on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":440,"y":180,"wires":[[]]},{"id":"ae56248f.f4e658","type":"comment","z":"2fd92f64.30df","name":"turn t on in case it was turned off for sleeping","info":"","x":210,"y":260,"wires":[]},{"id":"567164ae.39aefc","type":"alexa-home","z":"2fd92f64.30df","conf":"69543e7577c6ab2b","device":"115547","acknoledge":true,"name":"Closet","topic":"","x":50,"y":360,"wires":[["9446db70.087e08"]]},{"id":"9446db70.087e08","type":"switch","z":"2fd92f64.30df","name":"","property":"command","propertyType":"msg","rules":[{"t":"eq","v":"TurnOnRequest","vt":"str"},{"t":"eq","v":"TurnOffRequest","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":360,"wires":[["e3f03f06.9980e"],["47ef425e.db4d7c"]]},{"id":"47ef425e.db4d7c","type":"api-current-state","z":"2fd92f64.30df","name":"if light on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch_3","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":440,"y":360,"wires":[["10149988.6abe46"],[]]},{"id":"10149988.6abe46","type":"api-call-service","z":"2fd92f64.30df","name":"set light,fan state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch_3","switch.aeon_labs_dsc11_smart_strip_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":640,"y":360,"wires":[[]]},{"id":"ca17eb83.857d28","type":"inject","z":"e37f810b.f6ef","name":"fake slider value","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":"3","topic":"","payload":"4","payloadType":"num","x":140,"y":1680,"wires":[["5a994770.15ecc8"]]},{"id":"d75c3518.b8f318","type":"debug","z":"e37f810b.f6ef","name":"FINAL DEBUG","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"blah","targetType":"msg","statusVal":"","statusType":"auto","x":720,"y":1760,"wires":[]},{"id":"6569b487.02f7fc","type":"server-state-changed","z":"e37f810b.f6ef","name":"slider","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":"0","forType":"num","forUnits":"minutes","outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_number.test_slider","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":90,"y":1460,"wires":[["5a994770.15ecc8","abe9703d.f242e"]]},{"id":"52767b3d.0be534","type":"delay","z":"e37f810b.f6ef","name":"","pauseType":"delayv","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":600,"y":1620,"wires":[["297ab5f7.61314a"]]},{"id":"5a994770.15ecc8","type":"change","z":"e37f810b.f6ef","name":"payload to delay","rules":[{"t":"move","p":"payload","pt":"msg","to":"delay","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":260,"y":1520,"wires":[["9132b6ba.f43698","3c7dcca7.b8ef44"]]},{"id":"9132b6ba.f43698","type":"debug","z":"e37f810b.f6ef","name":"capture changed slider","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"delay","targetType":"msg","statusVal":"","statusType":"auto","x":460,"y":1480,"wires":[]},{"id":"abe9703d.f242e","type":"debug","z":"e37f810b.f6ef","name":"slider results","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":250,"y":1400,"wires":[]},{"id":"3c7dcca7.b8ef44","type":"range","z":"e37f810b.f6ef","minin":"1","maxin":"100","minout":"1000","maxout":"100000","action":"scale","round":false,"property":"delay","name":"multiply by 1000","x":440,"y":1560,"wires":[["52767b3d.0be534"]]},{"id":"297ab5f7.61314a","type":"function","z":"e37f810b.f6ef","name":"","func":"msg.delay = msg.delay/1000;\nmsg.blah = `delay of ${msg.delay} seconds`;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":1700,"wires":[["d75c3518.b8f318"]]},{"id":"cfd1bab4.d6aee8","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":1100,"wires":[["edf2fedb.932db"]]},{"id":"572d7666.6c67e8","type":"debug","z":"e37f810b.f6ef","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":760,"y":1200,"wires":[]},{"id":"ed22e56c.529b38","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"group2","name":"inside hue","x":130,"y":1800,"wires":[]},{"id":"67cad812.d8b408","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"on\":true}","payloadType":"json","x":100,"y":1720,"wires":[["ed22e56c.529b38"]]},{"id":"4476879d.f98888","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"group1","name":"outside hue","x":470,"y":1800,"wires":[]},{"id":"cf50e5f.858b218","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"on\":false}","payloadType":"json","x":440,"y":1720,"wires":[["4476879d.f98888"]]},{"id":"edf2fedb.932db","type":"api-current-state","z":"e37f810b.f6ef","name":"","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.bathroom_dome_multisensor_temperature","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":530,"y":1100,"wires":[["572d7666.6c67e8"]]},{"id":"634efae7.c24c14","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"kelvin\":2700}","payloadType":"json","x":580,"y":1960,"wires":[["5102680a.990da8","70a746b.86f4eb8","a1fc78ce.eeac58","5c8bcad7.31c884","9a3f8539.e81f98","adf37e04.3b23f","ab0dd7fa.60b358","5ec91017.8d8f2","314f89e9.54c986","64f09f33.a9b6d"]]},{"id":"5102680a.990da8","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light4","name":"P Desk","x":800,"y":1940,"wires":[]},{"id":"70a746b.86f4eb8","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light6","name":"P Fish Tank","x":810,"y":2000,"wires":[]},{"id":"ab0dd7fa.60b358","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light9","name":"LR Couch","x":800,"y":2300,"wires":[]},{"id":"adf37e04.3b23f","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light3","name":"LR Fireplace","x":810,"y":2240,"wires":[]},{"id":"9a3f8539.e81f98","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light7","name":"LR Window","x":810,"y":2180,"wires":[]},{"id":"5c8bcad7.31c884","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light2","name":"Kitchen Corner","x":820,"y":2120,"wires":[]},{"id":"a1fc78ce.eeac58","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light5","name":"P Piano","x":800,"y":2060,"wires":[]},{"id":"64f09f33.a9b6d","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light9","name":"LR Couch","x":800,"y":2480,"wires":[]},{"id":"314f89e9.54c986","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light12","name":"LR Screened Porch","x":830,"y":2420,"wires":[]},{"id":"5ec91017.8d8f2","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light8","name":"LR Strip","x":800,"y":2360,"wires":[]},{"id":"602a261f.f8e638","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"kelvin\":2700}","payloadType":"json","x":100,"y":1980,"wires":[["ffd29182.639f3","1515cd16.c554c3","e89f5788.747468","26342f8a.19b19","a85e7b1.0443d88","e82e4b8f.463388","3aaca1a1.9c63fe","7381e92e.ffe6e8","bc0e7a18.9232f8","58b6552c.e1de2c"]]},{"id":"ffd29182.639f3","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light4","name":"P Desk","x":320,"y":1960,"wires":[]},{"id":"1515cd16.c554c3","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light6","name":"P Fish Tank","x":330,"y":2020,"wires":[]},{"id":"3aaca1a1.9c63fe","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light9","name":"LR Couch","x":320,"y":2320,"wires":[]},{"id":"e82e4b8f.463388","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light3","name":"LR Fireplace","x":330,"y":2260,"wires":[]},{"id":"a85e7b1.0443d88","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light7","name":"LR Window","x":330,"y":2200,"wires":[]},{"id":"26342f8a.19b19","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light2","name":"Kitchen Corner","x":340,"y":2140,"wires":[]},{"id":"e89f5788.747468","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light5","name":"P Piano","x":320,"y":2080,"wires":[]},{"id":"58b6552c.e1de2c","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light9","name":"LR Couch","x":320,"y":2500,"wires":[]},{"id":"bc0e7a18.9232f8","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light12","name":"LR Screened Porch","x":350,"y":2440,"wires":[]},{"id":"7381e92e.ffe6e8","type":"node-hue-in","z":"e37f810b.f6ef","server":"e5843571.d374f8","lightID":"light8","name":"LR Strip","x":320,"y":2380,"wires":[]},{"id":"e4de2656.bec748","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"kelvin\":2700 }","payloadType":"json","x":80,"y":2380,"wires":[["7381e92e.ffe6e8","58b6552c.e1de2c"]]},{"id":"896658e.f4f1ea8","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":1220,"wires":[["c73ee8a7.814078"]]},{"id":"e2acc047.9a281","type":"time-range-switch","z":"e37f810b.f6ef","name":"if sunset started or night","lat":"38.810770","lon":"-77.155803","startTime":"sunsetStart","endTime":"sunrise","startOffset":"0","endOffset":0,"x":230,"y":2760,"wires":[["b82d2457.fd0fa8"],["63430355.079d0c"]]},{"id":"715b339d.bddecc","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":90,"y":2660,"wires":[["e2acc047.9a281"]]},{"id":"b82d2457.fd0fa8","type":"debug","z":"e37f810b.f6ef","name":"on","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":580,"y":2740,"wires":[]},{"id":"63430355.079d0c","type":"debug","z":"e37f810b.f6ef","name":"off","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":620,"y":2820,"wires":[]},{"id":"a0b0e30f.f1dc8","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":2940,"wires":[["52fc64bc.e4835c"]]},{"id":"52fc64bc.e4835c","type":"api-current-state","z":"e37f810b.f6ef","name":"phone state","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.thomass_iphone_geocoded_location","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":90,"y":3000,"wires":[[]]},{"id":"506eb19e.ae9d","type":"api-current-state","z":"e37f810b.f6ef","name":"","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.BARA}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":350,"y":1280,"wires":[["5c79c2bc.e9ea2c"]]},{"id":"5c79c2bc.e9ea2c","type":"debug","z":"e37f810b.f6ef","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":580,"y":1260,"wires":[]},{"id":"c73ee8a7.814078","type":"subflow:1720b27f.e66bee","z":"e37f810b.f6ef","name":"","x":310,"y":1220,"wires":[["506eb19e.ae9d"]]},{"id":"549202e3.83df8c","type":"geofence","z":"e37f810b.f6ef","name":"Home","mode":"circle","inside":"true","rad":250.39900042393057,"points":[],"centre":{"latitude":38.81083918832511,"longitude":-77.15578280389308},"outputs":1,"x":650,"y":3200,"wires":[["20618765.0e2828"]]},{"id":"a416d4a0.ebf2e8","type":"api-current-state","z":"e37f810b.f6ef","name":"toms phone","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.thomass_iphone_geocoded_location","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":150,"y":3180,"wires":[["151155c2.a3c96a"]]},{"id":"20618765.0e2828","type":"debug","z":"e37f810b.f6ef","name":"phone_home","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":870,"y":3200,"wires":[]},{"id":"3e013898.ff6f98","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":3120,"wires":[["a416d4a0.ebf2e8"]]},{"id":"a2747a9e.1035a8","type":"debug","z":"e37f810b.f6ef","name":"phone_home","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":670,"y":3100,"wires":[]},{"id":"151155c2.a3c96a","type":"function","z":"e37f810b.f6ef","name":"","func":"if (!msg.data) return msg;\nmsg.payload = \"past data\"\nif (!msg.data.attributes) return msg;\nmsg.payload = \"past data.attributes\"\nif (!msg.data.attributes.Location) return msg;\nmsg.payload = \"past data.attributes.location\"\nif (msg.data.attributes.Location.length < 2) return msg;\n\n//msg.payload[\"lat\"] = msg.data.attributes.location[0];\n//msg.payload[\"lon\"] = msg.data.attributes.location[1];\n\nmsg.payload = { \"lat\":msg.data.attributes.Location[0],\n                \"lon\":msg.data.attributes.Location[1] };\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":3280,"wires":[["a2747a9e.1035a8","549202e3.83df8c"]]},{"id":"720be2e5.fe48bc","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1160,"wires":[["a770b8cc.f77a08"]]},{"id":"506fa186.0bde5","type":"debug","z":"e37f810b.f6ef","name":"tester","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":500,"y":1160,"wires":[]},{"id":"a770b8cc.f77a08","type":"subflow:5b1d81d3.fab27","z":"e37f810b.f6ef","x":310,"y":1160,"wires":[["506fa186.0bde5"]]},{"id":"48e2c2e7.f78adc","type":"api-current-state","z":"e37f810b.f6ef","name":"","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.moisture_1_s","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":350,"y":900,"wires":[["ed1a0e13.42fc4"]]},{"id":"c1f61d03.984bf","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":900,"wires":[["48e2c2e7.f78adc"]]},{"id":"ed1a0e13.42fc4","type":"debug","z":"e37f810b.f6ef","name":"tester1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":600,"y":900,"wires":[]},{"id":"47dbe3ed.15b53c","type":"api-current-state","z":"e37f810b.f6ef","name":"","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.moisture_2_i","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":350,"y":960,"wires":[["cc4716a4.cee558"]]},{"id":"d9d12c43.29674","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":960,"wires":[["47dbe3ed.15b53c"]]},{"id":"cc4716a4.cee558","type":"debug","z":"e37f810b.f6ef","name":"tester1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":600,"y":960,"wires":[]},{"id":"5bdc0144.092aa","type":"api-call-service","z":"e37f810b.f6ef","name":"","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"notify","service":"mobile_app_thomass_iphone","areaId":[],"deviceId":[],"entityId":[],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":590,"y":1020,"wires":[[]]},{"id":"9b0e1ce4.02d5a","type":"function","z":"e37f810b.f6ef","name":"","func":"var title = \"title yo\";\nvar message = \"message hey\";\nvar sound = \"default\";\nvar apnsCollapseId = title + \"_a343543\";\n\nmsg.payload = \n{\n  \"data\": \n    {\n    \"title\": `${title}`,\n        \"message\": `${message}`,\n        \"data\": {\n            \"push\": {\n                \"sound\": `${sound}`\n            },\n            \"apns_headers\": {\n                \"apns-collapse-id\": `${apnsCollapseId}`\n            }\n        }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":1040,"wires":[["5bdc0144.092aa"]]},{"id":"d90dbcd0.c5b12","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1020,"wires":[["9b0e1ce4.02d5a"]]},{"id":"3af1dbca.e52384","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"343","payloadType":"str","x":90,"y":700,"wires":[["ea20905f.06ec7"]]},{"id":"ea20905f.06ec7","type":"subflow:71a3fd81.9edc14","z":"e37f810b.f6ef","name":"","x":330,"y":700,"wires":[]},{"id":"3be31372.73599c","type":"function","z":"e37f810b.f6ef","name":"send full message object w/sound","func":"var title = \"title yo\";\nvar message = \"message hey\";\nvar sound = \"default\";\nvar apnsCollapseId = title + \"_a343543\";\n\nmsg.payload = \n{\n  \"data\": \n    {\n    \"title\": `${title}`,\n        \"message\": `${message}`,\n        \"data\": {\n            \"push\": {\n                \"sound\": `${sound}`\n            },\n            \"apns_headers\": {\n                \"apns-collapse-id\": `${apnsCollapseId}`\n            }\n        }\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":600,"wires":[[]]},{"id":"cbfdbbab.734e58","type":"inject","z":"e37f810b.f6ef","name":"get","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"get","payloadType":"str","x":90,"y":840,"wires":[["fc591e4e.6acc7"]]},{"id":"907b04e5.68bc48","type":"subflow:1720b27f.e66bee","z":"e37f810b.f6ef","name":"","x":290,"y":840,"wires":[["8333a5b1.e73a88"]]},{"id":"8333a5b1.e73a88","type":"debug","z":"e37f810b.f6ef","name":"get debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":470,"y":840,"wires":[]},{"id":"58594496.cb7f3c","type":"inject","z":"e37f810b.f6ef","name":"set","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"yo yo3","payloadType":"str","x":90,"y":780,"wires":[["fc591e4e.6acc7"]]},{"id":"fc591e4e.6acc7","type":"subflow:1720b27f.e66bee","z":"e37f810b.f6ef","name":"","x":290,"y":780,"wires":[["9f3f6c76.df89b"]]},{"id":"9f3f6c76.df89b","type":"debug","z":"e37f810b.f6ef","name":"set debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":460,"y":780,"wires":[]},{"id":"393051ed.49da4e","type":"inject","z":"e37f810b.f6ef","name":"set","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"this is a test 123","payloadType":"str","x":90,"y":300,"wires":[["762bd6.8502e42c"]]},{"id":"1a068ec4.f8bb51","type":"api-call-service","z":"e37f810b.f6ef","name":"turn on motor 5","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.blue_motor_5"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":280,"y":360,"wires":[["7dc1c1e.367094"]]},{"id":"762bd6.8502e42c","type":"function","z":"e37f810b.f6ef","name":"dim 100%","func":"msg.payload = {\"data\":{\"brightness_pct\":  100}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":300,"wires":[["1a068ec4.f8bb51"]]},{"id":"62f304c5.7975cc","type":"stoptimer","z":"e37f810b.f6ef","duration":"1781.3","units":"Second","payloadtype":"num","payloadval":"0","name":"1781.3 = 1/2g","x":580,"y":380,"wires":[["80482e6c.0eec2"],[]]},{"id":"d9c06135.4005","type":"api-call-service","z":"e37f810b.f6ef","name":"turn down motor 6 controller","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.blue_motor_6"],"data":"{\"brightness_pct\":  0}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":920,"y":420,"wires":[[]]},{"id":"80482e6c.0eec2","type":"function","z":"e37f810b.f6ef","name":"dim 0%","func":"msg.payload = {\"data\":{\"brightness_pct\":  0}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":380,"wires":[["d9c06135.4005"]]},{"id":"a0dc9137.56736","type":"stoptimer","z":"e37f810b.f6ef","duration":"47","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1070,"y":600,"wires":[[],[]]},{"id":"47de25e6.37ecfc","type":"stoptimer","z":"e37f810b.f6ef","duration":"5","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":1060,"y":640,"wires":[[],[]]},{"id":"eb4f6f88.a735d","type":"api-call-service","z":"e37f810b.f6ef","name":"turn down motor 5 controller","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.blue_motor_5"],"data":"{\"brightness_pct\":  0}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":940,"y":300,"wires":[["444b2a21.4e2dd4"]]},{"id":"e3c90b7f.2796f8","type":"function","z":"e37f810b.f6ef","name":"dim 0%","func":"msg.payload = {\"data\":{\"brightness_pct\":  0}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":820,"y":260,"wires":[["eb4f6f88.a735d"]]},{"id":"f546a1c2.85326","type":"stoptimer","z":"e37f810b.f6ef","duration":"1828.675","units":"Second","payloadtype":"num","payloadval":"0","name":"1828.675 = 1/2g","x":580,"y":280,"wires":[["e3c90b7f.2796f8"],[]]},{"id":"f89c2ef4.2006f","type":"stoptimer","z":"e37f810b.f6ef","duration":"94","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":590,"y":427,"wires":[[],[]]},{"id":"3256c4b1.f3847c","type":"stoptimer","z":"e37f810b.f6ef","duration":"96.5","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":590,"y":327,"wires":[[],[]]},{"id":"1c827d76.b7fc13","type":"function","z":"e37f810b.f6ef","name":"payload = STOP","func":"msg.payload = \"STOP\"\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":300,"y":640,"wires":[[]]},{"id":"1f64ffbd.f284a","type":"subflow:71a3fd81.9edc14","z":"e37f810b.f6ef","name":"","x":1210,"y":240,"wires":[]},{"id":"444b2a21.4e2dd4","type":"function","z":"e37f810b.f6ef","name":"Feeding cycle is complete!","func":"msg.payload = `Feeding cycle is complete!`\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1067,"y":187,"wires":[["1f64ffbd.f284a"]]},{"id":"7dc1c1e.367094","type":"stoptimer","z":"e37f810b.f6ef","duration":"96.5","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":670,"y":60,"wires":[["897e2e2c.e3549"],[]]},{"id":"897e2e2c.e3549","type":"stoptimer","z":"e37f810b.f6ef","duration":"96.5","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":670,"y":106,"wires":[["15acaf37.080831"],[]]},{"id":"15acaf37.080831","type":"stoptimer","z":"e37f810b.f6ef","duration":"96.5","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":670,"y":154,"wires":[["90c7f418.99aed8"],[]]},{"id":"90c7f418.99aed8","type":"stoptimer","z":"e37f810b.f6ef","duration":"96.5","units":"Second","payloadtype":"num","payloadval":"0","name":"","x":670,"y":201,"wires":[[],["e3c90b7f.2796f8"]]},{"id":"4dc513ca.7b1f7c","type":"server-state-changed","z":"e37f810b.f6ef","d":true,"name":"motor 5 turned off","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"light.blue_motor_5","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"off","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":110,"y":640,"wires":[["1c827d76.b7fc13"],[]]},{"id":"d97bd55f.88c3b8","type":"debug","z":"e37f810b.f6ef","name":"date test","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":420,"y":480,"wires":[]},{"id":"7598c589.89b3fc","type":"inject","z":"e37f810b.f6ef","name":"set","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"this is a test 123","payloadType":"str","x":70,"y":420,"wires":[["b1537fde.b2f23"]]},{"id":"b1537fde.b2f23","type":"function","z":"e37f810b.f6ef","name":"flow.loop_count = 3","func":"flow.set(\"loop_count\", 3);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":230,"y":420,"wires":[[]]},{"id":"a3f94e1d.0c659","type":"function","z":"e37f810b.f6ef","d":true,"name":"payload = STOP when hit flow.loop_count","func":"\nlet loop_count = 2; //flow.get(`$parent.loop_count`);\nlet loop_pos = flow.get(\"loop_pos\");\n\nif (!loop_pos) {\n    msg.payload = \"RUNNING\";\n    loop_pos = 2;\n} else if (loop_pos < loop_count) {\n    msg.payload = \"RUNNING\";\n    loop_pos ++;\n} else {\n    msg.payload = \"STOP\";\n    loop_pos = 0;\n}\n\nflow.set(\"loop_pos\", loop_pos);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":240,"wires":[[]]},{"id":"2ebae873.cd8a78","type":"debug","z":"e37f810b.f6ef","name":"motor 5 NOT finished","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":540,"y":540,"wires":[]},{"id":"34e899ed.bd1c36","type":"server-state-changed","z":"e37f810b.f6ef","name":"flow motor is on","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"light.blue_motor_6","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":140,"y":180,"wires":[["f7c47f2c.e125f"],[]]},{"id":"2aa6b274.2e87be","type":"config","z":"e37f810b.f6ef","name":"","properties":[{"p":"motor","pt":"flow","to":"light.blue_motor_6","tot":"str"}],"active":true,"x":110,"y":140,"wires":[]},{"id":"f7c47f2c.e125f","type":"debug","z":"e37f810b.f6ef","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":350,"y":140,"wires":[]},{"id":"f24611c0.58967","type":"inject","z":"e37f810b.f6ef","name":"set","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"payload\": \"on\", \"timeout\": 5.5, \"warning\":0}","payloadType":"json","x":90,"y":40,"wires":[["5ee7e994.9f8c98"]]},{"id":"5ee7e994.9f8c98","type":"mytimeout","z":"e37f810b.f6ef","name":"","outtopic":"","outsafe":"","outwarning":"Warning","outunsafe":"off","warning":"5","timer":"30","debug":false,"ndebug":false,"ignoreCase":false,"repeat":false,"again":false,"x":240,"y":40,"wires":[["a4fa4211.12ddc"],["3b9f6183.c9cede"]]},{"id":"a4fa4211.12ddc","type":"debug","z":"e37f810b.f6ef","name":"mytimeout top","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":440,"y":40,"wires":[]},{"id":"3b9f6183.c9cede","type":"debug","z":"e37f810b.f6ef","name":"mytimeout bottom","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":450,"y":80,"wires":[]},{"id":"79e8eec9.c85a9","type":"inject","z":"e37f810b.f6ef","name":"set","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"STOP","payloadType":"str","x":90,"y":100,"wires":[["5ee7e994.9f8c98"]]},{"id":"d0e798d7.a70248","type":"inject","z":"e37f810b.f6ef","name":"set","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"this is a test 123","payloadType":"str","x":110,"y":520,"wires":[["db62bbd.130c548"]]},{"id":"db62bbd.130c548","type":"function","z":"e37f810b.f6ef","name":"get day","func":"const today = new Date();\n//msg.payload = today.getDay(); //day of week, 0=sunday\n//msg.payload = today.getMonth(); //month of year, 0=jan\n//msg.payload = today.getDate(); //day of month\n//msg.payload = today.getHours(); //hour of day\nmsg.payload = today.getMinutes(); //minute of hour\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":240,"y":520,"wires":[["d97bd55f.88c3b8"]]},{"id":"9c00af13.2a911","type":"function","z":"e37f810b.f6ef","name":"flow - burp interval check","func":"//if (flow.get(\"onetime\")) return msg;\n/*\nconst flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));\n\nflowParent(\"humidity_sensor\");\nflowParent(\"fan\");\nflowParent(\"runminutes\");\n*/\n//flow.set(\"onetime\", true);\n\n\nconst today = new Date();\nlet curHour = today.getHours(); //hour of day\nlet curMinute = today.getMinutes(); //minute of hour\n\nmsg.payload=`curHour:${curHour},curMinute:${curMinute}`;\nreturn msg;\n\n/*\nlet runminutes = flow.get(\"runminutes\");\n//msg.payload=`curHour:${curHour},runminutes:${runminutes}`;\n//return [msg, null]; //TESTING\n\n// 3 per day (70%-65% RH)\nif ((curHour == 0 || curHour == 7 || curHour == 15) && runminutes > curMinute)\n    return [msg, null];\nelse\n    return [null, msg];\n*/\n\n/*\n// 1 per week (1st month)\nlet curDayWeek = today.getDay(); //day of week, 0=sunday\nif (curDayWeek==0 && curHour==0 && runminutes > curMinute)\n    return [msg, null];\nelse\n    return [null, msg];\n\n// 1 per month (after 1st month)\nlet curDayMonth = today.getDate(); //day of month, 0=jan\nif (curDayMonth==0 && curHour==0 && runminutes > curMinute)\n    return [msg, null];\nelse\n    return [null, msg];\n*/\n\nreturn msg;","outputs":2,"noerr":0,"initialize":"","finalize":"","x":290,"y":3480,"wires":[["6788a9d9.6a3bf8"],[]]},{"id":"41706c04.081384","type":"inject","z":"e37f810b.f6ef","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":3480,"wires":[["9c00af13.2a911"]]},{"id":"6788a9d9.6a3bf8","type":"debug","z":"e37f810b.f6ef","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":540,"y":3480,"wires":[]},{"id":"23a46bfc.c5ff34","type":"debug","z":"e37f810b.f6ef","name":"humidity4_1 update","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":600,"y":3600,"wires":[]},{"id":"fb308615.2a6ae8","type":"function","z":"e37f810b.f6ef","name":"humidity4_1 state change","func":"if (msg.payload.hasOwnProperty(\"entity_id\")) {\n    \n    let humidity_sensor = \"sensor.humidity4_1\"; //flow.get(\"humidity_sensor\");\n\n    \n    \n    if (humidity_sensor) {\n        if (msg.payload.entity_id == humidity_sensor) {\n            msg.payload = parseFloat(msg.payload.event.new_state.state);\n            return msg;\n        }\n    }\n\n\n    \n}\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\n\n//const flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));","finalize":"","x":361,"y":3600,"wires":[["23a46bfc.c5ff34"]]},{"id":"b64aba8.d4efc48","type":"server-events","z":"e37f810b.f6ef","name":"","server":"1b7e4fe1.0da8e","version":2,"eventType":"state_changed","waitForRunning":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"x":110,"y":3600,"wires":[["fb308615.2a6ae8","2ebb95c2.c4b05a"]]},{"id":"e02f3d9c.791d7","type":"debug","z":"e37f810b.f6ef","name":"humidity4_2 update","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":600,"y":3660,"wires":[]},{"id":"2ebb95c2.c4b05a","type":"function","z":"e37f810b.f6ef","name":"humidity4_2 state change","func":"if (msg.payload.hasOwnProperty(\"entity_id\")) {\n    \n    let humidity_sensor = \"sensor.humidity4_2\"; //flow.get(\"humidity_sensor\");\n\n    \n    \n    if (humidity_sensor) {\n        if (msg.payload.entity_id == humidity_sensor) {\n            msg.payload = parseFloat(msg.payload.event.new_state.state);\n            return msg;\n        }\n    }\n\n\n    \n}\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\n\n//const flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));","finalize":"","x":361,"y":3660,"wires":[["e02f3d9c.791d7"]]},{"id":"b585579a.8f2328","type":"server-state-changed","z":"d227654b.140b28","name":"basement steps light switch","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.basement_steps_5_switch","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":120,"y":640,"wires":[["a184483b.9382a8"]]},{"id":"a184483b.9382a8","type":"switch","z":"d227654b.140b28","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"on","vt":"str"},{"t":"eq","v":"off","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":640,"wires":[["b9795e4c.79216","5602811.ce58c8","e154e11017eec9a6"],["2db329d2.7ad956","d51997b0.5a4498","afe2a5d0.dc97b8","3dd03274.a2887e","8776338ea12f51e6","fcf5840696233e2b"]]},{"id":"fd310d8d.cb4af","type":"api-current-state","z":"d227654b.140b28","name":"if unfinished is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.basement_unfinished_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":210,"y":760,"wires":[["fd65a881.f16cc8"],["40a392e9.ea707c"]]},{"id":"40a392e9.ea707c","type":"debug","z":"d227654b.140b28","name":"Do not turn on unfinfished","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":270,"y":880,"wires":[]},{"id":"fd65a881.f16cc8","type":"api-call-service","z":"d227654b.140b28","name":"set unfinished on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.basement_unfinished_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":230,"y":840,"wires":[[]]},{"id":"2db329d2.7ad956","type":"api-current-state","z":"d227654b.140b28","name":"if unfinished is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.basement_unfinished_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":550,"y":760,"wires":[["13069f94.bc95d"],["f7521534.60efd8"]]},{"id":"f7521534.60efd8","type":"debug","z":"d227654b.140b28","name":"Do not turn off unfinfished","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":610,"y":880,"wires":[]},{"id":"13069f94.bc95d","type":"api-call-service","z":"d227654b.140b28","name":"set unfinished off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.basement_unfinished_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":570,"y":840,"wires":[[]]},{"id":"e81385ef.8c0528","type":"api-current-state","z":"d227654b.140b28","name":"if basement power is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.basement_power_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":230,"y":960,"wires":[["f6dec003.e364a"],["1f201fc1.66e4a"]]},{"id":"1f201fc1.66e4a","type":"debug","z":"d227654b.140b28","name":"Do not turn on power","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":260,"y":1040,"wires":[]},{"id":"f6dec003.e364a","type":"api-call-service","z":"d227654b.140b28","name":"set power on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.basement_power_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":210,"y":1000,"wires":[[]]},{"id":"d51997b0.5a4498","type":"api-current-state","z":"d227654b.140b28","name":"if basement power is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.basement_power_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":590,"y":960,"wires":[["c05c5469.e0e2e8"],["21952632.6939fa"]]},{"id":"21952632.6939fa","type":"debug","z":"d227654b.140b28","name":"Do not turn off power","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":620,"y":1040,"wires":[]},{"id":"c05c5469.e0e2e8","type":"api-call-service","z":"d227654b.140b28","name":"set power off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.basement_power_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":570,"y":1000,"wires":[[]]},{"id":"722b1f36.cd386","type":"api-current-state","z":"d227654b.140b28","d":true,"name":"if basement dimmer is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.erone_unknown_type_0103_id_0001_level","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":230,"y":1100,"wires":[["af80bc22.4c4b9"],["cd561ab5.6dd7e8"]]},{"id":"cd561ab5.6dd7e8","type":"debug","z":"d227654b.140b28","d":true,"name":"Do not turn on dimmer","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":260,"y":1180,"wires":[]},{"id":"af80bc22.4c4b9","type":"api-call-service","z":"d227654b.140b28","d":true,"name":"set dimmer on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.erone_unknown_type_0103_id_0001_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":220,"y":1140,"wires":[[]]},{"id":"afe2a5d0.dc97b8","type":"api-current-state","z":"d227654b.140b28","d":true,"name":"if basement dimmer is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"light.erone_unknown_type_0103_id_0001_level","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":590,"y":1100,"wires":[["f4cf2a0f.bf1418"],["5cf407e1.46dad8"]]},{"id":"5cf407e1.46dad8","type":"debug","z":"d227654b.140b28","d":true,"name":"Do not turn off dimmer","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":620,"y":1180,"wires":[]},{"id":"f4cf2a0f.bf1418","type":"api-call-service","z":"d227654b.140b28","d":true,"name":"set dimmer off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.erone_unknown_type_0103_id_0001_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":580,"y":1140,"wires":[[]]},{"id":"80c9743d.6437f8","type":"alexa-home","z":"d227654b.140b28","conf":"69543e7577c6ab2b","device":"114862","acknoledge":true,"name":"Basement Lights","topic":"","x":80,"y":40,"wires":[["4c7d5d13.4e6934"]]},{"id":"9de2370.a77a8c8","type":"api-current-state","z":"d227654b.140b28","name":"if basement steps is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.basement_steps_5_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":370,"y":120,"wires":[["3f3570f1.cac6a"],["4e6f8e5f.3d4a7"]]},{"id":"4e6f8e5f.3d4a7","type":"debug","z":"d227654b.140b28","name":"Do not turn on unfinfished","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":410,"y":200,"wires":[]},{"id":"3f3570f1.cac6a","type":"api-call-service","z":"d227654b.140b28","name":"set basement steps on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.basement_steps_5_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":380,"y":160,"wires":[[]]},{"id":"59c54851.e55768","type":"api-current-state","z":"d227654b.140b28","name":"if basement steps is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.basement_steps_5_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":690,"y":120,"wires":[["b3ee921a.87598"],["e7362103.a51f7"]]},{"id":"e7362103.a51f7","type":"debug","z":"d227654b.140b28","name":"Do not turn off unfinfished","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":730,"y":200,"wires":[]},{"id":"b3ee921a.87598","type":"api-call-service","z":"d227654b.140b28","name":"set basement steps off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.basement_steps_5_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":700,"y":160,"wires":[[]]},{"id":"4c7d5d13.4e6934","type":"switch","z":"d227654b.140b28","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":110,"y":240,"wires":[["d575c0f7.1b309"],["59c54851.e55768","e785befc7bfe7d72","fcf5840696233e2b"],["2d958164.7048be","599040cf018570d4","e154e11017eec9a6"]]},{"id":"99108dab.2276b","type":"api-call-service","z":"d227654b.140b28","d":true,"name":"turn basement dimmable lights on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.erone_unknown_type_0103_id_0001_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":720,"y":340,"wires":[[]]},{"id":"b89942b7.12c6","type":"function","z":"d227654b.140b28","d":true,"name":"change brightness","func":"msg.payload = {\"data\":{\"brightness\": msg.payload * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":470,"y":340,"wires":[["99108dab.2276b"]]},{"id":"2d958164.7048be","type":"api-call-service","z":"d227654b.140b28","name":"set unfinished basement off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.basement_unfinished_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":340,"y":280,"wires":[["b89942b7.12c6"]]},{"id":"b9795e4c.79216","type":"function","z":"d227654b.140b28","name":"set brightness 68","func":"msg.payload = {\"data\":{\"brightness\": 68 * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":130,"y":700,"wires":[["fd310d8d.cb4af","e81385ef.8c0528","722b1f36.cd386","95978d3e54284376"]]},{"id":"d575c0f7.1b309","type":"function","z":"d227654b.140b28","name":"set brightness 68","func":"msg.payload = {\"data\":{\"brightness\": 68 * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":290,"y":40,"wires":[["9de2370.a77a8c8","599040cf018570d4","e154e11017eec9a6"]]},{"id":"362e05e0.b4cf6a","type":"inject","z":"d227654b.140b28","d":true,"name":"off at midnight","props":[],"repeat":"","crontab":"00 00 * * *","once":false,"onceDelay":0.1,"topic":"","x":100,"y":520,"wires":[["5602811.ce58c8"]]},{"id":"77823db.d0bc3c4","type":"inject","z":"d227654b.140b28","d":true,"name":"on at 8am","props":[],"repeat":"","crontab":"00 08 * * *","once":false,"onceDelay":0.1,"topic":"","x":90,"y":460,"wires":[["54ca6a9b.c939b4"]]},{"id":"54ca6a9b.c939b4","type":"api-current-state","z":"d227654b.140b28","name":"if basement veggies is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.basement_veggies_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":690,"y":460,"wires":[["e41343dd.f4501"],[]]},{"id":"e41343dd.f4501","type":"api-call-service","z":"d227654b.140b28","name":"set basement veggies on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.basement_veggies_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":950,"y":460,"wires":[[]]},{"id":"b7a3f369.5eecc","type":"api-call-service","z":"d227654b.140b28","name":"set basement veggies off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.basement_veggies_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":950,"y":520,"wires":[[]]},{"id":"5602811.ce58c8","type":"api-current-state","z":"d227654b.140b28","d":true,"name":"if basement veggies is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.basement_veggies_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":690,"y":520,"wires":[["b7a3f369.5eecc"],[]]},{"id":"3dd03274.a2887e","type":"time-range-switch","z":"d227654b.140b28","d":true,"name":"if between 8am and midnight","lat":"38.810770","lon":"-77.155803","startTime":"08:00","endTime":"00:00","startOffset":0,"endOffset":0,"x":320,"y":560,"wires":[["54ca6a9b.c939b4"],[]]},{"id":"de019677.3d9d58","type":"alexa-home","z":"d227654b.140b28","d":true,"conf":"30224eff.8e7852","device":"115548","acknoledge":true,"name":"Veggies","topic":"","x":50,"y":400,"wires":[["344a6fa0.30c27"]]},{"id":"344a6fa0.30c27","type":"switch","z":"d227654b.140b28","name":"","property":"command","propertyType":"msg","rules":[{"t":"eq","v":"TurnOnRequest","vt":"str"},{"t":"eq","v":"TurnOffRequest","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":390,"y":400,"wires":[["54ca6a9b.c939b4"],["5602811.ce58c8"]]},{"id":"e785befc7bfe7d72","type":"api-current-state","z":"d227654b.140b28","name":"if basement dimmed is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.basement_dimmed_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":990,"y":120,"wires":[["b42d7c1679395cba"],[]]},{"id":"b42d7c1679395cba","type":"api-call-service","z":"d227654b.140b28","name":"set basement dimmed steps off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.basement_dimmed_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1030,"y":160,"wires":[[]]},{"id":"599040cf018570d4","type":"api-current-state","z":"d227654b.140b28","name":"if basement dimmed steps is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.basement_dimmed_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":610,"y":20,"wires":[["4f336b962ac08ee0"],[]]},{"id":"4f336b962ac08ee0","type":"api-call-service","z":"d227654b.140b28","name":"set basement dimmed steps on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.basement_dimmed_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":630,"y":60,"wires":[[]]},{"id":"8776338ea12f51e6","type":"api-current-state","z":"d227654b.140b28","name":"if basement dimmed is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.basement_dimmed_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":590,"y":1240,"wires":[["0204f4d1e379fdd4"],[]]},{"id":"0204f4d1e379fdd4","type":"api-call-service","z":"d227654b.140b28","name":"set basement dimmed steps off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.basement_dimmed_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":630,"y":1280,"wires":[[]]},{"id":"95978d3e54284376","type":"api-current-state","z":"d227654b.140b28","name":"if basement dimmed steps is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.basement_dimmed_light","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":230,"y":1240,"wires":[["2ed231e41b225e9f"],[]]},{"id":"2ed231e41b225e9f","type":"api-call-service","z":"d227654b.140b28","name":"set basement dimmed steps on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.basement_dimmed_light"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":250,"y":1280,"wires":[[]]},{"id":"0f3b589d437ff22c","type":"api-call-service","z":"d227654b.140b28","name":"set switch 5 off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.smart_energy_switch_5"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1180,"y":340,"wires":[[]]},{"id":"54efdf1ac2360f49","type":"api-call-service","z":"d227654b.140b28","name":"set swith 5 on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.smart_energy_switch_5"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1220,"y":460,"wires":[[]]},{"id":"e154e11017eec9a6","type":"api-current-state","z":"d227654b.140b28","d":true,"name":"if switch 5 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.smart_energy_switch_5","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1140,"y":280,"wires":[["0f3b589d437ff22c"],[]]},{"id":"fcf5840696233e2b","type":"api-current-state","z":"d227654b.140b28","d":true,"name":"if switch 5 is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.smart_energy_switch_5","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1180,"y":400,"wires":[["54efdf1ac2360f49"],[]]},{"id":"875cca3ad002b84a","type":"inject","z":"d227654b.140b28","d":true,"name":"every 5 seconds","props":[{"p":"payload"}],"repeat":"5","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":1500,"wires":[["1e697f96ba2dcf7e"]]},{"id":"1e697f96ba2dcf7e","type":"function","z":"d227654b.140b28","name":"turn on-off basement lights 10 sec every 5 min","func":"const now = new Date();\nconst min = now.getMinutes();\n\nif ([0, 10, 20, 30, 40, 50, 5, 15, 25, 35, 45, 55].includes(min)) {\n    const sec = now.getSeconds();\n    if (sec >= 5 && sec <= 9) {\n        return [msg, null];\n    } else if (sec >= 15 && sec <= 19) {\n        return [null, msg];\n    }\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":440,"y":1500,"wires":[["06eec17575498231"],["24a3949edc516818"]]},{"id":"24a3949edc516818","type":"api-current-state","z":"d227654b.140b28","name":"if basement steps is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.basement_steps_5_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":830,"y":1540,"wires":[["660ebcf199c7a341"],[]]},{"id":"660ebcf199c7a341","type":"api-call-service","z":"d227654b.140b28","name":"set basement steps off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.basement_steps_5_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":1580,"wires":[[]]},{"id":"4473bc2e313b5f69","type":"api-call-service","z":"d227654b.140b28","name":"set basement steps on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.basement_steps_5_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":1480,"wires":[[]]},{"id":"06eec17575498231","type":"api-current-state","z":"d227654b.140b28","name":"if basement steps is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.basement_steps_5_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":830,"y":1440,"wires":[["4473bc2e313b5f69"],[]]},{"id":"dcd1db77.6da928","type":"alexa-home","z":"9ee37116.944ec","conf":"69543e7577c6ab2b","device":"114859","acknoledge":true,"name":"Bedroom Lights","topic":"","x":80,"y":80,"wires":[["157d7862.c6e738"]]},{"id":"157d7862.c6e738","type":"switch","z":"9ee37116.944ec","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":250,"y":80,"wires":[["687c7cb3.990074"],["842f41c7.ded43"],["618b0a6b.f41084"]]},{"id":"f08f7525.a4eb88","type":"api-call-service","z":"9ee37116.944ec","name":"turn bedroom lights on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights_level","light.bedroom_mantle_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":700,"y":80,"wires":[[]]},{"id":"842f41c7.ded43","type":"api-call-service","z":"9ee37116.944ec","name":"turn bedroom lights off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights_level","light.bedroom_mantle_level","light.upper_deck_lights_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":440,"y":80,"wires":[[]]},{"id":"618b0a6b.f41084","type":"function","z":"9ee37116.944ec","name":"change brightness","func":"let brightness = msg.payload;\n\nmsg.payload = {\"data\":{\"brightness\": brightness * 2.55}}\n\nif (brightness > 20) {\n    return [msg, null];\n} else {\n    return [null, msg];\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":120,"wires":[["f08f7525.a4eb88"],["fb5cd70bfda0696b","282121d40c0a3b0a"]]},{"id":"687c7cb3.990074","type":"function","z":"9ee37116.944ec","name":"full brightness","func":"msg.payload = {\"data\":{\"brightness\": 100 * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":440,"y":40,"wires":[["f08f7525.a4eb88"]]},{"id":"fb5cd70bfda0696b","type":"api-call-service","z":"9ee37116.944ec","name":"turn bedroom mantle on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.bedroom_mantle_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":710,"y":160,"wires":[[]]},{"id":"ce37cd3a2894c16f","type":"api-call-service","z":"9ee37116.944ec","name":"turn bedroom overhead lights off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights_level","light.upper_deck_lights_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":740,"y":260,"wires":[[]]},{"id":"282121d40c0a3b0a","type":"function","z":"9ee37116.944ec","name":"payload = false","func":"msg.payload = false; //{\"data\":{\"brightness\": 100 * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":680,"y":220,"wires":[["ce37cd3a2894c16f"]]},{"id":"a85a51ef.a125d","type":"api-call-service","z":"2891302c.19a1a","name":"turn kitchen/hallway on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.kitchen_light_level","light.kitchen_hallway_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":695,"y":157,"wires":[[]]},{"id":"e5106075.b371c","type":"function","z":"2891302c.19a1a","name":"dim 80%","func":"msg.payload = {\"data\":{\"brightness\":  80 * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":625,"y":117,"wires":[["a85a51ef.a125d"]]},{"id":"99669ba8.bfb2b8","type":"sunrise","z":"2891302c.19a1a","d":true,"name":"sunrise to sunset start","lat":"38.810937","lon":"-77.155829","start":"sunrise","end":"sunsetStart","soff":"-240","eoff":"-45","x":105,"y":197,"wires":[[],["e621ab34.c8bc38"]]},{"id":"e621ab34.c8bc38","type":"switch","z":"2891302c.19a1a","name":"0=night, 1=day","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":365,"y":197,"wires":[["e5106075.b371c","e0f230f2.50e36"],["bd3d9985.37ef68","66affed.f4838"]]},{"id":"bd3d9985.37ef68","type":"function","z":"2891302c.19a1a","name":"turn off hue","func":"msg.payload = {\"on\":false}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":635,"y":257,"wires":[["7d1bdd56.900d74"]]},{"id":"66affed.f4838","type":"api-call-service","z":"2891302c.19a1a","name":"turn kitchen/hallway off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.kitchen_hallway_level","light.kitchen_light_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":675,"y":357,"wires":[[]]},{"id":"35271b22.628624","type":"alexa-home","z":"2891302c.19a1a","conf":"69543e7577c6ab2b","device":"115092","acknoledge":true,"name":"Kitchen Lights","topic":"","x":75,"y":477,"wires":[["b7dfe331.1fa58"]]},{"id":"1b55e651.14e07a","type":"change","z":"2891302c.19a1a","name":"true=0, false=1","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"bool","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"bool","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":365,"y":337,"wires":[["e621ab34.c8bc38"]]},{"id":"fdd7a088.dca97","type":"switch","z":"2891302c.19a1a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":399,"y":477,"wires":[["1b55e651.14e07a"],["1b55e651.14e07a"],["7c178406.0730ec","c32f752f.ce04c8"]]},{"id":"e0f230f2.50e36","type":"function","z":"2891302c.19a1a","name":"turn on hue","func":"msg.payload = {\"on\":true, \"kelvin\":2400, \"brightness\": 100}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":635,"y":37,"wires":[["cf30ba73.a6c5c8"]]},{"id":"551c881a.ec4368","type":"api-call-service","z":"2891302c.19a1a","name":"turn kitchen/hallway on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.kitchen_light_level","light.kitchen_hallway_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":655,"y":697,"wires":[[]]},{"id":"c32f752f.ce04c8","type":"function","z":"2891302c.19a1a","name":"set brightness on hue","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\")\n\tmsg.payload = {\"brightness\": msg.payload};\n//IF COLOR - CHANGE BRIGHTNESS TO 100%\nif (msg.payload.hasOwnProperty(\"hue\") || !msg.payload.brightness)\n    msg.payload[\"brightness\"] = 100;\n\n//if (!msg.payload.hasOwnProperty(\"hue\"))\n//    msg.payload[\"kelvin\"] = 2700;\n    \nmsg.payload[\"on\"]=true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":605,"y":557,"wires":[["f1cf233c.97323"]]},{"id":"7c178406.0730ec","type":"function","z":"2891302c.19a1a","name":"change brightness","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\") {\n    //NUMBER IS BRIGHTNESS\n    msg.payload = {\"data\":{\"brightness\": msg.payload * 2.55}}\n} else if (payloadType === \"object\") {\n    //OBJECT - GET BRIGHTNESS FROM PROP\n    if (msg.payload.hue) {\n        //COLOR CHANGE - TURN NON-COLOR LIGHTS OFF\n        msg.payload = {\"data\":{\"brightness\": 0}}\n    } else if (msg.payload.brightness) {\n        msg.payload = {\"data\":{\"brightness\": msg.payload.brightness * 2.55}}\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":615,"y":657,"wires":[["551c881a.ec4368","495b1fa.88b79e"]]},{"id":"b7dfe331.1fa58","type":"function","z":"2891302c.19a1a","name":"adjust hue","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\n\nif (payloadType === \"number\")\n    msg.payload = {\"brightness\": msg.payload};\n    \nif (msg.payload.saturation)\n    msg.payload.saturation = msg.payload.saturation * 100;\n    \n\nif (msg.payload.hasOwnProperty(\"hue\")) {\n    let rgb = HSBToRGB(240,1,1)\n    msg.payload[\"red\"]=rgb.r;\n    msg.payload[\"green\"]=rgb.g;\n    msg.payload[\"blue\"]=rgb.b;\n    msg.payload[\"brightness\"]=100;\n} else if (payloadType === \"object\") {\n    msg.payload[\"kelvin\"]=2700;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\nHSBToRGB = function (h,s,b) {\n  var hsb = {\"h\":h,\"s\":s,\"b\":b};\n  var rgb = { };\n  var h = Math.round(hsb.h);\n  var s = Math.round(hsb.s * 255);\n  var v = Math.round(hsb.b * 255);\n\n  if (s == 0) {\n\n    rgb.r = rgb.g = rgb.b = v;\n  } else {\n  var t1 = v;\n  var t2 = (255 - s) * v / 255;\n  var t3 = (t1 - t2) * (h % 60) / 60;\n\n      if (h == 360) h = 0;\n\n          if (h < 60) { rgb.r = t1; rgb.b = t2; rgb.g = t2 + t3 }\n          else if (h < 120) { rgb.g = t1; rgb.b = t2; rgb.r = t1 - t3 }\n          else if (h < 180) { rgb.g = t1; rgb.r = t2; rgb.b = t2 + t3 }\n          else if (h < 240) { rgb.b = t1; rgb.r = t2; rgb.g = t1 - t3 }\n          else if (h < 300) { rgb.b = t1; rgb.g = t2; rgb.r = t2 + t3 }\n          else if (h < 360) { rgb.r = t1; rgb.g = t2; rgb.b = t1 - t3 }\n          else { rgb.r = 0; rgb.g = 0; rgb.b = 0 }\n  }\n\n  return { r: Math.round(rgb.r), g: Math.round(rgb.g), b: Math.round(rgb.b) };\n}","finalize":"","x":245,"y":477,"wires":[["fdd7a088.dca97"]]},{"id":"cf30ba73.a6c5c8","type":"node-hue-in","z":"2891302c.19a1a","server":"e5843571.d374f8","lightID":"light2","name":"kitchen hue","x":675,"y":77,"wires":[]},{"id":"7d1bdd56.900d74","type":"node-hue-in","z":"2891302c.19a1a","server":"e5843571.d374f8","lightID":"light2","name":"kitchen hue","x":675,"y":297,"wires":[]},{"id":"f1cf233c.97323","type":"node-hue-in","z":"2891302c.19a1a","server":"e5843571.d374f8","lightID":"light2","name":"kitchen hue","x":615,"y":597,"wires":[]},{"id":"495b1fa.88b79e","type":"debug","z":"2891302c.19a1a","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1010,"y":640,"wires":[]},{"id":"2d61802d.cf8df","type":"sunrise","z":"35ed8594.bdcc4a","name":"4hr before sunrise to 90min before sunset","lat":"38.810937","lon":"-77.155829","start":"sunrise","end":"sunsetStart","soff":"-240","eoff":"-90","x":160,"y":380,"wires":[[],["839150df.469c6","1e4c09f4.1df586","c96cbf30.f82ac"]]},{"id":"839150df.469c6","type":"switch","z":"35ed8594.bdcc4a","name":"switch for indoor lights","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":420,"y":540,"wires":[["c5045dc4.cd742","3fd8d3f7a8c79866"],["55132ce3.e7cee4","3684f6d657f2432c"]]},{"id":"16b62e0d.db9092","type":"alexa-home","z":"35ed8594.bdcc4a","conf":"69543e7577c6ab2b","device":"114838","acknoledge":true,"name":"Main Lights","topic":"","x":70,"y":40,"wires":[["f43ec028.e0933","359005c7.09e70a"]]},{"id":"7f68ccba.d84d24","type":"change","z":"35ed8594.bdcc4a","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"bool","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"bool","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":520,"y":180,"wires":[["839150df.469c6","1e4c09f4.1df586"]]},{"id":"1e4c09f4.1df586","type":"switch","z":"35ed8594.bdcc4a","name":"switch for outdoor lights","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":630,"y":380,"wires":[["6fe6c549.facb9c"],["d4d08c85.b8c6a"]]},{"id":"b837d7e3.9e49d8","type":"switch","z":"35ed8594.bdcc4a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":290,"y":180,"wires":[["7f68ccba.d84d24"],["7f68ccba.d84d24"],["2425a890.971098","d2f23e2d.ec124"]]},{"id":"f43ec028.e0933","type":"debug","z":"35ed8594.bdcc4a","name":"alexa command","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":300,"y":20,"wires":[]},{"id":"359005c7.09e70a","type":"function","z":"35ed8594.bdcc4a","name":"set brightness and modify color on hue","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\n\nif (payloadType === \"number\")\n    msg.payload = {\"brightness\": msg.payload};\n    \nif (msg.payload.saturation)\n    msg.payload.saturation = msg.payload.saturation * 100;\n    \n\nif (msg.payload.hasOwnProperty(\"hue\")) {\n    let rgb = HSBToRGB(240,1,1)\n    msg.payload[\"red\"]=rgb.r;\n    msg.payload[\"green\"]=rgb.g;\n    msg.payload[\"blue\"]=rgb.b;\n    msg.payload[\"brightness\"]=100;\n} else {\n    msg.payload[\"kelvin\"]=2700;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\nHSBToRGB = function (h,s,b) {\n  var hsb = {\"h\":h,\"s\":s,\"b\":b};\n  var rgb = { };\n  var h = Math.round(hsb.h);\n  var s = Math.round(hsb.s * 255);\n  var v = Math.round(hsb.b * 255);\n\n  if (s == 0) {\n\n    rgb.r = rgb.g = rgb.b = v;\n  } else {\n  var t1 = v;\n  var t2 = (255 - s) * v / 255;\n  var t3 = (t1 - t2) * (h % 60) / 60;\n\n      if (h == 360) h = 0;\n\n          if (h < 60) { rgb.r = t1; rgb.b = t2; rgb.g = t2 + t3 }\n          else if (h < 120) { rgb.g = t1; rgb.b = t2; rgb.r = t1 - t3 }\n          else if (h < 180) { rgb.g = t1; rgb.r = t2; rgb.b = t2 + t3 }\n          else if (h < 240) { rgb.b = t1; rgb.r = t2; rgb.g = t1 - t3 }\n          else if (h < 300) { rgb.b = t1; rgb.g = t2; rgb.r = t2 + t3 }\n          else if (h < 360) { rgb.r = t1; rgb.g = t2; rgb.b = t1 - t3 }\n          else { rgb.r = 0; rgb.g = 0; rgb.b = 0 }\n  }\n\n  return { r: Math.round(rgb.r), g: Math.round(rgb.g), b: Math.round(rgb.b) };\n}","finalize":"","x":380,"y":60,"wires":[["dcf7f6ec.a08578","b837d7e3.9e49d8"]]},{"id":"dcf7f6ec.a08578","type":"debug","z":"35ed8594.bdcc4a","name":"alexa modified","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":700,"y":60,"wires":[]},{"id":"db8375db.6991d8","type":"comment","z":"35ed8594.bdcc4a","name":"true, false, or an object","info":"","x":380,"y":120,"wires":[]},{"id":"c5045dc4.cd742","type":"subflow:63a3316a.c01fc","z":"35ed8594.bdcc4a","name":"","env":[],"x":690,"y":520,"wires":[]},{"id":"55132ce3.e7cee4","type":"subflow:ef05d161.c6c31","z":"35ed8594.bdcc4a","name":"","x":690,"y":560,"wires":[]},{"id":"d4d08c85.b8c6a","type":"subflow:56970ff1.d6c68","z":"35ed8594.bdcc4a","name":"","x":928,"y":423,"wires":[]},{"id":"2425a890.971098","type":"subflow:1ad74878.0046e8","z":"35ed8594.bdcc4a","name":"","x":430,"y":240,"wires":[]},{"id":"d2f23e2d.ec124","type":"subflow:6be10a17.1cf904","z":"35ed8594.bdcc4a","name":"","x":400,"y":280,"wires":[]},{"id":"6fe6c549.facb9c","type":"function","z":"35ed8594.bdcc4a","name":"outside default 80%","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\n\nif (payloadType === \"number\")\n    msg.payload = {\"on\": true};\n    \nif (!msg.payload.hasOwnProperty(\"on\"))\n    msg.payload[\"on\"] = true;\n\nif (!msg.payload.hasOwnProperty(\"brightness\"))\n    msg.payload[\"brightness\"] = 80;\n    \nif (!msg.payload.hasOwnProperty(\"hue\") && !msg.payload.hasOwnProperty(\"kelvin\"))\n    msg.payload[\"kelvin\"] = 2700;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":938,"y":340,"wires":[["8cc4531c.0a4ff"]]},{"id":"8cc4531c.0a4ff","type":"subflow:6be10a17.1cf904","z":"35ed8594.bdcc4a","name":"","x":978,"y":380,"wires":[]},{"id":"c96cbf30.f82ac","type":"switch","z":"35ed8594.bdcc4a","name":"switch off non-main level lights","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":210,"y":600,"wires":[[],["19d1073f.b95529","51584fb7.72b45","6ab869cd.7d6658"]]},{"id":"19d1073f.b95529","type":"api-call-service","z":"35ed8594.bdcc4a","name":"basement lights off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.basement_steps_5_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":290,"y":655,"wires":[[]]},{"id":"51584fb7.72b45","type":"api-call-service","z":"35ed8594.bdcc4a","name":"bedroom lights off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.bedroom_lights_level","light.bedroom_mantle_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":290,"y":695,"wires":[[]]},{"id":"90acca45.3cb6f8","type":"api-call-service","z":"35ed8594.bdcc4a","name":"set porch power off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.porch_power_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":550,"y":700,"wires":[[]]},{"id":"6ab869cd.7d6658","type":"api-current-state","z":"35ed8594.bdcc4a","name":"if porch power on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.porch_power_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":530,"y":655,"wires":[["90acca45.3cb6f8"],[]]},{"id":"0ce5bfe3ef8e91b4","type":"api-call-service","z":"35ed8594.bdcc4a","name":"set tree power off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.aeon_switch_01"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":790,"y":665,"wires":[[]]},{"id":"3684f6d657f2432c","type":"api-current-state","z":"35ed8594.bdcc4a","name":"if tree power on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_switch_01","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":760,"y":620,"wires":[["0ce5bfe3ef8e91b4"],[]]},{"id":"08f57b51e0856359","type":"api-call-service","z":"35ed8594.bdcc4a","name":"set tree power on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.aeon_switch_01"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":710,"y":485,"wires":[[]]},{"id":"3fd8d3f7a8c79866","type":"api-current-state","z":"35ed8594.bdcc4a","name":"if tree power off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_switch_01","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":680,"y":440,"wires":[["08f57b51e0856359"],[]]},{"id":"d4945003.3854f","type":"inject","z":"2f358258.bc557e","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"kelvin\":2700}","payloadType":"json","x":120,"y":1600,"wires":[["af8d9c03.913c6","510a3a54.d68da4","aff848e2.0c7aa8","aa6c9b60.fd57b8","754a8548.1194ac","6f75f10f.98291","b9fc708f.3d56a","5128b41a.cdacec","dcb7ebe7.e2a748","80901b0a.8904b8"]]},{"id":"af8d9c03.913c6","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light4","name":"P Desk","x":340,"y":1580,"wires":[]},{"id":"510a3a54.d68da4","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light6","name":"P Fish Tank","x":350,"y":1640,"wires":[]},{"id":"b9fc708f.3d56a","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light9","name":"LR Couch","x":340,"y":1940,"wires":[]},{"id":"6f75f10f.98291","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light3","name":"LR Fireplace","x":350,"y":1880,"wires":[]},{"id":"754a8548.1194ac","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light7","name":"LR Window","x":350,"y":1820,"wires":[]},{"id":"aa6c9b60.fd57b8","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light2","name":"Kitchen Corner","x":360,"y":1760,"wires":[]},{"id":"aff848e2.0c7aa8","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light5","name":"P Piano","x":340,"y":1700,"wires":[]},{"id":"80901b0a.8904b8","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light9","name":"LR Couch","x":340,"y":2120,"wires":[]},{"id":"dcb7ebe7.e2a748","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light12","name":"LR Screened Porch","x":370,"y":2060,"wires":[]},{"id":"5128b41a.cdacec","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light8","name":"LR Strip","x":340,"y":2000,"wires":[]},{"id":"62bf5fc3.da69c","type":"function","z":"2f358258.bc557e","name":"turn off hue","func":"msg.payload = {\"on\":false}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":180,"wires":[["5461951f.d773fc","35673b73.ae0994","628b0f1f.d39a9","d877503b.a7867"]]},{"id":"16d6a319.6ee5ad","type":"alexa-home","z":"2f358258.bc557e","conf":"69543e7577c6ab2b","device":"115110","acknoledge":true,"name":"Living Room Lights","topic":"","x":90,"y":40,"wires":[["f6d26384.38dc5","1995a0a0.0c313f"]]},{"id":"7e0631a0.d71b4","type":"switch","z":"2f358258.bc557e","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":390,"y":180,"wires":[["504aaa34.293864"],["62bf5fc3.da69c","a470a501ad985265"],["70a08182.d09a7","ebc93b37e6472ba8"]]},{"id":"504aaa34.293864","type":"function","z":"2f358258.bc557e","name":"turn on hue w/kelvin","func":"msg.payload = {\"on\":true, \"kelvin\":2700, \"brightness\": 100}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":280,"wires":[["7ae36c3c.a79964","ce9f4712.785848","28c8a874.0b4d68"]]},{"id":"70a08182.d09a7","type":"function","z":"2f358258.bc557e","name":"set brightness on hue","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\")\n\tmsg.payload = {\"brightness\": msg.payload};\n//IF COLOR - CHANGE BRIGHTNESS TO 100%\nif (msg.payload.hasOwnProperty(\"hue\") || !msg.payload.brightness)\n    msg.payload[\"brightness\"] = 100;\n\n//if (!msg.payload.hasOwnProperty(\"hue\"))\n//    msg.payload[\"kelvin\"] = 2400;\n    \nmsg.payload[\"on\"]=true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":140,"y":280,"wires":[["eb886c76.ad2d6","fd6053d.8f4bcb","7ae36c3c.a79964"]]},{"id":"f6d26384.38dc5","type":"debug","z":"2f358258.bc557e","name":"alexa command","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":300,"y":20,"wires":[]},{"id":"1995a0a0.0c313f","type":"function","z":"2f358258.bc557e","name":"set brightness on hue","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\n\nif (payloadType === \"number\")\n    msg.payload = {\"brightness\": msg.payload};\n    \nif (msg.payload.saturation)\n    msg.payload.saturation = msg.payload.saturation * 100;\n    \n\nif (msg.payload.hasOwnProperty(\"hue\")) {\n    let rgb = HSBToRGB(240,1,1)\n    msg.payload[\"red\"]=rgb.r;\n    msg.payload[\"green\"]=rgb.g;\n    msg.payload[\"blue\"]=rgb.b;\n    msg.payload[\"brightness\"]=100;\n} else {\n    msg.payload[\"kelvin\"]=2700;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\nHSBToRGB = function (h,s,b) {\n  var hsb = {\"h\":h,\"s\":s,\"b\":b};\n  var rgb = { };\n  var h = Math.round(hsb.h);\n  var s = Math.round(hsb.s * 255);\n  var v = Math.round(hsb.b * 255);\n\n  if (s == 0) {\n\n    rgb.r = rgb.g = rgb.b = v;\n  } else {\n  var t1 = v;\n  var t2 = (255 - s) * v / 255;\n  var t3 = (t1 - t2) * (h % 60) / 60;\n\n      if (h == 360) h = 0;\n\n          if (h < 60) { rgb.r = t1; rgb.b = t2; rgb.g = t2 + t3 }\n          else if (h < 120) { rgb.g = t1; rgb.b = t2; rgb.r = t1 - t3 }\n          else if (h < 180) { rgb.g = t1; rgb.r = t2; rgb.b = t2 + t3 }\n          else if (h < 240) { rgb.b = t1; rgb.r = t2; rgb.g = t1 - t3 }\n          else if (h < 300) { rgb.b = t1; rgb.g = t2; rgb.r = t2 + t3 }\n          else if (h < 360) { rgb.r = t1; rgb.g = t2; rgb.b = t1 - t3 }\n          else { rgb.r = 0; rgb.g = 0; rgb.b = 0 }\n  }\n\n  return { r: Math.round(rgb.r), g: Math.round(rgb.g), b: Math.round(rgb.b) };\n}","finalize":"","x":360,"y":60,"wires":[["7a035b2b.0fdbc4","7e0631a0.d71b4"]]},{"id":"7a035b2b.0fdbc4","type":"debug","z":"2f358258.bc557e","name":"alexa modified","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":640,"y":60,"wires":[]},{"id":"999975f4.85e5a8","type":"comment","z":"2f358258.bc557e","name":"true, false, or an object","info":"","x":460,"y":120,"wires":[]},{"id":"5461951f.d773fc","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light9","name":"lr-couch","x":680,"y":220,"wires":[]},{"id":"d877503b.a7867","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light7","name":"lr-window","x":680,"y":340,"wires":[]},{"id":"35673b73.ae0994","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light3","name":"lr-fireplace","x":690,"y":260,"wires":[]},{"id":"628b0f1f.d39a9","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light8","name":"lr strip","x":670,"y":300,"wires":[]},{"id":"fd6053d.8f4bcb","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light7","name":"lr-window","x":140,"y":360,"wires":[]},{"id":"eb886c76.ad2d6","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light3","name":"lr-fireplace","x":150,"y":320,"wires":[]},{"id":"12b255d0.b2530a","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light9","name":"lr couch","x":400,"y":540,"wires":[]},{"id":"764035fc.371c6c","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light8","name":"lr strip","x":390,"y":580,"wires":[]},{"id":"7ae36c3c.a79964","type":"function","z":"2f358258.bc557e","name":"turn on hue w/rgb","func":"if (!msg.payload.kelvin)\n    return msg;\n    \nif (msg.payload.kelvin !== 2700)\n    return msg;\n    \ndelete msg.payload.kelvin;\n\nmsg.payload[\"red\"] = 255;\nmsg.payload[\"blue\"] = 206;\nmsg.payload[\"green\"] = 228;\n\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":480,"wires":[["12b255d0.b2530a","764035fc.371c6c"]]},{"id":"ce9f4712.785848","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light3","name":"lr fireplace","x":410,"y":320,"wires":[]},{"id":"28c8a874.0b4d68","type":"node-hue-in","z":"2f358258.bc557e","server":"e5843571.d374f8","lightID":"light7","name":"lr window","x":400,"y":360,"wires":[]},{"id":"834d9f7b3caaddad","type":"api-call-service","z":"2f358258.bc557e","name":"set tree power off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.aeon_switch_01"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":910,"y":180,"wires":[[]]},{"id":"a470a501ad985265","type":"api-current-state","z":"2f358258.bc557e","name":"if tree power on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_switch_01","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":880,"y":135,"wires":[["834d9f7b3caaddad"],[]]},{"id":"ebc93b37e6472ba8","type":"api-current-state","z":"2f358258.bc557e","name":"if tree power off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_switch_01","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":680,"y":420,"wires":[["406a0ff5e05ec493"],[]]},{"id":"406a0ff5e05ec493","type":"api-call-service","z":"2f358258.bc557e","name":"set tree power on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.aeon_switch_01"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":710,"y":465,"wires":[[]]},{"id":"9dd13967.a82058","type":"api-call-service","z":"bc0658fa.ce5778","name":"turn p ceiling on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.p_ceiling_piano_level","light.p_ceiling_back_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":140,"y":640,"wires":[[]]},{"id":"9bcaa7cd.b91998","type":"function","z":"bc0658fa.ce5778","name":"dim 75%","func":"msg.payload = {\"data\":{\"brightness\": 75 * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":100,"y":600,"wires":[["9dd13967.a82058"]]},{"id":"5b76dbed.3176c4","type":"sunrise","z":"bc0658fa.ce5778","d":true,"name":"45 min bf set, 4hrs bf rise","lat":"38.810937","lon":"-77.155829","start":"sunrise","end":"sunsetStart","soff":"-240","eoff":"-45","x":110,"y":300,"wires":[[],["c8500fae.8736f"]]},{"id":"c8500fae.8736f","type":"switch","z":"bc0658fa.ce5778","name":"switch for indoor lights","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":380,"y":300,"wires":[["9bcaa7cd.b91998","d2e1498f.afc838"],["410691a4.ff11f","d05eb09.995d85"]]},{"id":"410691a4.ff11f","type":"function","z":"bc0658fa.ce5778","name":"turn off hue","func":"msg.payload = {\"on\":false}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":470,"y":380,"wires":[["e77923b6.d2c8","4c3f9eba.a608c","a9287005.3409"]]},{"id":"d05eb09.995d85","type":"api-call-service","z":"bc0658fa.ce5778","name":"turn p ceiling of","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.p_ceiling_piano_level","light.p_ceiling_back_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":440,"y":580,"wires":[[]]},{"id":"ceaf5aac.78e588","type":"alexa-home","z":"bc0658fa.ce5778","conf":"69543e7577c6ab2b","device":"115094","acknoledge":true,"name":"Piano Lights","topic":"","x":70,"y":40,"wires":[["6842e22f.ece43c","3485a3c7.92ed6c"]]},{"id":"e1f66575.be5528","type":"change","z":"bc0658fa.ce5778","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"bool","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"bool","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":200,"wires":[["c8500fae.8736f"]]},{"id":"2e8c4ce5.8a1274","type":"switch","z":"bc0658fa.ce5778","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":370,"y":200,"wires":[["e1f66575.be5528"],["e1f66575.be5528"],["8c8c9b71.1eec98","c5859ec6.c5af4"]]},{"id":"d2e1498f.afc838","type":"function","z":"bc0658fa.ce5778","name":"turn on hue","func":"msg.payload = {\"on\":true, \"kelvin\":2400, \"brightness\": 100}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":110,"y":380,"wires":[["250953b3.a3485c","67517743.63ef78","fb173e0b.71d0a"]]},{"id":"250953b3.a3485c","type":"node-hue-in","z":"bc0658fa.ce5778","server":"e5843571.d374f8","lightID":"light4","name":"p-desk","x":140,"y":420,"wires":[]},{"id":"8c8c9b71.1eec98","type":"function","z":"bc0658fa.ce5778","name":"set brightness on hue","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\")\n\tmsg.payload = {\"brightness\": msg.payload};\n//IF COLOR - CHANGE BRIGHTNESS TO 100%\nif (msg.payload.hasOwnProperty(\"hue\") || !msg.payload.brightness)\n    msg.payload[\"brightness\"] = 100;\n\n//if (!msg.payload.hasOwnProperty(\"hue\"))\n//    msg.payload[\"kelvin\"] = 2400;\n    \nmsg.payload[\"on\"]=true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":300,"wires":[["3be8a9be.c28296","1da95d1f.b5f233","97719562.c97428"]]},{"id":"6842e22f.ece43c","type":"debug","z":"bc0658fa.ce5778","name":"alexa command","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":300,"y":20,"wires":[]},{"id":"3485a3c7.92ed6c","type":"function","z":"bc0658fa.ce5778","name":"set brightness on hue","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\n\nif (payloadType === \"number\")\n    msg.payload = {\"brightness\": msg.payload};\n    \nif (msg.payload.saturation)\n    msg.payload.saturation = msg.payload.saturation * 100;\n    \n\nif (msg.payload.hasOwnProperty(\"hue\")) {\n    let rgb = HSBToRGB(240,1,1)\n    msg.payload[\"red\"]=rgb.r;\n    msg.payload[\"green\"]=rgb.g;\n    msg.payload[\"blue\"]=rgb.b;\n    msg.payload[\"brightness\"]=100;\n} else {\n    msg.payload[\"kelvin\"]=2700;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\nHSBToRGB = function (h,s,b) {\n  var hsb = {\"h\":h,\"s\":s,\"b\":b};\n  var rgb = { };\n  var h = Math.round(hsb.h);\n  var s = Math.round(hsb.s * 255);\n  var v = Math.round(hsb.b * 255);\n\n  if (s == 0) {\n\n    rgb.r = rgb.g = rgb.b = v;\n  } else {\n  var t1 = v;\n  var t2 = (255 - s) * v / 255;\n  var t3 = (t1 - t2) * (h % 60) / 60;\n\n      if (h == 360) h = 0;\n\n          if (h < 60) { rgb.r = t1; rgb.b = t2; rgb.g = t2 + t3 }\n          else if (h < 120) { rgb.g = t1; rgb.b = t2; rgb.r = t1 - t3 }\n          else if (h < 180) { rgb.g = t1; rgb.r = t2; rgb.b = t2 + t3 }\n          else if (h < 240) { rgb.b = t1; rgb.r = t2; rgb.g = t1 - t3 }\n          else if (h < 300) { rgb.b = t1; rgb.g = t2; rgb.r = t2 + t3 }\n          else if (h < 360) { rgb.r = t1; rgb.g = t2; rgb.b = t1 - t3 }\n          else { rgb.r = 0; rgb.g = 0; rgb.b = 0 }\n  }\n\n  return { r: Math.round(rgb.r), g: Math.round(rgb.g), b: Math.round(rgb.b) };\n}","finalize":"","x":360,"y":60,"wires":[["4c7c9022.2b82b","2e8c4ce5.8a1274"]]},{"id":"4c7c9022.2b82b","type":"debug","z":"bc0658fa.ce5778","name":"alexa modified","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":640,"y":60,"wires":[]},{"id":"ae6e39ad.7ffe08","type":"comment","z":"bc0658fa.ce5778","name":"true, false, or an object","info":"","x":460,"y":140,"wires":[]},{"id":"67517743.63ef78","type":"node-hue-in","z":"bc0658fa.ce5778","server":"e5843571.d374f8","lightID":"light6","name":"p-fish tank","x":150,"y":460,"wires":[]},{"id":"fb173e0b.71d0a","type":"node-hue-in","z":"bc0658fa.ce5778","server":"e5843571.d374f8","lightID":"light5","name":"p-piano","x":140,"y":500,"wires":[]},{"id":"bab5fa6d.a298e8","type":"alexa-home","z":"bc0658fa.ce5778","conf":"69543e7577c6ab2b","device":"115095","acknoledge":true,"name":"Piano Room Lights","topic":"","x":90,"y":80,"wires":[["6842e22f.ece43c","3485a3c7.92ed6c"]]},{"id":"e77923b6.d2c8","type":"node-hue-in","z":"bc0658fa.ce5778","server":"e5843571.d374f8","lightID":"light4","name":"p-desk","x":480,"y":420,"wires":[]},{"id":"4c3f9eba.a608c","type":"node-hue-in","z":"bc0658fa.ce5778","server":"e5843571.d374f8","lightID":"light6","name":"p-fish tank","x":490,"y":460,"wires":[]},{"id":"a9287005.3409","type":"node-hue-in","z":"bc0658fa.ce5778","server":"e5843571.d374f8","lightID":"light5","name":"p-piano","x":480,"y":500,"wires":[]},{"id":"3be8a9be.c28296","type":"node-hue-in","z":"bc0658fa.ce5778","server":"e5843571.d374f8","lightID":"light4","name":"p-desk","x":780,"y":340,"wires":[]},{"id":"1da95d1f.b5f233","type":"node-hue-in","z":"bc0658fa.ce5778","server":"e5843571.d374f8","lightID":"light6","name":"p-fish tank","x":790,"y":380,"wires":[]},{"id":"97719562.c97428","type":"node-hue-in","z":"bc0658fa.ce5778","server":"e5843571.d374f8","lightID":"light5","name":"p-piano","x":780,"y":420,"wires":[]},{"id":"c09d6bec.a0d818","type":"api-call-service","z":"bc0658fa.ce5778","name":"turn p ceiling on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.p_ceiling_piano_level","light.p_ceiling_back_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1060,"y":340,"wires":[[]]},{"id":"665d3c25.1df994","type":"api-call-service","z":"bc0658fa.ce5778","name":"turn kitchen/hallway on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.kitchen_light_level","light.kitchen_hallway_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1090,"y":380,"wires":[[]]},{"id":"c5859ec6.c5af4","type":"function","z":"bc0658fa.ce5778","name":"change brightness","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\") {\n    //NUMBER IS BRIGHTNESS\n    msg.payload = {\"data\":{\"brightness\": msg.payload * 2.55}}\n} else if (payloadType === \"object\") {\n    //OBJECT - GET BRIGHTNESS FROM PROP\n    if (msg.payload.hue) {\n        //COLOR CHANGE - TURN NON-COLOR LIGHTS OFF\n        msg.payload = {\"data\":{\"brightness\": 0}}\n    } else if (msg.payload.brightness) {\n        msg.payload = {\"data\":{\"brightness\": msg.payload.brightness * 2.55}}\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1050,"y":300,"wires":[["c09d6bec.a0d818","665d3c25.1df994","bf9d3e38.cbfcc"]]},{"id":"bf9d3e38.cbfcc","type":"api-call-service","z":"bc0658fa.ce5778","name":"turn upper, screened, and back deck on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.upper_deck_lights_level","light.back_porch_level","light.screened_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1140,"y":420,"wires":[[]]},{"id":"58276ecd.0e109","type":"inject","z":"10165488.1423ab","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"kelvin\":2700}","payloadType":"json","x":120,"y":1600,"wires":[["bd8aa3eb.b9f0b","37983da5.336cb2","54d17eee.50f02","ef49b9a0.581de8","cd4a36a4.9d0d38","f2202351.dc646","6d5f71cf.2df59","6abc01aa.35a81","b205efd5.c8762","c698370.d5ca6c8"]]},{"id":"bd8aa3eb.b9f0b","type":"node-hue-in","z":"10165488.1423ab","server":"e5843571.d374f8","lightID":"light4","name":"P Desk","x":340,"y":1580,"wires":[]},{"id":"37983da5.336cb2","type":"node-hue-in","z":"10165488.1423ab","server":"e5843571.d374f8","lightID":"light6","name":"P Fish Tank","x":350,"y":1640,"wires":[]},{"id":"6d5f71cf.2df59","type":"node-hue-in","z":"10165488.1423ab","server":"e5843571.d374f8","lightID":"light9","name":"LR Couch","x":340,"y":1940,"wires":[]},{"id":"f2202351.dc646","type":"node-hue-in","z":"10165488.1423ab","server":"e5843571.d374f8","lightID":"light3","name":"LR Fireplace","x":350,"y":1880,"wires":[]},{"id":"cd4a36a4.9d0d38","type":"node-hue-in","z":"10165488.1423ab","server":"e5843571.d374f8","lightID":"light7","name":"LR Window","x":350,"y":1820,"wires":[]},{"id":"ef49b9a0.581de8","type":"node-hue-in","z":"10165488.1423ab","server":"e5843571.d374f8","lightID":"light2","name":"Kitchen Corner","x":360,"y":1760,"wires":[]},{"id":"54d17eee.50f02","type":"node-hue-in","z":"10165488.1423ab","server":"e5843571.d374f8","lightID":"light5","name":"P Piano","x":340,"y":1700,"wires":[]},{"id":"c698370.d5ca6c8","type":"node-hue-in","z":"10165488.1423ab","server":"e5843571.d374f8","lightID":"light9","name":"LR Couch","x":340,"y":2120,"wires":[]},{"id":"b205efd5.c8762","type":"node-hue-in","z":"10165488.1423ab","server":"e5843571.d374f8","lightID":"light12","name":"LR Screened Porch","x":370,"y":2060,"wires":[]},{"id":"6abc01aa.35a81","type":"node-hue-in","z":"10165488.1423ab","server":"e5843571.d374f8","lightID":"light8","name":"LR Strip","x":340,"y":2000,"wires":[]},{"id":"944a3cbb.6b12c","type":"switch","z":"10165488.1423ab","name":"switch for indoor lights","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":380,"y":700,"wires":[[],[]]},{"id":"f6545b3f.923798","type":"alexa-home","z":"10165488.1423ab","conf":"69543e7577c6ab2b","device":"114860","acknoledge":true,"name":"Outdoor Lights","topic":"","x":80,"y":40,"wires":[["8ffa80f6.cbb46"]]},{"id":"abfd4f09.8bba9","type":"change","z":"10165488.1423ab","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"bool","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"bool","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":180,"wires":[["944a3cbb.6b12c","1a008f23.688f01"]]},{"id":"d4347f13.66573","type":"function","z":"10165488.1423ab","name":"turn off hue","func":"msg.payload = {\"on\":false}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1110,"y":800,"wires":[["e3cace4.dd09a3"]]},{"id":"e3cace4.dd09a3","type":"node-hue-in","z":"10165488.1423ab","server":"e5843571.d374f8","lightID":"group1","name":"outside hue","x":1290,"y":820,"wires":[]},{"id":"f640f058.9a5c6","type":"api-call-service","z":"10165488.1423ab","name":"turn upper, screened, and back deck off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.upper_deck_lights_level","light.back_porch_level","light.screened_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1200,"y":880,"wires":[[]]},{"id":"7d017d0b.7db9e4","type":"api-call-service","z":"10165488.1423ab","name":"turn driveways off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.driveway_lighting_switch","switch.driveway_side_door_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1130,"y":920,"wires":[[]]},{"id":"1a008f23.688f01","type":"switch","z":"10165488.1423ab","name":"switch for outdoor lights","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":810,"y":720,"wires":[["bf9b61b1.75a4d","301441d8.394e4e"],["d4347f13.66573","f640f058.9a5c6","7d017d0b.7db9e4","9c8edaab.58b168"]]},{"id":"bf9b61b1.75a4d","type":"function","z":"10165488.1423ab","name":"turn on hue","func":"msg.payload = {\"on\":true, \"brightness\": 100, \"kelvin\":2400}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":930,"y":560,"wires":[["5f9a2bf4.a394d4","1eeabdf.e356842"]]},{"id":"5f9a2bf4.a394d4","type":"node-hue-in","z":"10165488.1423ab","server":"e5843571.d374f8","lightID":"group1","name":"outside hue","x":1110,"y":560,"wires":[]},{"id":"f28e9c25.2cbe4","type":"api-call-service","z":"10165488.1423ab","name":"turn upper, screened, and back deck on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.upper_deck_lights_level","light.back_porch_level","light.screened_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1400,"y":580,"wires":[[]]},{"id":"dc231ae2.93d3e8","type":"api-call-service","z":"10165488.1423ab","name":"turn driveways on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.driveway_lighting_switch","switch.driveway_side_door_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1330,"y":620,"wires":[[]]},{"id":"7cbfc6a4.a7ee38","type":"switch","z":"10165488.1423ab","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":270,"y":180,"wires":[["abfd4f09.8bba9"],["abfd4f09.8bba9"],["8a07309f.0495d","5d53d0d0.b86a8","e2e05da3.2353e","c3bf1cd3.3e5e9"]]},{"id":"8ffa80f6.cbb46","type":"function","z":"10165488.1423ab","name":"set brightness on hue","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\n\nif (payloadType === \"number\")\n    msg.payload = {\"brightness\": msg.payload};\n    \nif (msg.payload.brightness && msg.payload.brightness <= 1)\n    msg.payload.brightness = msg.payload.brightness * 100;\n\nif (msg.payload.brightness)\n    msg.payload[\"on\"]=true;\n    \nif (msg.payload.hasOwnProperty(\"hue\")) {\n    let rgb = HSBToRGB(msg.payload.hue,msg.payload.saturation,1)\n    msg.payload[\"red\"]=rgb.r;\n    msg.payload[\"green\"]=rgb.g;\n    msg.payload[\"blue\"]=rgb.b;\n    msg.payload[\"brightness\"]=100;\n    delete msg.payload.hue;\n    delete msg.payload.saturation;\n} else {\n    msg.payload[\"kelvin\"]=2700;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\nHSBToRGB = function (h,s,b) {\n  var hsb = {\"h\":h,\"s\":s,\"b\":b};\n  var rgb = { };\n  var h = Math.round(hsb.h);\n  var s = Math.round(hsb.s * 255);\n  var v = Math.round(hsb.b * 255);\n\n  if (s == 0) {\n\n    rgb.r = rgb.g = rgb.b = v;\n  } else {\n  var t1 = v;\n  var t2 = (255 - s) * v / 255;\n  var t3 = (t1 - t2) * (h % 60) / 60;\n\n      if (h == 360) h = 0;\n\n          if (h < 60) { rgb.r = t1; rgb.b = t2; rgb.g = t2 + t3 }\n          else if (h < 120) { rgb.g = t1; rgb.b = t2; rgb.r = t1 - t3 }\n          else if (h < 180) { rgb.g = t1; rgb.r = t2; rgb.b = t2 + t3 }\n          else if (h < 240) { rgb.b = t1; rgb.r = t2; rgb.g = t1 - t3 }\n          else if (h < 300) { rgb.b = t1; rgb.g = t2; rgb.r = t2 + t3 }\n          else if (h < 360) { rgb.r = t1; rgb.g = t2; rgb.b = t1 - t3 }\n          else { rgb.r = 0; rgb.g = 0; rgb.b = 0 }\n  }\n\n  return { r: Math.round(rgb.r), g: Math.round(rgb.g), b: Math.round(rgb.b) };\n}","finalize":"","x":360,"y":60,"wires":[["d8a5a59f.34d618","7cbfc6a4.a7ee38"]]},{"id":"d8a5a59f.34d618","type":"debug","z":"10165488.1423ab","name":"alexa modified","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":640,"y":60,"wires":[]},{"id":"22202ceb.dc2404","type":"comment","z":"10165488.1423ab","name":"true, false, or an object","info":"","x":460,"y":140,"wires":[]},{"id":"1eeabdf.e356842","type":"function","z":"10165488.1423ab","name":"use 255 scale","func":"if (msg.payload.brightness)\n    msg.payload.brightness = (msg.payload.brightness * 2.55);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1120,"y":600,"wires":[["f28e9c25.2cbe4","dc231ae2.93d3e8"]]},{"id":"70495cb8.f8bcf4","type":"alexa-home","z":"10165488.1423ab","conf":"69543e7577c6ab2b","device":"115098","acknoledge":true,"name":"Landscape Lights","topic":"","x":90,"y":100,"wires":[["8ffa80f6.cbb46"]]},{"id":"9c8edaab.58b168","type":"api-call-service","z":"10165488.1423ab","name":"landscape lights off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.landscape_lights_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1130,"y":740,"wires":[[]]},{"id":"301441d8.394e4e","type":"api-call-service","z":"10165488.1423ab","name":"landscape lights on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.landscape_lights_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1130,"y":660,"wires":[[]]},{"id":"8a07309f.0495d","type":"node-hue-in","z":"10165488.1423ab","server":"e5843571.d374f8","lightID":"group1","name":"outside hue","x":150,"y":600,"wires":[]},{"id":"7b1cb639.6c73f8","type":"api-call-service","z":"10165488.1423ab","name":"outside switch on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.driveway_side_door_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":210,"y":500,"wires":[[]]},{"id":"4e45a37f.6e74ec","type":"api-call-service","z":"10165488.1423ab","name":"oustide dimmable non-hue on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.upper_deck_lights_level","light.back_porch_level","light.screened_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":250,"y":340,"wires":[[]]},{"id":"5d53d0d0.b86a8","type":"function","z":"10165488.1423ab","name":"set brightness on non-hue","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\")\n\tmsg.payload = {\"brightness\": msg.payload};\n\n\nif (msg.payload.hasOwnProperty(\"hue\") || !msg.payload.brightness)\n    msg.payload[\"brightness\"] = 100;\n\nif (msg.payload.brightness)\n    msg.payload = {brightness: (msg.payload.brightness * 2.55)};\n    \nmsg.payload[\"on\"]=true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":300,"wires":[["4e45a37f.6e74ec"]]},{"id":"e2e05da3.2353e","type":"function","z":"10165488.1423ab","name":"change brightness non-hue","func":"//FOR NON DIMMABLE OUTDOOR LIGHTS\n//IF COLOR - TURN ON, OTHERWISE, TURN OFF\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\") {\n    //NUMBER IS BRIGHTNESS\n    msg.payload = 1;\n} else if (payloadType === \"object\") {\n    //OBJECT - GET BRIGHTNESS FROM PROP\n    if (msg.payload.hue || msg.payload.red || msg.payload.green || msg.payload.blue) {\n        //COLOR CHANGE - TURN NON-COLOR LIGHTS OFF\n        msg.payload = 0;\n    } else if (msg.payload.brightness) {\n        msg.payload = 1;\n    } else {\n        msg.payload = 0;\n    }\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":200,"y":380,"wires":[["90ebf238.e5e27"]]},{"id":"90ebf238.e5e27","type":"switch","z":"10165488.1423ab","name":"if brightness > 0","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":180,"y":440,"wires":[["7b1cb639.6c73f8"],["d5b83b4f.91a3a8"]]},{"id":"d5b83b4f.91a3a8","type":"api-call-service","z":"10165488.1423ab","name":"outside switch off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.driveway_side_door_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":210,"y":540,"wires":[[]]},{"id":"c3bf1cd3.3e5e9","type":"debug","z":"10165488.1423ab","name":"outdoor action","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":490,"y":300,"wires":[]},{"id":"a459b6d4.8a7d98","type":"inject","z":"1256e471.1f69ac","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"kelvin\":2700}","payloadType":"json","x":120,"y":1620,"wires":[["82f48e29.ba737","b06e872d.d6eab8","d81b8441.21a9a8","fdc48d6e.ebde2","5a397ba.5405c84","4f13eed3.74636","961cc149.77859","be51e7df.385478","db873912.86dba8","8aada55f.5acfa8"]]},{"id":"82f48e29.ba737","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"light4","name":"P Desk","x":340,"y":1600,"wires":[]},{"id":"b06e872d.d6eab8","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"light6","name":"P Fish Tank","x":350,"y":1660,"wires":[]},{"id":"961cc149.77859","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"light9","name":"LR Couch","x":340,"y":1960,"wires":[]},{"id":"4f13eed3.74636","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"light3","name":"LR Fireplace","x":350,"y":1900,"wires":[]},{"id":"5a397ba.5405c84","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"light7","name":"LR Window","x":350,"y":1840,"wires":[]},{"id":"fdc48d6e.ebde2","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"light2","name":"Kitchen Corner","x":360,"y":1780,"wires":[]},{"id":"d81b8441.21a9a8","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"light5","name":"P Piano","x":340,"y":1720,"wires":[]},{"id":"8aada55f.5acfa8","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"light9","name":"LR Couch","x":340,"y":2140,"wires":[]},{"id":"db873912.86dba8","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"light12","name":"LR Screened Porch","x":370,"y":2080,"wires":[]},{"id":"be51e7df.385478","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"light8","name":"LR Strip","x":340,"y":2020,"wires":[]},{"id":"30d830aa.ece11","type":"api-call-service","z":"1256e471.1f69ac","name":"turn p ceiling on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.p_ceiling_piano_level","light.p_ceiling_back_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":140,"y":640,"wires":[[]]},{"id":"d153d6bf.e33928","type":"function","z":"1256e471.1f69ac","d":true,"name":"dim 15%","func":"msg.payload = {\"data\":{\"brightness\": 15 * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":100,"y":600,"wires":[["30d830aa.ece11"]]},{"id":"6e588f20.37db6","type":"api-call-service","z":"1256e471.1f69ac","name":"turn kitchen/hallway on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.kitchen_light_level","light.kitchen_hallway_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":170,"y":720,"wires":[[]]},{"id":"2d1a4724.f567e8","type":"function","z":"1256e471.1f69ac","d":true,"name":"dim 80%","func":"msg.payload = {\"data\":{\"brightness\": 80 * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":100,"y":680,"wires":[["6e588f20.37db6"]]},{"id":"bfdc5df9.7d8c7","type":"sunrise","z":"1256e471.1f69ac","d":true,"name":"45 min bf set, 4hrs bf rise","lat":"38.810937","lon":"-77.155829","start":"sunrise","end":"sunsetStart","soff":"-240","eoff":"-45","x":110,"y":360,"wires":[[],["4c4c92d.0070a6c","da9cb7d3.a64258"]]},{"id":"4c4c92d.0070a6c","type":"switch","z":"1256e471.1f69ac","name":"switch for indoor lights","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":380,"y":360,"wires":[["d153d6bf.e33928","2d1a4724.f567e8","e0b364f1.a76c88","a5ea5195.f2da4"],["e2f1e8b3.ef51e8","34d765ee.3b586a","3b1d945f.6ce28c","1aef526f.33776e"]]},{"id":"e2f1e8b3.ef51e8","type":"function","z":"1256e471.1f69ac","d":true,"name":"turn off hue","func":"msg.payload = {\"on\":false}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":540,"wires":[["209efb8e.36b364"]]},{"id":"209efb8e.36b364","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"group2","name":"inside hue","x":430,"y":580,"wires":[]},{"id":"34d765ee.3b586a","type":"api-call-service","z":"1256e471.1f69ac","d":true,"name":"turn p ceiling of","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.p_ceiling_piano_level","light.p_ceiling_back_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":400,"y":640,"wires":[[]]},{"id":"3b1d945f.6ce28c","type":"api-call-service","z":"1256e471.1f69ac","d":true,"name":"turn kitchen/hallway off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.kitchen_hallway_level","light.kitchen_light_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":430,"y":680,"wires":[[]]},{"id":"97130532.1cd3c8","type":"alexa-home","z":"1256e471.1f69ac","d":true,"conf":"30224eff.8e7852","device":"114838","acknoledge":true,"name":"Main Lights","topic":"","x":70,"y":60,"wires":[["96437b25.fb51e8","fa4f76aa.4a8938"]]},{"id":"510807fa.bc7958","type":"change","z":"1256e471.1f69ac","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"bool","to":"0","tot":"num"},{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"bool","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":220,"wires":[["4c4c92d.0070a6c","da9cb7d3.a64258"]]},{"id":"f63f6660.51cff8","type":"function","z":"1256e471.1f69ac","d":true,"name":"turn off hue","func":"msg.payload = {\"on\":false}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1170,"y":500,"wires":[["d7a9d6e1.661fd8"]]},{"id":"d7a9d6e1.661fd8","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"group1","name":"outside hue","x":1210,"y":540,"wires":[]},{"id":"3e262640.22e65a","type":"api-call-service","z":"1256e471.1f69ac","d":true,"name":"turn upper, screened, and back deck off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.upper_deck_lights_level","light.back_porch_level","light.screened_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1260,"y":580,"wires":[[]]},{"id":"d7ae7ca.dd4cc8","type":"api-call-service","z":"1256e471.1f69ac","d":true,"name":"turn driveways and prch power off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.driveway_lighting_switch","switch.driveway_side_door_switch","switch.porch_power_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1240,"y":620,"wires":[[]]},{"id":"da9cb7d3.a64258","type":"switch","z":"1256e471.1f69ac","name":"switch for outdoor lights","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":890,"y":360,"wires":[["94cf1686.bd8b98","cbf038ea.1ed8e8"],["f63f6660.51cff8","3e262640.22e65a","d7ae7ca.dd4cc8","e06a9c63.0ad21"]]},{"id":"94cf1686.bd8b98","type":"function","z":"1256e471.1f69ac","d":true,"name":"turn on hue","func":"msg.payload = {\"on\":true, \"brightness\": 100, \"kelvin\":2400}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":810,"y":480,"wires":[["46cc8d6f.ce2124"]]},{"id":"4637b011.8234e","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"group1","name":"outside hue","x":850,"y":640,"wires":[]},{"id":"c87cdc35.3faab","type":"api-call-service","z":"1256e471.1f69ac","name":"turn upper, screened, and back deck on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.upper_deck_lights_level","light.back_porch_level","light.screened_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1020,"y":700,"wires":[[]]},{"id":"5eab59a2.6239c8","type":"api-call-service","z":"1256e471.1f69ac","name":"turn driveways and prch power on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.driveway_lighting_switch","switch.driveway_side_door_switch","switch.porch_power_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1000,"y":740,"wires":[[]]},{"id":"c6dc7ea0.50841","type":"switch","z":"1256e471.1f69ac","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":370,"y":220,"wires":[["510807fa.bc7958"],["510807fa.bc7958"],["254e0b6f.682974","e23283d2.b808f"]]},{"id":"e0b364f1.a76c88","type":"function","z":"1256e471.1f69ac","d":true,"name":"turn on hue","func":"msg.payload = {\"on\":true, \"kelvin\":2400, \"brightness\": 100}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":110,"y":520,"wires":[["d9ea8dff.311eb"]]},{"id":"d9ea8dff.311eb","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"group2","name":"inside hue","x":150,"y":560,"wires":[]},{"id":"1778a71.5b88359","type":"api-call-service","z":"1256e471.1f69ac","name":"turn p ceiling on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.p_ceiling_piano_level","light.p_ceiling_back_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":400,"y":880,"wires":[[]]},{"id":"a0811a6.20ecae8","type":"api-call-service","z":"1256e471.1f69ac","name":"turn kitchen/hallway on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.kitchen_light_level","light.kitchen_hallway_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":430,"y":920,"wires":[[]]},{"id":"e23283d2.b808f","type":"function","z":"1256e471.1f69ac","name":"set brightness on hue","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\")\n\tmsg.payload = {\"brightness\": msg.payload};\n//IF COLOR - CHANGE BRIGHTNESS TO 100%\nif (msg.payload.hasOwnProperty(\"hue\") || !msg.payload.brightness)\n    msg.payload[\"brightness\"] = 100;\n\n//if (!msg.payload.hasOwnProperty(\"hue\"))\n//    msg.payload[\"kelvin\"] = 2400;\n    \nmsg.payload[\"on\"]=true;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":720,"y":840,"wires":[["d67d6a9c.960248","bd5b5b29.3fb808"]]},{"id":"d67d6a9c.960248","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"group2","name":"inside hue","x":730,"y":880,"wires":[]},{"id":"254e0b6f.682974","type":"function","z":"1256e471.1f69ac","name":"change brightness","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\nif (payloadType === \"number\") {\n    //NUMBER IS BRIGHTNESS\n    msg.payload = {\"data\":{\"brightness\": msg.payload * 2.55}}\n} else if (payloadType === \"object\") {\n    //OBJECT - GET BRIGHTNESS FROM PROP\n    if (msg.payload.hue) {\n        //COLOR CHANGE - TURN NON-COLOR LIGHTS OFF\n        msg.payload = {\"data\":{\"brightness\": 0}}\n    } else if (msg.payload.brightness) {\n        msg.payload = {\"data\":{\"brightness\": msg.payload.brightness * 2.55}}\n    }\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":390,"y":840,"wires":[["1778a71.5b88359","a0811a6.20ecae8","392e3644.523b5a"]]},{"id":"3da5859d.ef966a","type":"node-hue-in","z":"1256e471.1f69ac","server":"e5843571.d374f8","lightID":"group1","name":"outside hue","x":870,"y":1000,"wires":[]},{"id":"392e3644.523b5a","type":"api-call-service","z":"1256e471.1f69ac","name":"turn upper, screened, and back deck on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.upper_deck_lights_level","light.back_porch_level","light.screened_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":480,"y":960,"wires":[[]]},{"id":"96437b25.fb51e8","type":"debug","z":"1256e471.1f69ac","name":"alexa command","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":300,"y":40,"wires":[]},{"id":"fa4f76aa.4a8938","type":"function","z":"1256e471.1f69ac","name":"set brightness and modify color on hue","func":"//CHECK THE PAYLOAD TYPE\nlet payloadType = (typeof msg.payload);\n\nif (payloadType === \"number\")\n    return msg;\n    \nif (msg.payload.saturation)\n    msg.payload.saturation = msg.payload.saturation * 100;\n    \nif (msg.payload.brightness)\n    msg.payload.brightness = msg.payload.brightness * 100;\n    \nif (msg.payload.hasOwnProperty(\"hue\")) {\n    if (msg.payload.hue === 0) {\n        //RED\n        msg.payload[\"red\"]=255;\n        msg.payload[\"green\"]=0;\n        msg.payload[\"blue\"]=0;\n    }\n    if (msg.payload.hue === 240) {\n        //RED\n        msg.payload[\"red\"]=0;\n        msg.payload[\"green\"]=0;\n        msg.payload[\"blue\"]=255;\n    }\n} else {\n    msg.payload[\"kelvin\"]=2700;\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":420,"y":80,"wires":[["419f1e5b.e4acb","c6dc7ea0.50841"]]},{"id":"419f1e5b.e4acb","type":"debug","z":"1256e471.1f69ac","name":"alexa modified","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":740,"y":80,"wires":[]},{"id":"2088dd37.914792","type":"comment","z":"1256e471.1f69ac","name":"true, false, or an object","info":"","x":460,"y":160,"wires":[]},{"id":"65381e08.faa3a","type":"function","z":"1256e471.1f69ac","name":"turn off outdoor light","func":"msg.payload[\"on\"]=false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":980,"y":940,"wires":[["4c1dd814.0e55f8","3da5859d.ef966a"]]},{"id":"4c1dd814.0e55f8","type":"debug","z":"1256e471.1f69ac","name":"modified msg","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1020,"y":1080,"wires":[]},{"id":"bd5b5b29.3fb808","type":"time-range-switch","z":"1256e471.1f69ac","name":"if night time","lat":"","lon":"","startTime":"night","endTime":"nightEnd","startOffset":0,"endOffset":0,"x":730,"y":940,"wires":[["3da5859d.ef966a"],["65381e08.faa3a","3e262640.22e65a","d7ae7ca.dd4cc8"]]},{"id":"46cc8d6f.ce2124","type":"time-range-switch","z":"1256e471.1f69ac","name":"if night time","lat":"","lon":"","startTime":"night","endTime":"nightEnd","startOffset":0,"endOffset":0,"x":810,"y":520,"wires":[["4637b011.8234e","88222654.4d9188"],["e7042239.400f2","3e262640.22e65a","d7ae7ca.dd4cc8"]]},{"id":"e7042239.400f2","type":"function","z":"1256e471.1f69ac","name":"turn off outdoor light","func":"msg.payload[\"on\"]=false;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":875,"y":570,"wires":[["4637b011.8234e"]]},{"id":"88222654.4d9188","type":"function","z":"1256e471.1f69ac","name":"use 255 scale","func":"if (msg.payload.brightness)\n    msg.payload.brightness = (msg.payload.brightness * 2.55);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":740,"y":720,"wires":[["c87cdc35.3faab","5eab59a2.6239c8"]]},{"id":"a5ea5195.f2da4","type":"subflow:63a3316a.c01fc","z":"1256e471.1f69ac","name":"","x":170,"y":440,"wires":[]},{"id":"1aef526f.33776e","type":"subflow:ef05d161.c6c31","z":"1256e471.1f69ac","name":"","x":410,"y":440,"wires":[]},{"id":"cbf038ea.1ed8e8","type":"subflow:6bd38239.2d4d5c","z":"1256e471.1f69ac","name":"","x":870,"y":420,"wires":[]},{"id":"e06a9c63.0ad21","type":"subflow:56970ff1.d6c68","z":"1256e471.1f69ac","name":"","x":1100,"y":420,"wires":[]},{"id":"e44d09f0.815988","type":"alexa-home","z":"8255b3dd.d909c","conf":"69543e7577c6ab2b","device":"115140","acknoledge":true,"name":"Screened Porch","topic":"","x":80,"y":100,"wires":[["d6f2249f.843688"]]},{"id":"d6f2249f.843688","type":"switch","z":"8255b3dd.d909c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":290,"y":100,"wires":[["92f4a3a6.86126"],["ec8ca62a.2fcb08"],["ad74a6dd.63f478"]]},{"id":"2f70d5a4.bec09a","type":"api-call-service","z":"8255b3dd.d909c","name":"turn screened porch lights on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.screened_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":860,"y":100,"wires":[[]]},{"id":"ec8ca62a.2fcb08","type":"api-call-service","z":"8255b3dd.d909c","name":"turn screened porch lights off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.screened_porch_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":510,"y":100,"wires":[[]]},{"id":"ad74a6dd.63f478","type":"function","z":"8255b3dd.d909c","name":"change brightness","func":"msg.payload = {\"data\":{\"brightness\": msg.payload * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":140,"wires":[["2f70d5a4.bec09a"]]},{"id":"92f4a3a6.86126","type":"function","z":"8255b3dd.d909c","name":"full brightness","func":"msg.payload = {\"data\":{\"brightness\": 80 * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":60,"wires":[["2f70d5a4.bec09a"]]},{"id":"3fce881d.3a9cb8","type":"alexa-home","z":"2590f302.3da8ec","conf":"69543e7577c6ab2b","device":"115143","acknoledge":true,"name":"Hallway Lights","topic":"","x":80,"y":60,"wires":[["4dbd1888.38d668"]]},{"id":"4dbd1888.38d668","type":"switch","z":"2590f302.3da8ec","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":290,"y":60,"wires":[["82f2c8d.5dc6f38"],["4ad52c7e.43d3a4"],["4c8dcf0.605e73"]]},{"id":"39af5a98.8036e6","type":"api-call-service","z":"2590f302.3da8ec","name":"turn hallway lights on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.kitchen_hallway_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":760,"y":60,"wires":[[]]},{"id":"4ad52c7e.43d3a4","type":"api-call-service","z":"2590f302.3da8ec","name":"turn hallway lights off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.kitchen_hallway_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":480,"y":60,"wires":[[]]},{"id":"4c8dcf0.605e73","type":"function","z":"2590f302.3da8ec","name":"change brightness","func":"msg.payload = {\"data\":{\"brightness\": msg.payload * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":100,"wires":[["39af5a98.8036e6"]]},{"id":"82f2c8d.5dc6f38","type":"function","z":"2590f302.3da8ec","name":"full brightness","func":"msg.payload = {\"data\":{\"brightness\": 80 * 2.55}}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":20,"wires":[["39af5a98.8036e6"]]},{"id":"ed3606a2.aa3868","type":"alexa-home","z":"1e9cfcb8.4e3eb3","conf":"69543e7577c6ab2b","device":"115144","acknoledge":true,"name":"Driveway Lights","topic":"","x":100,"y":80,"wires":[["d31a4ce.337fcb"]]},{"id":"e2b7cf82.f19c8","type":"alexa-home","z":"1e9cfcb8.4e3eb3","conf":"69543e7577c6ab2b","device":"115145","acknoledge":true,"name":"Carport Lights","topic":"","x":90,"y":140,"wires":[["d31a4ce.337fcb"]]},{"id":"d31a4ce.337fcb","type":"switch","z":"1e9cfcb8.4e3eb3","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":305,"y":100,"wires":[["c2e858f6995dcbb7"],["d6d92314e96b4e1b"]]},{"id":"4e5083a6.26e51c","type":"server-state-changed","z":"1e9cfcb8.4e3eb3","d":true,"name":"carport light turned on","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"switch.driveway_lighting_switch","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":120,"y":220,"wires":[["1fd07fe5.fabd2"],[]]},{"id":"1fd07fe5.fabd2","type":"delay","z":"1e9cfcb8.4e3eb3","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":315,"y":220,"wires":[["1346a686.799d59"]]},{"id":"1346a686.799d59","type":"api-call-service","z":"1e9cfcb8.4e3eb3","name":"turn driveway/carport lights off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.driveway_lighting_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":595,"y":220,"wires":[[]]},{"id":"cce3c7a.986ac38","type":"server-state-changed","z":"1e9cfcb8.4e3eb3","name":"phone location change","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.thomass_iphone_geocoded_location","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":115,"y":760,"wires":[["92ce0124.ec7f9"]]},{"id":"85b2733d.762be","type":"function","z":"1e9cfcb8.4e3eb3","name":"set to home and continue if was away","func":"let toms_location = flow.get(\"toms_location\");\nif (!toms_location) toms_location = \"unknown\";\nif (toms_location !== \"home\") flow.set(\"toms_location\", \"home\");\nif (toms_location == \"away\") return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":625,"y":732,"wires":[["c7958da9f6582396","964b641a8c684031"]]},{"id":"216c0768.9db548","type":"function","z":"1e9cfcb8.4e3eb3","name":"set to away","func":"let toms_location = flow.get(\"toms_location\");\nif (!toms_location) toms_location = \"unknown\";\nif (toms_location !== \"away\") flow.set(\"toms_location\", \"away\");","outputs":0,"noerr":0,"initialize":"","finalize":"","x":545,"y":792,"wires":[]},{"id":"8f661657.e0fab8","type":"api-current-state","z":"1e9cfcb8.4e3eb3","name":"if driveway lighting is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.driveway_lighting_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1210,"y":440,"wires":[["64e8e196.60662"],[]]},{"id":"64e8e196.60662","type":"api-call-service","z":"1e9cfcb8.4e3eb3","name":"turn driveway lighting on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.driveway_lighting_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1310,"y":500,"wires":[[]]},{"id":"9130cef5.eb69","type":"time-range-switch","z":"1e9cfcb8.4e3eb3","name":"if sunset started or night","lat":"38.810770","lon":"-77.155803","startTime":"sunsetStart","endTime":"sunrise","startOffset":0,"endOffset":0,"x":925,"y":380,"wires":[["10d7e2cd8ecde641"],[]]},{"id":"7418853.04f8a7c","type":"server-state-changed","z":"1e9cfcb8.4e3eb3","d":true,"name":"driveway alarm","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.drivewayalarm","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":100,"y":380,"wires":[["1d7e6f2d.ce2e21","7f668e92f63e771d","846214e48dc056ed"],[]]},{"id":"1d7e6f2d.ce2e21","type":"function","z":"1e9cfcb8.4e3eb3","name":"create driveway message","func":"msg.payload = `Driveway Alarm`\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":425,"y":320,"wires":[["d20988cf.b07718"]]},{"id":"e942cf8c.8b9ea","type":"subflow:71a3fd81.9edc14","z":"1e9cfcb8.4e3eb3","d":true,"name":"","x":945,"y":320,"wires":[]},{"id":"92ce0124.ec7f9","type":"subflow:81129f40.2fca5","z":"1e9cfcb8.4e3eb3","name":"","x":336,"y":760,"wires":[["85b2733d.762be"],["216c0768.9db548"]]},{"id":"3048b2d4.a299ae","type":"server-state-changed","z":"1e9cfcb8.4e3eb3","d":true,"name":"driveway front alarm","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.drivewayfrontalarm","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":110,"y":440,"wires":[["97890064.980eb","7f668e92f63e771d","d9b2a86408f9c956"],[]]},{"id":"97890064.980eb","type":"function","z":"1e9cfcb8.4e3eb3","name":"create driveway front message","func":"msg.payload = `Driveway Front Alarm`\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":445,"y":360,"wires":[["d20988cf.b07718"]]},{"id":"d20988cf.b07718","type":"subflow:81129f40.2fca5","z":"1e9cfcb8.4e3eb3","name":"","x":715,"y":320,"wires":[[],["e942cf8c.8b9ea"]]},{"id":"1e0d19a1a5894134","type":"server-state-changed","z":"1e9cfcb8.4e3eb3","name":"driveway motion","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.motion_sensor_motion","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":95,"y":680,"wires":[["f1ee14220a4cdbf8"],[]]},{"id":"f1ee14220a4cdbf8","type":"function","z":"1e9cfcb8.4e3eb3","name":"Set DrivewayLightsOnUntil To 5 Min From Now","func":"const getCurEpoch = () => {\n\tlet now = new Date()  \n\tlet secondsSinceEpoch = Math.round(now.getTime() / 1000);\n\tlet minsSinceEpoch = Math.floor(secondsSinceEpoch/60);\n\t\n\t//let hoursSinceEpoch = Math.floor(minsSinceEpoch/60);\n\t//return secondsSinceEpoch;\n\t//return hoursSinceEpoch;\n\treturn minsSinceEpoch; \n}\nconst setFlowTo5minutesAhead = (currentMinutes) => {\n\tflow.set(\"DrivewayLightsOnUntil\", (currentMinutes + 5)); \n}\n\nlet curMin = getCurEpoch();\nsetFlowTo5minutesAhead(curMin);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":475,"y":640,"wires":[["9130cef5.eb69","84d5bfd4c67f366f"]]},{"id":"f62ba65b0fd4e0de","type":"inject","z":"1e9cfcb8.4e3eb3","name":"every minute","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":580,"wires":[["d94086926479196e"]]},{"id":"d94086926479196e","type":"function","z":"1e9cfcb8.4e3eb3","name":"If DrivewayLightsOnUntil Is In The Future","func":"const getCurEpoch = () => {\n\tlet now = new Date()  \n\tlet secondsSinceEpoch = Math.round(now.getTime() / 1000);\n\tlet minsSinceEpoch = Math.floor(secondsSinceEpoch/60);\n\t\n\t//let hoursSinceEpoch = Math.floor(minsSinceEpoch/60);\n\t//return secondsSinceEpoch;\n\t//return hoursSinceEpoch;\n\treturn minsSinceEpoch; \n}\n\nlet curMin = getCurEpoch();\nlet DrivewayLightsOnUntil = flow.get(\"DrivewayLightsOnUntil\");\n\nif (DrivewayLightsOnUntil >= curMin) {\n\tmsg.payload = `DrivewayLightsOnUntil is ${(DrivewayLightsOnUntil - curMin)} minutes in the future.`;\n\treturn [msg, null];\n} else {\n\tmsg.payload = `DrivewayLightsOnUntil was ${((DrivewayLightsOnUntil - curMin) * -1)} minutes in the past.`;\n\treturn [null, msg];\n}\n\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":480,"y":480,"wires":[["9130cef5.eb69","9f299ee4eec9635e"],["9763f9182da03214","bd11de3b35f2ff76"]]},{"id":"10d7e2cd8ecde641","type":"function","z":"1e9cfcb8.4e3eb3","name":"If DrivewayLightsOnUntil Is In The Future","func":"const getCurEpoch = () => {\n\tlet now = new Date()  \n\tlet secondsSinceEpoch = Math.round(now.getTime() / 1000);\n\tlet minsSinceEpoch = Math.floor(secondsSinceEpoch/60);\n\t\n\t//let hoursSinceEpoch = Math.floor(minsSinceEpoch/60);\n\t//return secondsSinceEpoch;\n\t//return hoursSinceEpoch;\n\treturn minsSinceEpoch; \n}\n\nlet curMin = getCurEpoch();\nlet DrivewayLightsOnUntil = flow.get(\"DrivewayLightsOnUntil\");\n\nif (DrivewayLightsOnUntil >= curMin) {\n\tmsg.payload = `DrivewayLightsOnUntil is ${(DrivewayLightsOnUntil - curMin)} minutes in the future.`;\n\treturn msg;\n}\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1235,"y":380,"wires":[["8f661657.e0fab8"]]},{"id":"c2e858f6995dcbb7","type":"function","z":"1e9cfcb8.4e3eb3","name":"Set DrivewayLightsOnUntil To 5 Min From Now","func":"const getCurEpoch = () => {\n\tlet now = new Date()  \n\tlet secondsSinceEpoch = Math.round(now.getTime() / 1000);\n\tlet minsSinceEpoch = Math.floor(secondsSinceEpoch/60);\n\t\n\t//let hoursSinceEpoch = Math.floor(minsSinceEpoch/60);\n\t//return secondsSinceEpoch;\n\t//return hoursSinceEpoch;\n\treturn minsSinceEpoch; \n}\nconst setFlowTo5minutesAhead = (currentMinutes) => {\n\tflow.set(\"DrivewayLightsOnUntil\", (currentMinutes + 5)); \n}\n\nlet curMin = getCurEpoch();\nsetFlowTo5minutesAhead(curMin);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":635,"y":60,"wires":[["e8730225e7656ae8","4615b709eb850616"]]},{"id":"e8730225e7656ae8","type":"api-current-state","z":"1e9cfcb8.4e3eb3","name":"if driveway lighting is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.driveway_lighting_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1010,"y":40,"wires":[["2b4ce203e2bf6167"],[]]},{"id":"2b4ce203e2bf6167","type":"api-call-service","z":"1e9cfcb8.4e3eb3","name":"turn driveway lighting on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.driveway_lighting_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1110,"y":100,"wires":[[]]},{"id":"d6d92314e96b4e1b","type":"api-current-state","z":"1e9cfcb8.4e3eb3","name":"if driveway lighting is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.driveway_lighting_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1010,"y":160,"wires":[["9283dfc023efba5a"],[]]},{"id":"9283dfc023efba5a","type":"api-call-service","z":"1e9cfcb8.4e3eb3","name":"turn driveway lighting off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.driveway_lighting_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1110,"y":220,"wires":[[]]},{"id":"9763f9182da03214","type":"api-current-state","z":"1e9cfcb8.4e3eb3","name":"if driveway lighting is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.driveway_lighting_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":465,"y":520,"wires":[["ea5ec7c5e48ea58d"],[]]},{"id":"ea5ec7c5e48ea58d","type":"api-call-service","z":"1e9cfcb8.4e3eb3","name":"turn driveway lighting off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.driveway_lighting_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":565,"y":580,"wires":[[]]},{"id":"7f668e92f63e771d","type":"function","z":"1e9cfcb8.4e3eb3","name":"Set DrivewayLightsOnUntil To 5 Min From Now","func":"const getCurEpoch = () => {\n\tlet now = new Date()  \n\tlet secondsSinceEpoch = Math.round(now.getTime() / 1000);\n\tlet minsSinceEpoch = Math.floor(secondsSinceEpoch/60);\n\t\n\t//let hoursSinceEpoch = Math.floor(minsSinceEpoch/60);\n\t//return secondsSinceEpoch;\n\t//return hoursSinceEpoch;\n\treturn minsSinceEpoch; \n}\nconst setFlowTo5minutesAhead = (currentMinutes) => {\n\tflow.set(\"DrivewayLightsOnUntil\", (currentMinutes + 5)); \n}\n\nlet curMin = getCurEpoch();\nsetFlowTo5minutesAhead(curMin);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":500,"y":420,"wires":[["9130cef5.eb69"]]},{"id":"bd11de3b35f2ff76","type":"debug","z":"1e9cfcb8.4e3eb3","name":"turn off driveway light","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":820,"y":500,"wires":[]},{"id":"9f299ee4eec9635e","type":"debug","z":"1e9cfcb8.4e3eb3","name":"turn on driveway light","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":820,"y":460,"wires":[]},{"id":"c7958da9f6582396","type":"function","z":"1e9cfcb8.4e3eb3","name":"Set DrivewayLightsOnUntil To 5 Min From Now","func":"const getCurEpoch = () => {\n\tlet now = new Date()  \n\tlet secondsSinceEpoch = Math.round(now.getTime() / 1000);\n\tlet minsSinceEpoch = Math.floor(secondsSinceEpoch/60);\n\t\n\t//let hoursSinceEpoch = Math.floor(minsSinceEpoch/60);\n\t//return secondsSinceEpoch;\n\t//return hoursSinceEpoch;\n\treturn minsSinceEpoch; \n}\nconst setFlowTo5minutesAhead = (currentMinutes) => {\n\tflow.set(\"DrivewayLightsOnUntil\", (currentMinutes + 5)); \n}\n\nlet curMin = getCurEpoch();\nsetFlowTo5minutesAhead(curMin);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":875,"y":780,"wires":[["9130cef5.eb69"]]},{"id":"964b641a8c684031","type":"debug","z":"1e9cfcb8.4e3eb3","name":"phone location arrival","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":975,"y":720,"wires":[]},{"id":"84d5bfd4c67f366f","type":"debug","z":"1e9cfcb8.4e3eb3","name":"driveway motion","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":800,"y":640,"wires":[]},{"id":"846214e48dc056ed","type":"debug","z":"1e9cfcb8.4e3eb3","name":"driveway alarm","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":120,"y":320,"wires":[]},{"id":"4615b709eb850616","type":"debug","z":"1e9cfcb8.4e3eb3","name":"alexa said on","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":765,"y":120,"wires":[]},{"id":"d9b2a86408f9c956","type":"debug","z":"1e9cfcb8.4e3eb3","name":"driveway front alarm","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":140,"y":500,"wires":[]},{"id":"cc74cfb0c5f828cb","type":"function","z":"1e9cfcb8.4e3eb3","name":"Set DrivewayLightsOnUntil To 30 Min From Now","func":"const getCurEpoch = () => {\n\tlet now = new Date()  \n\tlet secondsSinceEpoch = Math.round(now.getTime() / 1000);\n\tlet minsSinceEpoch = Math.floor(secondsSinceEpoch/60);\n\t\n\t//let hoursSinceEpoch = Math.floor(minsSinceEpoch/60);\n\t//return secondsSinceEpoch;\n\t//return hoursSinceEpoch;\n\treturn minsSinceEpoch; \n}\nconst setFlowTo5minutesAhead = (currentMinutes) => {\n\tflow.set(\"DrivewayLightsOnUntil\", (currentMinutes + 30)); \n}\n\nlet curMin = getCurEpoch();\nsetFlowTo5minutesAhead(curMin);\n\nmsg.payload = \"Driveware lights set to 30 min in the future.\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":420,"y":20,"wires":[["fc173487a302f779"]]},{"id":"7f39c53071c4aa2f","type":"inject","z":"1e9cfcb8.4e3eb3","name":"every minute","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":110,"y":20,"wires":[["cc74cfb0c5f828cb"]]},{"id":"fc173487a302f779","type":"debug","z":"1e9cfcb8.4e3eb3","name":"30 min driveway setter","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":740,"y":20,"wires":[]},{"id":"3633afad.92c49","type":"alexa-home","z":"8fbf17f7.e65578","conf":"69543e7577c6ab2b","device":"115454","acknoledge":true,"name":"Time For Bed","topic":"","x":70,"y":60,"wires":[["c2306c8e.e045d","c4189f72.f3b2","597f9388.8df29c","93c3f128.bd6ff","b1b93b10.d5fd58","f1a1d33d.e6e48"]]},{"id":"c2306c8e.e045d","type":"function","z":"8fbf17f7.e65578","name":"outside 35%","func":"msg.payload = {\n    \"brightness\": 35,\n    \"kelvin\": 2700,\n    \"on\": true\n    }\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":80,"wires":[["9857b2f5.6cfb"]]},{"id":"9857b2f5.6cfb","type":"subflow:6be10a17.1cf904","z":"8fbf17f7.e65578","name":"","x":560,"y":80,"wires":[]},{"id":"c4189f72.f3b2","type":"function","z":"8fbf17f7.e65578","name":"turn off hue","func":"msg.payload = {\"on\":false}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":350,"y":160,"wires":[["5e94f8bf.08b308","b4e88fe3.4e56f","cab29229.072d2"]]},{"id":"5e94f8bf.08b308","type":"node-hue-in","z":"8fbf17f7.e65578","server":"e5843571.d374f8","lightID":"group3","name":"inside hue","x":390,"y":200,"wires":[]},{"id":"597f9388.8df29c","type":"api-call-service","z":"8fbf17f7.e65578","name":"turn p ceiling, kitchen off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.p_ceiling_piano_level","light.p_ceiling_back_level","light.kitchen_light_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":390,"y":320,"wires":[[]]},{"id":"93c3f128.bd6ff","type":"api-call-service","z":"8fbf17f7.e65578","name":"turn hallway to 50%","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.kitchen_hallway_level"],"data":"{\"brightness\":127}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":380,"y":400,"wires":[[]]},{"id":"b1b93b10.d5fd58","type":"api-call-service","z":"8fbf17f7.e65578","name":"upper steps to 50%","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.upper_steps_lights_level"],"data":"{\"brightness\":127}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":380,"y":460,"wires":[[]]},{"id":"f1a1d33d.e6e48","type":"delay","z":"8fbf17f7.e65578","name":"","pauseType":"delay","timeout":"45","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":340,"y":520,"wires":[["e10001af.39763","d74b3b31.82ca78"]]},{"id":"e10001af.39763","type":"api-call-service","z":"8fbf17f7.e65578","name":"upper steps off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_off","areaId":[],"deviceId":[],"entityId":["light.upper_steps_lights_level"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":380,"y":620,"wires":[[]]},{"id":"d74b3b31.82ca78","type":"api-call-service","z":"8fbf17f7.e65578","name":"turn hallway to 25%","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"light","service":"turn_on","areaId":[],"deviceId":[],"entityId":["light.kitchen_hallway_level"],"data":"{\"brightness\":63}","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":400,"y":580,"wires":[[]]},{"id":"b4e88fe3.4e56f","type":"node-hue-in","z":"8fbf17f7.e65578","server":"e5843571.d374f8","lightID":"light8","name":"lr strip","x":370,"y":240,"wires":[]},{"id":"cab29229.072d2","type":"node-hue-in","z":"8fbf17f7.e65578","server":"e5843571.d374f8","lightID":"light9","name":"lr couch","x":380,"y":280,"wires":[]},{"id":"cd591034.6ea5","type":"alexa-home","z":"a919d62a.d9be68","conf":"69543e7577c6ab2b","device":"115602","acknoledge":true,"name":"Porch Power","topic":"","x":70,"y":100,"wires":[["2b2c690b.f9d456"]]},{"id":"c295e72e.83d418","type":"api-current-state","z":"a919d62a.d9be68","name":"if porch power on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.porch_power_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":490,"y":160,"wires":[["9c08609f.99897"],[]]},{"id":"11072697.e90179","type":"api-call-service","z":"a919d62a.d9be68","name":"set porch power on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.porch_power_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":510,"y":85,"wires":[[]]},{"id":"9c08609f.99897","type":"api-call-service","z":"a919d62a.d9be68","name":"set porch power off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.porch_power_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":510,"y":205,"wires":[[]]},{"id":"a7ef2a56.1866c8","type":"api-current-state","z":"a919d62a.d9be68","name":"if porch power off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.porch_power_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":490,"y":40,"wires":[["11072697.e90179"],[]]},{"id":"2b2c690b.f9d456","type":"switch","z":"a919d62a.d9be68","name":"","property":"command","propertyType":"msg","rules":[{"t":"eq","v":"TurnOnRequest","vt":"str"},{"t":"eq","v":"TurnOffRequest","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":100,"wires":[["a7ef2a56.1866c8"],["c295e72e.83d418"]]},{"id":"4183b8d.5ad4a48","type":"inject","z":"8b5b6604.df33d8","d":true,"name":"Every Min","props":[{"p":"payload"}],"repeat":"","crontab":"*/1 0-23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":101,"y":95,"wires":[["1ae10fe4.bb9d3"]]},{"id":"f60c3ef0.66375","type":"function","z":"8b5b6604.df33d8","name":"Turn WK sched on","func":"let now = new Date()  \nlet secondsSinceEpoch = Math.round(now.getTime() / 1000) \nlet minsSinceEpoch = Math.floor(secondsSinceEpoch/60)\n\nflow.set(\"WKend\", (minsSinceEpoch + 15));\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":460,"wires":[["7a8be586.c553ec","67f99a44.b49164"]]},{"id":"775d2aac.46de64","type":"function","z":"8b5b6604.df33d8","name":"Turn WK sched off","func":"flow.set(\"WKend\", 0);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":455,"y":617,"wires":[["c606197c.60b2b8","8ddcf18c.071c6"]]},{"id":"ab6b3bd3.661168","type":"function","z":"8b5b6604.df33d8","name":"is it One Minute WK Warning Time?","func":"let now = new Date()  \nlet secondsSinceEpoch = Math.round(now.getTime() / 1000) \nlet curTime = Math.floor(secondsSinceEpoch/60)\n\n\nlet wkEndTemp = flow.get(\"WKend\");\nlet wkEnd = wkEndTemp ? wkEndTemp : 0;\n\nif ((wkEnd - 1) == curTime)\n    return [msg,null];\nelse\n    return [null,msg];\n    ","outputs":2,"noerr":0,"initialize":"","finalize":"","x":473,"y":163,"wires":[["6c3883f.e201b7c"],["f2972424.a6ef68","97d7da86.c37998"]]},{"id":"6c3883f.e201b7c","type":"api-current-state","z":"8b5b6604.df33d8","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":756,"y":157,"wires":[["c8303aaa.ebebb8"],[]]},{"id":"cef706c6.f0d0e8","type":"delay","z":"8b5b6604.df33d8","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1058,"y":157,"wires":[["539d7f37.ff8e4"]]},{"id":"539d7f37.ff8e4","type":"api-call-service","z":"8b5b6604.df33d8","name":"turn wk on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1206,"y":157,"wires":[[]]},{"id":"c8303aaa.ebebb8","type":"api-call-service","z":"8b5b6604.df33d8","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":910,"y":157,"wires":[["cef706c6.f0d0e8"]]},{"id":"2e65c96c.631c56","type":"function","z":"8b5b6604.df33d8","name":"if WK sched on","func":"let now = new Date()  \nlet secondsSinceEpoch = Math.round(now.getTime() / 1000) \nlet curTime = Math.floor(secondsSinceEpoch/60)\n\nlet wkEndTemp = flow.get(\"WKend\");\nlet wkEnd = wkEndTemp ? wkEndTemp : 0;\n\nif (wkEnd > curTime)\n    return [msg,null];\nelse\n    return [null,msg];\n    ","outputs":2,"noerr":0,"initialize":"","finalize":"","x":220,"y":183,"wires":[["ab6b3bd3.661168"],["7b6ccd3a.f72ee4","1ebe092f.565537"]]},{"id":"7b6ccd3a.f72ee4","type":"api-current-state","z":"8b5b6604.df33d8","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":393,"y":205,"wires":[["f2e8094f.cf66f8"],[]]},{"id":"f2e8094f.cf66f8","type":"api-call-service","z":"8b5b6604.df33d8","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":547,"y":205,"wires":[[]]},{"id":"1ebe092f.565537","type":"api-current-state","z":"8b5b6604.df33d8","name":"if FL off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":393,"y":248,"wires":[["ecf68a01.550208"],[]]},{"id":"ecf68a01.550208","type":"api-call-service","z":"8b5b6604.df33d8","name":"turn FL on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":547,"y":248,"wires":[[]]},{"id":"7a8be586.c553ec","type":"api-current-state","z":"8b5b6604.df33d8","name":"if wk off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":633,"y":460,"wires":[["935f222e.d6df8"],[]]},{"id":"935f222e.d6df8","type":"api-call-service","z":"8b5b6604.df33d8","name":"turn wk on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":787,"y":460,"wires":[[]]},{"id":"c606197c.60b2b8","type":"api-current-state","z":"8b5b6604.df33d8","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":629,"y":617,"wires":[["4d5bf837.847ab8"],[]]},{"id":"4d5bf837.847ab8","type":"api-call-service","z":"8b5b6604.df33d8","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":783,"y":617,"wires":[[]]},{"id":"8ddcf18c.071c6","type":"api-current-state","z":"8b5b6604.df33d8","name":"if FL off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":631,"y":657,"wires":[["c82b0c81.ada5e"],[]]},{"id":"c82b0c81.ada5e","type":"api-call-service","z":"8b5b6604.df33d8","name":"turn FL on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":785,"y":657,"wires":[[]]},{"id":"67f99a44.b49164","type":"api-current-state","z":"8b5b6604.df33d8","name":"if FL on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":636,"y":500,"wires":[["d2b292fa.edf5"],[]]},{"id":"d2b292fa.edf5","type":"api-call-service","z":"8b5b6604.df33d8","name":"turn FL off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":790,"y":500,"wires":[[]]},{"id":"39f1cc7e.cf2414","type":"api-current-state","z":"8b5b6604.df33d8","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":358,"y":337,"wires":[["f1e9d06e.72e1f"],[]]},{"id":"f1e9d06e.72e1f","type":"api-call-service","z":"8b5b6604.df33d8","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":512,"y":337,"wires":[["9b76914e.d1095"]]},{"id":"50af6532.1d8abc","type":"api-current-state","z":"8b5b6604.df33d8","name":"if FL on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":361,"y":377,"wires":[["743a0bab.85a274"],[]]},{"id":"743a0bab.85a274","type":"api-call-service","z":"8b5b6604.df33d8","name":"turn FL off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":515,"y":377,"wires":[["9b76914e.d1095"]]},{"id":"25c1b239.53e3de","type":"server-state-changed","z":"8b5b6604.df33d8","name":"A button","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.a_button","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":65,"y":460,"wires":[["8262ff69.f28f1"],[]]},{"id":"b31edb0e.011a38","type":"server-state-changed","z":"8b5b6604.df33d8","name":"B button","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.b_button","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":65,"y":620,"wires":[["5d0b1de.19a7be4"],[]]},{"id":"ea60474d.271588","type":"alexa-home","z":"8b5b6604.df33d8","conf":"69543e7577c6ab2b","device":"115517","acknoledge":true,"name":"Work Light","topic":"","x":65,"y":540,"wires":[["82911cab.1aa19"]]},{"id":"82911cab.1aa19","type":"switch","z":"8b5b6604.df33d8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":194,"y":540,"wires":[["8262ff69.f28f1"],["5d0b1de.19a7be4"]]},{"id":"f2972424.a6ef68","type":"api-current-state","z":"8b5b6604.df33d8","name":"if wk off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":756,"y":207,"wires":[["266d3c6b.4d9894"],[]]},{"id":"266d3c6b.4d9894","type":"api-call-service","z":"8b5b6604.df33d8","name":"turn wk on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":910,"y":207,"wires":[[]]},{"id":"97d7da86.c37998","type":"api-current-state","z":"8b5b6604.df33d8","name":"if FL on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":759,"y":247,"wires":[["ab976a34.b010d8"],[]]},{"id":"ab976a34.b010d8","type":"api-call-service","z":"8b5b6604.df33d8","name":"turn FL off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":913,"y":247,"wires":[[]]},{"id":"9b76914e.d1095","type":"function","z":"8b5b6604.df33d8","name":"Turn WK sched off","func":"flow.set(\"WKend\", 0);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":695,"y":357,"wires":[[]]},{"id":"2b0176d3.1c882a","type":"config","z":"8b5b6604.df33d8","name":"<CUSTOM> setup entities and on/off times","properties":[{"p":"wklight","pt":"flow","to":"switch.cl_wklight","tot":"str"},{"p":"fllight","pt":"flow","to":"switch.cl_fllight","tot":"str"},{"p":"onHour","pt":"flow","to":"11","tot":"num"},{"p":"offHour","pt":"flow","to":"23","tot":"num"},{"p":"fan","pt":"flow","to":"switch.cl_fan","tot":"str"}],"active":true,"x":202,"y":20,"wires":[]},{"id":"1ae10fe4.bb9d3","type":"function","z":"8b5b6604.df33d8","name":"if light sched on","func":"let onHour  = flow.get(\"onHour\");  // 11;\nlet offHour = flow.get(\"offHour\"); // 23;\n\nlet d = new Date();\nlet curHour = d.getHours();\n\nif (curHour >= onHour && curHour < offHour)\n    return [msg,null];\nelse\n    return [null,msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":140,"y":255,"wires":[["2e65c96c.631c56"],["39f1cc7e.cf2414","50af6532.1d8abc"]]},{"id":"8262ff69.f28f1","type":"function","z":"8b5b6604.df33d8","name":"if light sched on","func":"let onHour  = flow.get(\"onHour\");  // 11;\nlet offHour = flow.get(\"offHour\"); // 23;\n\nlet d = new Date();\nlet curHour = d.getHours();\n\nif (curHour >= onHour && curHour < offHour)\n    return [msg,null];\nelse\n    return [null,msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":250,"y":458,"wires":[["f60c3ef0.66375"],[]]},{"id":"5d0b1de.19a7be4","type":"function","z":"8b5b6604.df33d8","name":"if light sched on","func":"let onHour  = flow.get(\"onHour\");  // 11;\nlet offHour = flow.get(\"offHour\"); // 23;\n\nlet d = new Date();\nlet curHour = d.getHours();\n\nif (curHour >= onHour && curHour < offHour)\n    return [msg,null];\nelse\n    return [null,msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":248,"y":617,"wires":[["775d2aac.46de64"],[]]},{"id":"b3cc7352.8288b","type":"server-state-changed","z":"8b5b6604.df33d8","d":true,"name":"<CUSTOM> temp at or above 78","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.cl_multisensor_temperature","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"78","halt_if_type":"num","halt_if_compare":"gte","output_only_on_state_change":true,"x":135,"y":777,"wires":[["8152b60.0609748"],["6ac3fda2.cb2c84"]]},{"id":"8152b60.0609748","type":"api-current-state","z":"8b5b6604.df33d8","name":"if fan off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fan}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":347,"y":751,"wires":[["2c487459.9c434c"],[]]},{"id":"6ac3fda2.cb2c84","type":"api-current-state","z":"8b5b6604.df33d8","name":"if fan on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fan}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":347,"y":801,"wires":[["6aefcc11.076764"],[]]},{"id":"6aefcc11.076764","type":"api-call-service","z":"8b5b6604.df33d8","name":"set fan state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":507,"y":801,"wires":[[]]},{"id":"2c487459.9c434c","type":"api-call-service","z":"8b5b6604.df33d8","name":"set fan state on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":507,"y":750,"wires":[[]]},{"id":"e093ff76.6e739","type":"inject","z":"976e63d3.368c7","name":"Every Min","props":[{"p":"payload"}],"repeat":"","crontab":"*/1 0-23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":110,"y":93,"wires":[["8bc2a4ae.e63458","825750c6.cccbc","12259694.3a1c49"]]},{"id":"40557125.d7284","type":"function","z":"976e63d3.368c7","name":"Turn WK sched on","func":"let now = new Date()  \nlet secondsSinceEpoch = Math.round(now.getTime() / 1000) \nlet minsSinceEpoch = Math.floor(secondsSinceEpoch/60)\n\nflow.set(\"WKend\", (minsSinceEpoch + 15));\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":487,"y":457,"wires":[["bbf17b1a.a46cb8","4098fa4e.fbf354"]]},{"id":"2c954519.7aa12a","type":"function","z":"976e63d3.368c7","name":"Turn WK sched off","func":"flow.set(\"WKend\", 0);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":489,"y":683,"wires":[["69312179.d1586","cb5d80ed.57bc4"]]},{"id":"348a5ab1.602766","type":"function","z":"976e63d3.368c7","name":"is it One Minute WK Warning Time?","func":"let now = new Date()  \nlet secondsSinceEpoch = Math.round(now.getTime() / 1000) \nlet curTime = Math.floor(secondsSinceEpoch/60)\n\n\nlet wkEndTemp = flow.get(\"WKend\");\nlet wkEnd = wkEndTemp ? wkEndTemp : 0;\n\nif ((wkEnd - 1) == curTime)\n    return [msg,null];\nelse\n    return [null,msg];\n    ","outputs":2,"noerr":0,"initialize":"","finalize":"","x":482,"y":163,"wires":[["da007184.64c3e"],["bef106c6.b48478","12135c75.5b59d4"]]},{"id":"da007184.64c3e","type":"api-current-state","z":"976e63d3.368c7","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":821,"y":155,"wires":[["8f01981e.78aa28"],[]]},{"id":"5191b97e.e638b8","type":"delay","z":"976e63d3.368c7","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1123,"y":155,"wires":[["d193b4b4.32df68"]]},{"id":"d193b4b4.32df68","type":"api-call-service","z":"976e63d3.368c7","name":"turn wk on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1271,"y":155,"wires":[[]]},{"id":"8f01981e.78aa28","type":"api-call-service","z":"976e63d3.368c7","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":975,"y":155,"wires":[["5191b97e.e638b8"]]},{"id":"1eb46c81.2e2a13","type":"function","z":"976e63d3.368c7","name":"if WK sched on","func":"let now = new Date()  \nlet secondsSinceEpoch = Math.round(now.getTime() / 1000) \nlet curTime = Math.floor(secondsSinceEpoch/60)\n\nlet wkEndTemp = flow.get(\"WKend\");\nlet wkEnd = wkEndTemp ? wkEndTemp : 0;\n\nif (wkEnd > curTime)\n    return [msg,null];\nelse\n    return [null,msg];\n    ","outputs":2,"noerr":0,"initialize":"","finalize":"","x":229,"y":183,"wires":[["348a5ab1.602766"],["4fd8dbbd.8af714","d6a2c78a.38dd08"]]},{"id":"4fd8dbbd.8af714","type":"api-current-state","z":"976e63d3.368c7","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":402,"y":205,"wires":[["5c7daa1a.c5ed54"],[]]},{"id":"5c7daa1a.c5ed54","type":"api-call-service","z":"976e63d3.368c7","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":556,"y":205,"wires":[["4041fd44.cec114"]]},{"id":"d6a2c78a.38dd08","type":"api-current-state","z":"976e63d3.368c7","name":"if FL off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":402,"y":248,"wires":[["e06388d5.98dca8"],[]]},{"id":"e06388d5.98dca8","type":"api-call-service","z":"976e63d3.368c7","name":"turn FL on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":556,"y":248,"wires":[[]]},{"id":"bbf17b1a.a46cb8","type":"api-current-state","z":"976e63d3.368c7","name":"if wk off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":660,"y":457,"wires":[["6e5d746c.30f70c"],[]]},{"id":"6e5d746c.30f70c","type":"api-call-service","z":"976e63d3.368c7","name":"turn wk on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":814,"y":457,"wires":[["7acad4a3.ad394c"]]},{"id":"69312179.d1586","type":"api-current-state","z":"976e63d3.368c7","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":663,"y":683,"wires":[["d4fd73a7.4d4cc"],[]]},{"id":"d4fd73a7.4d4cc","type":"api-call-service","z":"976e63d3.368c7","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":817,"y":683,"wires":[["4041fd44.cec114"]]},{"id":"cb5d80ed.57bc4","type":"api-current-state","z":"976e63d3.368c7","name":"if FL off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":665,"y":723,"wires":[["acdb0f67.4b0c8"],[]]},{"id":"acdb0f67.4b0c8","type":"api-call-service","z":"976e63d3.368c7","name":"turn FL on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":819,"y":723,"wires":[[]]},{"id":"4098fa4e.fbf354","type":"api-current-state","z":"976e63d3.368c7","name":"if FL on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":663,"y":497,"wires":[["1042aff8.f2171"],[]]},{"id":"1042aff8.f2171","type":"api-call-service","z":"976e63d3.368c7","name":"turn FL off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":817,"y":497,"wires":[[]]},{"id":"c4973528.d5faa8","type":"api-current-state","z":"976e63d3.368c7","name":"if wk on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":367,"y":337,"wires":[["a00490ea.02bc3"],[]]},{"id":"a00490ea.02bc3","type":"api-call-service","z":"976e63d3.368c7","name":"turn wk off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":521,"y":337,"wires":[["71914308.085bdc"]]},{"id":"ee928514.1392d8","type":"api-current-state","z":"976e63d3.368c7","name":"if FL on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":370,"y":377,"wires":[["91f373bf.388ef"],[]]},{"id":"91f373bf.388ef","type":"api-call-service","z":"976e63d3.368c7","name":"turn FL off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":524,"y":377,"wires":[["71914308.085bdc"]]},{"id":"d22a3b5a.c5ba88","type":"server-state-changed","z":"976e63d3.368c7","name":"A button","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.a_button","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":74,"y":457,"wires":[["fcdfabb4.effc78"],[]]},{"id":"4fa71219.ad4f2c","type":"server-state-changed","z":"976e63d3.368c7","name":"B button","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.b_button","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":74,"y":686,"wires":[["36203e83.43f412"],[]]},{"id":"f8f88862.0dce78","type":"alexa-home","z":"976e63d3.368c7","conf":"69543e7577c6ab2b","device":"115517","acknoledge":true,"name":"Work Light","topic":"","x":74,"y":537,"wires":[["25305a8e.e77446"]]},{"id":"25305a8e.e77446","type":"switch","z":"976e63d3.368c7","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":264,"y":537,"wires":[["fcdfabb4.effc78"],["36203e83.43f412"]]},{"id":"bef106c6.b48478","type":"api-current-state","z":"976e63d3.368c7","name":"if wk off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wklight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":821,"y":205,"wires":[["96d4f81a.94fe38"],[]]},{"id":"96d4f81a.94fe38","type":"api-call-service","z":"976e63d3.368c7","name":"turn wk on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wklight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":975,"y":205,"wires":[["7acad4a3.ad394c"]]},{"id":"12135c75.5b59d4","type":"api-current-state","z":"976e63d3.368c7","name":"if FL on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fllight}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":824,"y":245,"wires":[["e03e90ca.12aef"],[]]},{"id":"e03e90ca.12aef","type":"api-call-service","z":"976e63d3.368c7","name":"turn FL off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fllight}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":978,"y":245,"wires":[[]]},{"id":"71914308.085bdc","type":"function","z":"976e63d3.368c7","name":"Turn WK sched off","func":"flow.set(\"WKend\", 0);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":704,"y":357,"wires":[["4041fd44.cec114"]]},{"id":"8bc2a4ae.e63458","type":"function","z":"976e63d3.368c7","name":"if light sched on","func":"let onHour  = flow.get(\"onHour\");  // 11;\nlet offHour = flow.get(\"offHour\"); // 23;\n\nlet d = new Date();\nlet curHour = d.getHours();\n\nif ((curHour >= onHour && curHour < offHour) || (onHour == offHour))\n    return [msg,null];\nelse\n    return [null,msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":149,"y":255,"wires":[["1eb46c81.2e2a13"],["c4973528.d5faa8","ee928514.1392d8"]]},{"id":"fcdfabb4.effc78","type":"function","z":"976e63d3.368c7","name":"if light sched on","func":"let onHour  = flow.get(\"onHour\");  // 11;\nlet offHour = flow.get(\"offHour\"); // 23;\n\nlet d = new Date();\nlet curHour = d.getHours();\n\nif ((curHour >= onHour && curHour < offHour) || (onHour == offHour))\n    return [msg,null];\nelse\n    return [null,msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":277,"y":455,"wires":[["40557125.d7284"],[]]},{"id":"36203e83.43f412","type":"function","z":"976e63d3.368c7","name":"if light sched on","func":"let onHour  = flow.get(\"onHour\");  // 11;\nlet offHour = flow.get(\"offHour\"); // 23;\n\nlet d = new Date();\nlet curHour = d.getHours();\n\nif ((curHour >= onHour && curHour < offHour) || (onHour == offHour))\n    return [msg,null];\nelse\n    return [null,msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":282,"y":683,"wires":[["2c954519.7aa12a"],[]]},{"id":"82518291.da942","type":"server-state-changed","z":"976e63d3.368c7","name":"<CUSTOM> temp at or above 77","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.cl_multisensor_temperature","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"77","halt_if_type":"num","halt_if_compare":"gte","output_only_on_state_change":true,"x":144,"y":823,"wires":[["8e8e2c76.7106c"],["d0fdffb8.73b02","724d1e4f.c3c58"]]},{"id":"8e8e2c76.7106c","type":"api-current-state","z":"976e63d3.368c7","name":"if fan off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fan}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":380,"y":800,"wires":[["7d4173a0.cea86c"],[]]},{"id":"d0fdffb8.73b02","type":"api-current-state","z":"976e63d3.368c7","name":"if fan on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.fan}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":380,"y":850,"wires":[["7d992e48.580bd"],[]]},{"id":"7d992e48.580bd","type":"api-call-service","z":"976e63d3.368c7","name":"set fan state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":540,"y":850,"wires":[[]]},{"id":"7d4173a0.cea86c","type":"api-call-service","z":"976e63d3.368c7","name":"set fan state on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.fan}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":540,"y":799,"wires":[[]]},{"id":"561fb0ae.39bac","type":"server-state-changed","z":"976e63d3.368c7","name":"<CUSTOM> wk UI","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"input_boolean.cl_wk","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":102,"y":606,"wires":[["fcdfabb4.effc78"],["36203e83.43f412"]]},{"id":"7acad4a3.ad394c","type":"api-current-state","z":"976e63d3.368c7","name":"if wk UI off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wkUI}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1085,"y":376,"wires":[["988cd969.1ac948"],[]]},{"id":"988cd969.1ac948","type":"api-call-service","z":"976e63d3.368c7","name":"turn wk UI on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_on","areaId":[],"deviceId":[],"entityId":["{{flow.wkUI}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1279,"y":376,"wires":[[]]},{"id":"4041fd44.cec114","type":"api-current-state","z":"976e63d3.368c7","name":"if wk UI on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"{{flow.wkUI}}","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":1085,"y":436,"wires":[["2cc24be8.f14514"],[]]},{"id":"2cc24be8.f14514","type":"api-call-service","z":"976e63d3.368c7","name":"turn wk UI off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"input_boolean","service":"turn_off","areaId":[],"deviceId":[],"entityId":["{{flow.wkUI}}"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":1279,"y":436,"wires":[[]]},{"id":"7aa6ab9f.922aa4","type":"config","z":"976e63d3.368c7","name":"<CUSTOM> setup entities and on/off times","properties":[{"p":"wklight","pt":"flow","to":"switch.cl_wklight","tot":"str"},{"p":"fllight","pt":"flow","to":"switch.cl_fllight","tot":"str"},{"p":"onHour","pt":"flow","to":"11","tot":"num"},{"p":"offHour","pt":"flow","to":"23","tot":"num"},{"p":"fan","pt":"flow","to":"switch.cl_fan","tot":"str"},{"p":"wkUI","pt":"flow","to":"input_boolean.cl_wk","tot":"str"},{"p":"humidity_sensor","pt":"flow","to":"sensor.cl_multisensor_relative_humidity","tot":"str"}],"active":true,"x":210,"y":30,"wires":[]},{"id":"825750c6.cccbc","type":"api-current-state","z":"976e63d3.368c7","name":"if 25% or less cl_S","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"25","halt_if_type":"num","halt_if_compare":"lte","entity_id":"sensor.moisture_cl_s","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":519,"y":59,"wires":[["e459b069.aa3f8"],[]]},{"id":"12259694.3a1c49","type":"api-current-state","z":"976e63d3.368c7","name":"if 25% or less cl_I","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"25","halt_if_type":"num","halt_if_compare":"lte","entity_id":"sensor.moisture_cl_i","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":519,"y":105,"wires":[["8af0c1e4.a92ac"],[]]},{"id":"724fadee.d5ba34","type":"function","z":"976e63d3.368c7","name":"Send message for 1_S","func":"msg.payload = `Moisture of 1_S is ${msg.payload}`\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":960,"y":60,"wires":[["d733e173.5e1b3"]]},{"id":"6850d932.4f4cf8","type":"function","z":"976e63d3.368c7","name":"Send message for 2_I","func":"msg.payload = `Moisture of 2_I is ${msg.payload}`\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":960,"y":106,"wires":[["2690c8f7.80fc98"]]},{"id":"e459b069.aa3f8","type":"subflow:f2f2edc5.b030a","z":"976e63d3.368c7","name":"","x":732,"y":60,"wires":[["724fadee.d5ba34"]]},{"id":"8af0c1e4.a92ac","type":"subflow:f2f2edc5.b030a","z":"976e63d3.368c7","name":"","x":735,"y":106,"wires":[["6850d932.4f4cf8"]]},{"id":"d733e173.5e1b3","type":"subflow:71a3fd81.9edc14","z":"976e63d3.368c7","name":"","x":1173,"y":59,"wires":[]},{"id":"2690c8f7.80fc98","type":"subflow:71a3fd81.9edc14","z":"976e63d3.368c7","name":"","x":1176,"y":105,"wires":[]},{"id":"cf67d7bb.eaed08","type":"function","z":"976e63d3.368c7","name":"create temp message","func":"msg.payload = `CL Temp is ${msg.payload}`\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":780,"y":920,"wires":[["5cdbb99c.fdf758"]]},{"id":"5d914ec6.52cbf","type":"subflow:f2f2edc5.b030a","z":"976e63d3.368c7","name":"","x":552,"y":920,"wires":[["cf67d7bb.eaed08"]]},{"id":"5cdbb99c.fdf758","type":"subflow:71a3fd81.9edc14","z":"976e63d3.368c7","name":"","x":993,"y":919,"wires":[]},{"id":"724d1e4f.c3c58","type":"function","z":"976e63d3.368c7","name":"if temp below 60","func":"if (msg.payload < 60)\n    return [msg,null];\nelse\n    return [null,msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":330,"y":920,"wires":[["5d914ec6.52cbf"],[]]},{"id":"21e82744.fe5c28","type":"server-state-changed","z":"9803957e.5640c8","name":"<CUSTOM> temp at or below 71","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":"","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.bathroom_multi_temperature","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"71","halt_if_type":"num","halt_if_compare":"lte","output_only_on_state_change":true,"x":135,"y":89,"wires":[["b06be313.b5892"],["f9b186d0.6a6348"]]},{"id":"b06be313.b5892","type":"api-current-state","z":"9803957e.5640c8","name":"if heater off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.space_heater","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":377,"y":63,"wires":[["8c3ed14f.9dcfc"],[]]},{"id":"f9b186d0.6a6348","type":"api-current-state","z":"9803957e.5640c8","name":"if heater on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.space_heater","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":377,"y":113,"wires":[["d21a4537.adedf8"],[]]},{"id":"d21a4537.adedf8","type":"api-call-service","z":"9803957e.5640c8","name":"set heater state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.space_heater"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":615,"y":109,"wires":[[]]},{"id":"8c3ed14f.9dcfc","type":"api-call-service","z":"9803957e.5640c8","name":"set heater state on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.space_heater"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":615,"y":58,"wires":[[]]},{"id":"9f393415.25a7b8","type":"inject","z":"2b42380c.d8fd88","name":"Every Min","props":[{"p":"payload"}],"repeat":"","crontab":"*/1 0-23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":110,"y":120,"wires":[["81a996c9.a05308"]]},{"id":"aab3a61f.999cb8","type":"config","z":"2b42380c.d8fd88","name":"T setup entities and on/off times","properties":[{"p":"wklight","pt":"flow","to":"switch.aeon_labs_dsc11_smart_strip_switch_4","tot":"str"},{"p":"fllight","pt":"flow","to":"switch.aeon_labs_dsc11_smart_strip_switch_3","tot":"str"},{"p":"onHour","pt":"flow","to":"13","tot":"num"},{"p":"offHour","pt":"flow","to":"23","tot":"num"},{"p":"fan","pt":"flow","to":"switch.aeon_labs_dsc11_smart_strip_switch","tot":"str"},{"p":"wkUI","pt":"flow","to":"input_boolean.t_wk","tot":"str"},{"p":"temperature","pt":"flow","to":"sensor.blue_multisensor_t_temperature_2","tot":"str"},{"p":"moistureSubstr","pt":"flow","to":"sensor.moisture_t_","tot":"str"},{"p":"humidity_sensor","pt":"flow","to":"sensor.blue_multisensor_t_relative_humidity_2","tot":"str"}],"active":true,"x":170,"y":40,"wires":[]},{"id":"7b81a5d6.b9c47c","type":"server-state-changed","z":"2b42380c.d8fd88","name":"A button","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.a_button","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":80,"y":200,"wires":[["eeb68886.902e78"],[]]},{"id":"6e51c77f.590698","type":"server-state-changed","z":"2b42380c.d8fd88","name":"B button","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.b_button","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":81,"y":305,"wires":[["d8787e58.ebda5"],[]]},{"id":"b7250946.339d28","type":"alexa-home","z":"2b42380c.d8fd88","conf":"69543e7577c6ab2b","device":"118705","acknoledge":true,"name":"Tent Work Light","topic":"","x":100,"y":253,"wires":[["1aaca588.9561aa"]]},{"id":"1aaca588.9561aa","type":"switch","z":"2b42380c.d8fd88","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":247,"y":253,"wires":[["eeb68886.902e78"],["d8787e58.ebda5"]]},{"id":"eeb68886.902e78","type":"subflow:90dcf55e.a8a7c8","z":"2b42380c.d8fd88","name":"","x":641,"y":242,"wires":[]},{"id":"d8787e58.ebda5","type":"subflow:23f32820.744c18","z":"2b42380c.d8fd88","name":"","x":641,"y":286,"wires":[]},{"id":"81a996c9.a05308","type":"subflow:2971f5bb.c171da","z":"2b42380c.d8fd88","name":"","x":290,"y":120,"wires":[]},{"id":"9f7453ac.b88b2","type":"inject","z":"f683349.a4593c8","d":true,"name":"Every Min","props":[{"p":"payload"}],"repeat":"","crontab":"*/1 0-23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":110,"y":700,"wires":[["f8004f7c.d9bfe"]]},{"id":"d91cdfcb.909d4","type":"config","z":"f683349.a4593c8","d":true,"name":"T setup entities and on/off times","properties":[{"p":"fllight","pt":"flow","to":"switch.aeon_labs_dsc11_smart_strip_switch_2","tot":"str"},{"p":"onHour","pt":"flow","to":"11","tot":"num"},{"p":"offHour","pt":"flow","to":"11","tot":"num"},{"p":"fan","pt":"flow","to":"switch.cab_fan_switch","tot":"str"},{"p":"temperature","pt":"flow","to":"sensor.cab_multisensor_temperature","tot":"str"},{"p":"humidity_sensor","pt":"flow","to":"sensor.cab_multisensor_relative_humidity","tot":"str"}],"active":true,"x":170,"y":620,"wires":[]},{"id":"f8004f7c.d9bfe","type":"subflow:2971f5bb.c171da","z":"f683349.a4593c8","d":true,"name":"","env":[],"x":290,"y":700,"wires":[]},{"id":"4869da36.012594","type":"inject","z":"f683349.a4593c8","d":true,"name":"2:00 AM","props":[{"p":"payload"}],"repeat":"","crontab":"00 02 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":100,"y":60,"wires":[["5801e1d1.5e0fb"]]},{"id":"a7312dea.6bd53","type":"inject","z":"f683349.a4593c8","d":true,"name":"10:00 PM","props":[{"p":"payload"}],"repeat":"","crontab":"00 22 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":110,"y":120,"wires":[["8811546e.2ec4b8"]]},{"id":"5801e1d1.5e0fb","type":"api-current-state","z":"f683349.a4593c8","d":true,"name":"if CL Bubbler is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch_4","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":290,"y":60,"wires":[["a57d8d19.15f1c"],[]]},{"id":"a57d8d19.15f1c","type":"api-call-service","z":"f683349.a4593c8","d":true,"name":"set CL Bubbler state on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch_4"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":530,"y":60,"wires":[[]]},{"id":"8811546e.2ec4b8","type":"api-current-state","z":"f683349.a4593c8","d":true,"name":"if CL Bubbler is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch_4","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":290,"y":120,"wires":[["7ecf3442.2104ec"],[]]},{"id":"7ecf3442.2104ec","type":"api-call-service","z":"f683349.a4593c8","d":true,"name":"set CL Bubbler state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch_4"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":530,"y":120,"wires":[[]]},{"id":"3bea2e52.c82da2","type":"config","z":"9dc989c8.dff548","name":"<CUSTOM> setup entities and on/off times","properties":[{"p":"wklight","pt":"flow","to":"switch.cl_wklight","tot":"str"},{"p":"fllight","pt":"flow","to":"switch.cl_fllight","tot":"str"},{"p":"onHour","pt":"flow","to":"13","tot":"num"},{"p":"offHour","pt":"flow","to":"23","tot":"num"},{"p":"fan","pt":"flow","to":"switch.cl_fan","tot":"str"},{"p":"wkUI","pt":"flow","to":"input_boolean.cl_wk","tot":"str"},{"p":"humidity_sensor","pt":"flow","to":"sensor.cl_multisensor_relative_humidity","tot":"str"},{"p":"temperature","pt":"flow","to":"sensor.cl_multisensor_temperature","tot":"str"}],"active":true,"x":210,"y":40,"wires":[]},{"id":"9cb611d5.2a444","type":"inject","z":"9dc989c8.dff548","name":"Every Min","props":[{"p":"payload"}],"repeat":"","crontab":"*/1 0-23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":110,"y":120,"wires":[["9f900f2d.a95ec"]]},{"id":"27185b01.6155b4","type":"server-state-changed","z":"9dc989c8.dff548","name":"A button","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.a_button","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":80,"y":200,"wires":[["c87217e.0adc3e8"],[]]},{"id":"cd9854ec.9eef68","type":"server-state-changed","z":"9dc989c8.dff548","name":"B button","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.b_button","entityidfiltertype":"exact","outputinitially":false,"state_type":"str","haltifstate":"on","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":81,"y":305,"wires":[["5b35da8.0bc7124"],[]]},{"id":"68b06304.f782cc","type":"alexa-home","z":"9dc989c8.dff548","conf":"69543e7577c6ab2b","device":"115517","acknoledge":true,"name":"Work Light","topic":"","x":80,"y":253,"wires":[["dabcaaff.4ee288"]]},{"id":"dabcaaff.4ee288","type":"switch","z":"9dc989c8.dff548","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":247,"y":253,"wires":[["c87217e.0adc3e8"],["5b35da8.0bc7124"]]},{"id":"c87217e.0adc3e8","type":"subflow:90dcf55e.a8a7c8","z":"9dc989c8.dff548","name":"","x":641,"y":242,"wires":[]},{"id":"5b35da8.0bc7124","type":"subflow:23f32820.744c18","z":"9dc989c8.dff548","name":"","x":641,"y":286,"wires":[]},{"id":"9f900f2d.a95ec","type":"subflow:2971f5bb.c171da","z":"9dc989c8.dff548","name":"","x":290,"y":120,"wires":[]},{"id":"40cb6575.f9d89c","type":"inject","z":"b3d83d0c.2d5d5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"4","topic":"","payload":"1","payloadType":"num","x":90,"y":40,"wires":[["90fb46e7.6d7f28"]]},{"id":"90fb46e7.6d7f28","type":"subflow:434b5120.15655","z":"b3d83d0c.2d5d5","name":"","env":[],"x":260,"y":40,"wires":[["5268c8ad.37b3f8"]]},{"id":"1853b198.6f1b9e","type":"inject","z":"b3d83d0c.2d5d5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"4","topic":"","payload":"2","payloadType":"num","x":90,"y":80,"wires":[["d0d7cc63.eb35d"]]},{"id":"d0d7cc63.eb35d","type":"subflow:434b5120.15655","z":"b3d83d0c.2d5d5","name":"","env":[],"x":260,"y":80,"wires":[["efed67d1.fdfd08"]]},{"id":"3215f1f5.f1baee","type":"inject","z":"b3d83d0c.2d5d5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"4","topic":"","payload":"3","payloadType":"num","x":90,"y":120,"wires":[["b65ca2a9.878"]]},{"id":"b65ca2a9.878","type":"subflow:434b5120.15655","z":"b3d83d0c.2d5d5","name":"","env":[],"x":260,"y":120,"wires":[["f1da3502.850878"]]},{"id":"b6fb9665.ae12c8","type":"inject","z":"b3d83d0c.2d5d5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"4","topic":"","payload":"4","payloadType":"num","x":90,"y":160,"wires":[["c1704383.ed7e2"]]},{"id":"c1704383.ed7e2","type":"subflow:434b5120.15655","z":"b3d83d0c.2d5d5","name":"","env":[],"x":260,"y":160,"wires":[["f882224.6f777e"]]},{"id":"2ac552bb.72b3fe","type":"inject","z":"b3d83d0c.2d5d5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"4","topic":"","payload":"5","payloadType":"num","x":90,"y":200,"wires":[["5e85bf6b.03314"]]},{"id":"5e85bf6b.03314","type":"subflow:434b5120.15655","z":"b3d83d0c.2d5d5","name":"","env":[],"x":260,"y":200,"wires":[["e734e032.e5db9"]]},{"id":"2e1feee.3f70112","type":"inject","z":"b3d83d0c.2d5d5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"4","topic":"","payload":"6","payloadType":"num","x":90,"y":240,"wires":[["997ccf8a.97c3a"]]},{"id":"997ccf8a.97c3a","type":"subflow:434b5120.15655","z":"b3d83d0c.2d5d5","name":"","env":[],"x":260,"y":240,"wires":[["e3284017.46c48"]]},{"id":"5268c8ad.37b3f8","type":"debug","z":"b3d83d0c.2d5d5","name":"mL 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":449,"y":40,"wires":[]},{"id":"efed67d1.fdfd08","type":"debug","z":"b3d83d0c.2d5d5","name":"mL 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":449,"y":80,"wires":[]},{"id":"f1da3502.850878","type":"debug","z":"b3d83d0c.2d5d5","name":"mL 3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":449,"y":120,"wires":[]},{"id":"f882224.6f777e","type":"debug","z":"b3d83d0c.2d5d5","name":"mL 4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":449,"y":160,"wires":[]},{"id":"e734e032.e5db9","type":"debug","z":"b3d83d0c.2d5d5","name":"mL 5","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":449,"y":200,"wires":[]},{"id":"e3284017.46c48","type":"debug","z":"b3d83d0c.2d5d5","name":"mL 6","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":449,"y":240,"wires":[]},{"id":"7e10dbb.8b2c724","type":"inject","z":"b3d83d0c.2d5d5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"4","topic":"","payload":"1","payloadType":"num","x":90,"y":340,"wires":[["29b8c4b0.75fcec"]]},{"id":"42706774.311988","type":"inject","z":"b3d83d0c.2d5d5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"4","topic":"","payload":"2","payloadType":"num","x":90,"y":380,"wires":[["713e6911.3d4a38"]]},{"id":"164fa592.7febda","type":"inject","z":"b3d83d0c.2d5d5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"4","topic":"","payload":"3","payloadType":"num","x":90,"y":420,"wires":[["78ff6a41.7ad7d4"]]},{"id":"9fd6f724.ca53c8","type":"inject","z":"b3d83d0c.2d5d5","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":"4","topic":"","payload":"4","payloadType":"num","x":90,"y":460,"wires":[["5f9d6ead.59349"]]},{"id":"6f0a01ee.889c6","type":"debug","z":"b3d83d0c.2d5d5","name":"mL 1","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":449,"y":340,"wires":[]},{"id":"d7fc8b7d.cbb1a8","type":"debug","z":"b3d83d0c.2d5d5","name":"mL 2","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":449,"y":380,"wires":[]},{"id":"aea6b42c.f21f28","type":"debug","z":"b3d83d0c.2d5d5","name":"mL 3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":449,"y":420,"wires":[]},{"id":"d0d19553.465b68","type":"debug","z":"b3d83d0c.2d5d5","name":"mL 4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":449,"y":460,"wires":[]},{"id":"29b8c4b0.75fcec","type":"subflow:4ebd89af.8412c8","z":"b3d83d0c.2d5d5","name":"","x":261,"y":340,"wires":[["6f0a01ee.889c6"]]},{"id":"713e6911.3d4a38","type":"subflow:4ebd89af.8412c8","z":"b3d83d0c.2d5d5","name":"","x":261,"y":380,"wires":[["d7fc8b7d.cbb1a8"]]},{"id":"78ff6a41.7ad7d4","type":"subflow:4ebd89af.8412c8","z":"b3d83d0c.2d5d5","name":"","x":261,"y":420,"wires":[["aea6b42c.f21f28"]]},{"id":"5f9d6ead.59349","type":"subflow:4ebd89af.8412c8","z":"b3d83d0c.2d5d5","name":"","x":261,"y":460,"wires":[["d0d19553.465b68"]]},{"id":"83723974.afcea8","type":"subflow:923298e.d488e68","z":"da19a66b.e91c28","name":"","x":585,"y":136,"wires":[]},{"id":"676007f7.1ee788","type":"config","z":"da19a66b.e91c28","name":"<CUSTOM> setup entities","properties":[{"p":"humidifier","pt":"flow","to":"switch.basement_humidifier","tot":"str"},{"p":"fan","pt":"flow","to":"switch.basement_fan","tot":"str"},{"p":"humidity_sensor","pt":"flow","to":"sensor.basement_veggies_multi_relative_humidity_2","tot":"str"}],"active":true,"x":160,"y":60,"wires":[]},{"id":"d3210b5b.061348","type":"server-events","z":"da19a66b.e91c28","name":"","server":"1b7e4fe1.0da8e","version":2,"eventType":"state_changed","waitForRunning":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"},{"property":"event_type","propertyType":"msg","value":"$outputData(\"eventData\").event_type","valueType":"jsonata"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"x":115,"y":136,"wires":[["3152465a.f4390a"]]},{"id":"3152465a.f4390a","type":"function","z":"da19a66b.e91c28","name":"humidity state change","func":"if (msg.payload.hasOwnProperty(\"entity_id\")) {\n    \n    let humidity_sensor = flow.get(\"humidity_sensor\");\n\n    \n    \n    if (humidity_sensor) {\n        if (msg.payload.entity_id == humidity_sensor) {\n            msg.payload = parseFloat(msg.payload.event.new_state.state);\n            return msg;\n        }\n    }\n\n\n    \n}\n","outputs":1,"noerr":0,"initialize":"// Code added here will be run once\n// whenever the node is deployed.\n\n\n//const flowParent = (n) => flow.set(`${n}`, flow.get(`$parent.${n}`));","finalize":"","x":356,"y":136,"wires":[["83723974.afcea8"]]},{"id":"dc829647.6d10c8","type":"config","z":"d3389b9b.5c1778","name":"<CUSTOM> setup entities","properties":[{"p":"fan","pt":"flow","to":"switch.basement_veggies_switch","tot":"str"},{"p":"humidity_sensor","pt":"flow","to":"sensor.humidity5_1","tot":"str"},{"p":"runminutes","pt":"flow","to":"5","tot":"num"}],"active":true,"x":180,"y":40,"wires":[]},{"id":"cf37fe2d.c0a33","type":"inject","z":"d3389b9b.5c1778","name":"Every Min","props":[{"p":"payload"}],"repeat":"","crontab":"0 0-23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"yo","payloadType":"str","x":127,"y":100,"wires":[["715f1915.979588"]]},{"id":"715f1915.979588","type":"subflow:8d8ea42f.7508f8","z":"d3389b9b.5c1778","name":"","x":430,"y":100,"wires":[]},{"id":"66d622ff.ab624c","type":"config","z":"14c0a537.74f21b","name":"<CUSTOM> setup entities","properties":[{"p":"fan","pt":"flow","to":"switch.pump_4","tot":"str"},{"p":"humidity_sensor","pt":"flow","to":"sensor.humidity4_1","tot":"str"},{"p":"runminutes","pt":"flow","to":"1","tot":"num"}],"active":true,"x":180,"y":60,"wires":[]},{"id":"8fa3d9ca.450fc8","type":"inject","z":"14c0a537.74f21b","name":"Every Min","props":[{"p":"payload"}],"repeat":"","crontab":"0 0-23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"yo","payloadType":"str","x":127,"y":120,"wires":[["8db528fe.07b1a8"]]},{"id":"8db528fe.07b1a8","type":"subflow:8d8ea42f.7508f8","z":"14c0a537.74f21b","name":"","x":380,"y":120,"wires":[]},{"id":"4118888f.8e3ac8","type":"config","z":"5f54b4ae.ff559c","name":"<CUSTOM> setup entities","properties":[{"p":"heater","pt":"flow","to":"switch.pump_6","tot":"str"},{"p":"temperature_sensor","pt":"flow","to":"sensor.temperature6_1","tot":"str"},{"p":"temperature","pt":"flow","to":"69","tot":"num"}],"active":true,"x":160,"y":40,"wires":[]},{"id":"6f2787f6.959ca8","type":"inject","z":"5f54b4ae.ff559c","name":"Every Min","props":[{"p":"payload"}],"repeat":"","crontab":"*/1 0-23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"yo","payloadType":"str","x":107,"y":100,"wires":[["25f97c18.66cf54"]]},{"id":"25f97c18.66cf54","type":"subflow:6c886e85.15e09","z":"5f54b4ae.ff559c","name":"","x":300,"y":100,"wires":[]},{"id":"d5b7f508.9334a8","type":"api-current-state","z":"ee47c129.d0da4","name":"","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity_07","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":300,"y":680,"wires":[["ecf5075e.0b30b8"]]},{"id":"89261bac.64c558","type":"inject","z":"ee47c129.d0da4","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":620,"wires":[["d5b7f508.9334a8"]]},{"id":"8d0948d1.848818","type":"debug","z":"ee47c129.d0da4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":770,"y":660,"wires":[]},{"id":"ecf5075e.0b30b8","type":"function","z":"ee47c129.d0da4","name":"only fire if null payload","func":"if (!msg.payload) {\n    msg.payload = \"mobile TESTER humitidy DOWN\"\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":560,"y":680,"wires":[["8d0948d1.848818","d6ab228d.72d6c"]]},{"id":"d6ab228d.72d6c","type":"subflow:71a3fd81.9edc14","z":"ee47c129.d0da4","name":"","x":790,"y":700,"wires":[]},{"id":"8051656c.b0a038","type":"server-state-changed","z":"ee47c129.d0da4","d":true,"name":"","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.humidity4_1","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":180,"y":80,"wires":[["694c93cf.db64cc"]]},{"id":"6a36aecc.92b2a","type":"server-state-changed","z":"ee47c129.d0da4","d":true,"name":"","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.humidity6_1","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":180,"y":140,"wires":[["76db677a.f78f38"]]},{"id":"817ce2ba.6a78f","type":"server-state-changed","z":"ee47c129.d0da4","d":true,"name":"","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.humidity_08_2","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"str","halt_if_compare":"is","output_only_on_state_change":true,"x":190,"y":200,"wires":[["6261df26.173d6"]]},{"id":"694c93cf.db64cc","type":"function","z":"ee47c129.d0da4","name":"only fire if null payload - mobile 4","func":"if (!msg.payload) {\n    msg.payload = \"mobile 4 humitidy DOWN\"\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":180,"wires":[["4a6bb6fa.54e748"]]},{"id":"76db677a.f78f38","type":"function","z":"ee47c129.d0da4","name":"only fire if null payload - mobile 6","func":"if (!msg.payload) {\n    msg.payload = \"mobile 6 humitidy DOWN\"\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":240,"wires":[["4a6bb6fa.54e748"]]},{"id":"6261df26.173d6","type":"function","z":"ee47c129.d0da4","name":"only fire if null payload - mobile 8","func":"if (!msg.payload) {\n    msg.payload = \"mobile 8 humitidy DOWN\"\n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":300,"wires":[["4a6bb6fa.54e748"]]},{"id":"4a6bb6fa.54e748","type":"subflow:71a3fd81.9edc14","z":"ee47c129.d0da4","name":"","x":970,"y":240,"wires":[]},{"id":"3e5d3813.e3f418","type":"api-current-state","z":"ee47c129.d0da4","name":"","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity4_1","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":260,"y":320,"wires":[["694c93cf.db64cc","7b713176.b99c8"]]},{"id":"d173a1c5.69221","type":"api-current-state","z":"ee47c129.d0da4","name":"","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity6_1","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":260,"y":371,"wires":[["76db677a.f78f38","7b713176.b99c8"]]},{"id":"57716571.67a49c","type":"api-current-state","z":"ee47c129.d0da4","name":"","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity_08_2","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":270,"y":420,"wires":[["6261df26.173d6","7b713176.b99c8"]]},{"id":"ce49c290.c840a","type":"inject","z":"ee47c129.d0da4","name":"every minute","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"60","crontab":"","once":true,"onceDelay":"60","topic":"","payload":"","payloadType":"date","x":140,"y":260,"wires":[["3e5d3813.e3f418","d173a1c5.69221","57716571.67a49c"]]},{"id":"7b713176.b99c8","type":"debug","z":"ee47c129.d0da4","name":"hum sensor","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":580,"y":520,"wires":[]},{"id":"370a46c8.746cba","type":"server-state-changed","z":"1299179d.0f43a8","d":true,"name":"moisture_t_1 - 40","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.moisture_t_1","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"40.0","halt_if_type":"num","halt_if_compare":"lte","output_only_on_state_change":true,"x":100,"y":1580,"wires":[["8a30395f.bcc548"],[]]},{"id":"8a30395f.bcc548","type":"subflow:f2f2edc5.b030a","z":"1299179d.0f43a8","name":"","x":320,"y":1580,"wires":[["f7d0ae95.dd4eb"]]},{"id":"f7d0ae95.dd4eb","type":"function","z":"1299179d.0f43a8","name":"BT 1 Needs Water","func":"msg.payload = `BT 1 Moisture: ${msg.payload}`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":1580,"wires":[["4849886c.09f948"]]},{"id":"4849886c.09f948","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":730,"y":1580,"wires":[]},{"id":"b36e2de0.d9424","type":"server-state-changed","z":"1299179d.0f43a8","d":true,"name":"moisture_t_3 - 40","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.moisture_t_3","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"40.0","halt_if_type":"num","halt_if_compare":"lte","output_only_on_state_change":true,"x":100,"y":1700,"wires":[["cd8733a5.56cc"],[]]},{"id":"cd8733a5.56cc","type":"subflow:f2f2edc5.b030a","z":"1299179d.0f43a8","name":"","x":320,"y":1700,"wires":[["5e49f641.e36488"]]},{"id":"5e49f641.e36488","type":"function","z":"1299179d.0f43a8","name":"BT 3 Needs Water","func":"msg.payload = `BT 3 Moisture: ${msg.payload}`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":1700,"wires":[["545092e.11c566c"]]},{"id":"545092e.11c566c","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":730,"y":1700,"wires":[]},{"id":"4a0de6fa.390b58","type":"server-state-changed","z":"1299179d.0f43a8","d":true,"name":"moisture_t_2 - 40","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.moisture_t_2","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"40.0","halt_if_type":"num","halt_if_compare":"lte","output_only_on_state_change":true,"x":100,"y":1640,"wires":[["4c94be53.3f7c2"],[]]},{"id":"4c94be53.3f7c2","type":"subflow:f2f2edc5.b030a","z":"1299179d.0f43a8","name":"","x":320,"y":1640,"wires":[["e337f5cb.7a2478"]]},{"id":"e337f5cb.7a2478","type":"function","z":"1299179d.0f43a8","name":"BT 2 Needs Water","func":"msg.payload = `BT 2 Moisture: ${msg.payload}`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":1640,"wires":[["ff4298a1.c3c708"]]},{"id":"ff4298a1.c3c708","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":730,"y":1640,"wires":[]},{"id":"04ed38bed1717961","type":"server-state-changed","z":"1299179d.0f43a8","d":true,"name":"avg_moisture_09 below 40","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.avg_moisture_09","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"40.0","halt_if_type":"num","halt_if_compare":"lte","output_only_on_state_change":true,"x":130,"y":1740,"wires":[["d3de21a94426330e"],[]]},{"id":"d3de21a94426330e","type":"subflow:f2f2edc5.b030a","z":"1299179d.0f43a8","name":"","x":320,"y":1800,"wires":[["3bce6fad9025694d"]]},{"id":"3bce6fad9025694d","type":"function","z":"1299179d.0f43a8","name":"CL May Need Water","func":"msg.payload = `CL Moisture: ${msg.payload}%`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":540,"y":1800,"wires":[["460ff2868e3a2d0a"]]},{"id":"460ff2868e3a2d0a","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":750,"y":1800,"wires":[]},{"id":"4756e6e2bf9278d7","type":"server-state-changed","z":"1299179d.0f43a8","d":true,"name":"T - humidifier water sensor","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":"10","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"binary_sensor.water_sensor01_04","entityidfiltertype":"exact","outputinitially":false,"state_type":"habool","haltifstate":"false","halt_if_type":"bool","halt_if_compare":"is","output_only_on_state_change":true,"x":130,"y":20,"wires":[["8c8e1b0cf6236a12"],[]]},{"id":"8c8e1b0cf6236a12","type":"subflow:f2f2edc5.b030a","z":"1299179d.0f43a8","name":"","x":380,"y":20,"wires":[["4c79bc417c69df58"]]},{"id":"4c79bc417c69df58","type":"function","z":"1299179d.0f43a8","name":"T Humidifier Needs Water","func":"msg.payload = `T Humidifier Needs Water`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":470,"y":60,"wires":[["24196fc8acb5378b"]]},{"id":"24196fc8acb5378b","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":710,"y":60,"wires":[]},{"id":"edb311c9fd6f0976","type":"server-state-changed","z":"1299179d.0f43a8","d":true,"name":"CL 01 Ebox Res Dry > 24hrs","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"flow","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.hours_since_water_01_09","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"24.0","halt_if_type":"num","halt_if_compare":"gt","output_only_on_state_change":true,"x":140,"y":180,"wires":[["7535a80f6b6cc023"],[]]},{"id":"b1667c14ac1e90f1","type":"function","z":"1299179d.0f43a8","name":"BDK Ebox1 Dry","func":"msg.payload = `BDK Ebox1 Dry: ${flow.get(\"payload\")}`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":700,"y":200,"wires":[["3c408c9fc9dfc6fd"]]},{"id":"3c408c9fc9dfc6fd","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":910,"y":200,"wires":[]},{"id":"65e25110d72b45ed","type":"server-state-changed","z":"1299179d.0f43a8","d":true,"name":"CL 02 Ebox Res Dry > 24hrs","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"flow","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.hours_since_water_02_09","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"24.0","halt_if_type":"num","halt_if_compare":"gt","output_only_on_state_change":true,"x":140,"y":300,"wires":[["648697ce8dc1bb35"],[]]},{"id":"733a0783eeddd1aa","type":"function","z":"1299179d.0f43a8","name":"FP Ebox2 Dry","func":"msg.payload = `FP Ebox2 Dry: ${flow.get(\"payload\")}`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":740,"y":320,"wires":[["59f166f2088b79c4"]]},{"id":"59f166f2088b79c4","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":950,"y":320,"wires":[]},{"id":"be60bbe820f1794f","type":"api-current-state","z":"1299179d.0f43a8","d":true,"name":"T_04 Temp","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"num","halt_if_compare":"is","entity_id":"sensor.temperature04","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":290,"y":1400,"wires":[["f1201059d5c20b2a"]]},{"id":"f1201059d5c20b2a","type":"function","z":"1299179d.0f43a8","name":"set temp values","func":"var T04_previous_temp = flow.get(\"T04_current_temp\");\nflow.set(\"T04_previous_temp\",T04_previous_temp);\n\nflow.set(\"T04_current_temp\",msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":480,"y":1400,"wires":[["5ec2418f058c36a7"]]},{"id":"5ec2418f058c36a7","type":"api-current-state","z":"1299179d.0f43a8","d":true,"name":"T_04 Hum","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"num","halt_if_compare":"is","entity_id":"sensor.humidity04","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":310,"y":1460,"wires":[["d2004cb38d9bdf72"]]},{"id":"d2004cb38d9bdf72","type":"function","z":"1299179d.0f43a8","name":"if temp & hum unchanged","func":"var T04_previous_hum = flow.get(\"T04_current_hum\");\nflow.set(\"T04_previous_hum\",T04_previous_hum);\n\nvar T04_current_hum = msg.payload;\nflow.set(\"T04_current_hum\",T04_current_hum);\n\nvar T04_previous_temp = flow.get(\"T04_previous_temp\");\nvar T04_current_temp = flow.get(\"T04_current_temp\");\n\nif (T04_previous_hum==T04_current_hum && T04_previous_temp==T04_current_temp)\n{\n    return msg;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":1460,"wires":[["bc995512ad2d15a2"]]},{"id":"bc995512ad2d15a2","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":330,"y":1500,"wires":[["16cac5de9d678ac6"]]},{"id":"16cac5de9d678ac6","type":"function","z":"1299179d.0f43a8","name":"T04 frozen sensor","func":"msg.payload = `T04 frozen sensor`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":1500,"wires":[["ca93574aaadaa164"]]},{"id":"ca93574aaadaa164","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":730,"y":1500,"wires":[]},{"id":"d46e506bf020a602","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":437,"y":280,"wires":[["bf47b35a1e47bbae"]]},{"id":"bf47b35a1e47bbae","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":637,"y":280,"wires":[["a336fd65ab4ef4f9"]]},{"id":"a336fd65ab4ef4f9","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":837,"y":280,"wires":[["733a0783eeddd1aa"]]},{"id":"583553aef2a7b8ac","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":420,"y":160,"wires":[["b9fc9c64405a1927"]]},{"id":"b9fc9c64405a1927","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":620,"y":160,"wires":[["5f168fa7f41c731f"]]},{"id":"5f168fa7f41c731f","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":820,"y":160,"wires":[["b1667c14ac1e90f1"]]},{"id":"1e55f0bc22699ea8","type":"api-current-state","z":"1299179d.0f43a8","name":"CL_19 Temp","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.temperature_19","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":330,"y":620,"wires":[["2e9cde5792c297a3"]]},{"id":"2e9cde5792c297a3","type":"function","z":"1299179d.0f43a8","name":"set temp values","func":"var CL19_previous2_temp = flow.get(\"CL19_previous_temp\");\nvar CL19_previous_temp = flow.get(\"CL19_current_temp\");\nvar CL19_current_temp = msg.payload;\n\nflow.set(\"CL19_previous2_temp\",CL19_previous2_temp);\nflow.set(\"CL19_previous_temp\",CL19_previous_temp);\nflow.set(\"CL19_current_temp\",CL19_current_temp);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":620,"wires":[["c3b3910efd6be6f2"]]},{"id":"c3b3910efd6be6f2","type":"api-current-state","z":"1299179d.0f43a8","name":"CL_19 Hum","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity_19","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":350,"y":680,"wires":[["4fd02ae2c5689498"]]},{"id":"4fd02ae2c5689498","type":"function","z":"1299179d.0f43a8","name":"set hum values","func":"var CL19_previous2_hum = flow.get(\"CL19_previous_hum\");\nvar CL19_previous_hum = flow.get(\"CL19_current_hum\");\nvar CL19_current_hum = msg.payload;\n\nflow.set(\"CL19_previous2_hum\",CL19_previous2_hum);\nflow.set(\"CL19_previous_hum\",CL19_previous_hum);\nflow.set(\"CL19_current_hum\",CL19_current_hum);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":540,"y":680,"wires":[["f6439f581b9036d7"]]},{"id":"fef58110f51e6c96","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":390,"y":740,"wires":[["3f8b17c7e299b179"]]},{"id":"3f8b17c7e299b179","type":"function","z":"1299179d.0f43a8","name":"Attic 19 frozen sensor","func":"msg.payload = `Attic 19 frozen sensor`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":600,"y":740,"wires":[["ef7302ea6c7c5f86"]]},{"id":"ef7302ea6c7c5f86","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":830,"y":740,"wires":[]},{"id":"f6439f581b9036d7","type":"function","z":"1299179d.0f43a8","name":"test values","func":"var CL19_previous2_hum = flow.get(\"CL19_previous2_hum\");\nvar CL19_previous_hum = flow.get(\"CL19_previous_hum\");\nvar CL19_current_hum = flow.get(\"CL19_current_hum\");\n\nvar CL19_previous2_temp = flow.get(\"CL19_previous2_temp\");\nvar CL19_previous_temp = flow.get(\"CL19_previous_temp\");\nvar CL19_current_temp = flow.get(\"CL19_current_temp\");\n\nif ( (CL19_previous2_hum==CL19_previous_hum && CL19_previous_hum==CL19_current_hum) && (CL19_previous2_temp==CL19_previous_temp && CL19_previous_temp==CL19_current_temp) )\n{\n\treturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":750,"y":680,"wires":[["fef58110f51e6c96"]]},{"id":"479935921bdf119c","type":"api-current-state","z":"1299179d.0f43a8","name":"CL_21 Temp","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.temperature_21","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":330,"y":800,"wires":[["b419e90f4c2c8546"]]},{"id":"b419e90f4c2c8546","type":"function","z":"1299179d.0f43a8","name":"set temp values","func":"var CL21_previous2_temp = flow.get(\"CL21_previous_temp\");\nvar CL21_previous_temp = flow.get(\"CL21_current_temp\");\nvar CL21_current_temp = msg.payload;\n\nflow.set(\"CL21_previous2_temp\",CL21_previous2_temp);\nflow.set(\"CL21_previous_temp\",CL21_previous_temp);\nflow.set(\"CL21_current_temp\",CL21_current_temp);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":800,"wires":[["56c8a37a8777198e"]]},{"id":"56c8a37a8777198e","type":"api-current-state","z":"1299179d.0f43a8","name":"CL_21 Hum","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity_21","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":350,"y":860,"wires":[["ddbe18865e99689d"]]},{"id":"ddbe18865e99689d","type":"function","z":"1299179d.0f43a8","name":"set hum values","func":"var CL21_previous2_hum = flow.get(\"CL21_previous_hum\");\nvar CL21_previous_hum = flow.get(\"CL21_current_hum\");\nvar CL21_current_hum = msg.payload;\n\nflow.set(\"CL21_previous2_hum\",CL21_previous2_hum);\nflow.set(\"CL21_previous_hum\",CL21_previous_hum);\nflow.set(\"CL21_current_hum\",CL21_current_hum);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":540,"y":860,"wires":[["39a2ac7182f059aa"]]},{"id":"caf68e20fdf0c714","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":390,"y":920,"wires":[["3c95419483cd00fa"]]},{"id":"3c95419483cd00fa","type":"function","z":"1299179d.0f43a8","name":"Closet floor 21 frozen sensor","func":"msg.payload = `Closet floor 21 frozen sensor`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":920,"wires":[["6021957ca6e46815"]]},{"id":"6021957ca6e46815","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":850,"y":920,"wires":[]},{"id":"39a2ac7182f059aa","type":"function","z":"1299179d.0f43a8","name":"test values","func":"var CL21_previous2_hum = flow.get(\"CL21_previous2_hum\");\nvar CL21_previous_hum = flow.get(\"CL21_previous_hum\");\nvar CL21_current_hum = flow.get(\"CL21_current_hum\");\n\nvar CL21_previous2_temp = flow.get(\"CL21_previous2_temp\");\nvar CL21_previous_temp = flow.get(\"CL21_previous_temp\");\nvar CL21_current_temp = flow.get(\"CL21_current_temp\");\n\nif ( (CL21_previous2_hum==CL21_previous_hum && CL21_previous_hum==CL21_current_hum) && (CL21_previous2_temp==CL21_previous_temp && CL21_previous_temp==CL21_current_temp) )\n{\n\treturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":750,"y":860,"wires":[["caf68e20fdf0c714"]]},{"id":"51055f613d7487cc","type":"inject","z":"1299179d.0f43a8","name":"Every 15min","props":[{"p":"payload"}],"repeat":"","crontab":"*/15 0-23 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":110,"y":760,"wires":[["479935921bdf119c","1e55f0bc22699ea8","dcfeb90548b468cb","8362e5c5b30db190"]]},{"id":"23e197449d188655","type":"server-state-changed","z":"1299179d.0f43a8","d":true,"name":"CL 03 Ebox Res Dry > 24hrs","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"flow","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.hours_since_water_03_09","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"24.0","halt_if_type":"num","halt_if_compare":"gt","output_only_on_state_change":true,"x":140,"y":420,"wires":[["b1e9db6f6c3ed8fd"],[]]},{"id":"11c0b30a71bd95df","type":"function","z":"1299179d.0f43a8","name":"GC Ebox3 Dry","func":"//msg.payload = `GC Ebox3 Dry: ${msg.payload}`;\n\nmsg.payload = `GC Ebox3 Dry: ${flow.get(\"payload\")}`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":720,"y":440,"wires":[["ef04b3ec8eb32e23"]]},{"id":"ef04b3ec8eb32e23","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":930,"y":440,"wires":[]},{"id":"267efc350ebe1719","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":417,"y":400,"wires":[["d8ddc4f5ebc1804c"]]},{"id":"d8ddc4f5ebc1804c","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":617,"y":400,"wires":[["a7598d057810ecee"]]},{"id":"a7598d057810ecee","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":817,"y":400,"wires":[["11c0b30a71bd95df"]]},{"id":"dcfeb90548b468cb","type":"api-current-state","z":"1299179d.0f43a8","name":"CL_22 Temp","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.temperature_22","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":330,"y":1000,"wires":[["c08fd4d957be384a"]]},{"id":"c08fd4d957be384a","type":"function","z":"1299179d.0f43a8","name":"set temp values","func":"var CL22_previous2_temp = flow.get(\"CL22_previous_temp\");\nvar CL22_previous_temp = flow.get(\"CL22_current_temp\");\nvar CL22_current_temp = msg.payload;\n\nflow.set(\"CL22_previous2_temp\",CL22_previous2_temp);\nflow.set(\"CL22_previous_temp\",CL22_previous_temp);\nflow.set(\"CL22_current_temp\",CL22_current_temp);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":1000,"wires":[["2a0cc520bbb7bcd0"]]},{"id":"2a0cc520bbb7bcd0","type":"api-current-state","z":"1299179d.0f43a8","name":"CL_22 Hum","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity_22","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":350,"y":1060,"wires":[["d19836c9bb326ca3"]]},{"id":"d19836c9bb326ca3","type":"function","z":"1299179d.0f43a8","name":"set hum values","func":"var CL22_previous2_hum = flow.get(\"CL22_previous_hum\");\nvar CL22_previous_hum = flow.get(\"CL22_current_hum\");\nvar CL22_current_hum = msg.payload;\n\nflow.set(\"CL22_previous2_hum\",CL22_previous2_hum);\nflow.set(\"CL22_previous_hum\",CL22_previous_hum);\nflow.set(\"CL22_current_hum\",CL22_current_hum);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":540,"y":1060,"wires":[["c59bda67ba8029f9"]]},{"id":"5a923399d465c2c3","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":390,"y":1120,"wires":[["2806e628c4d6c3f1"]]},{"id":"2806e628c4d6c3f1","type":"function","z":"1299179d.0f43a8","name":"CL 22 frozen sensor","func":"msg.payload = `CL 22 frozen sensor`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":600,"y":1120,"wires":[["3c192abe7b88a065"]]},{"id":"3c192abe7b88a065","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":850,"y":1120,"wires":[]},{"id":"c59bda67ba8029f9","type":"function","z":"1299179d.0f43a8","name":"test values","func":"var CL22_previous2_hum = flow.get(\"CL22_previous2_hum\");\nvar CL22_previous_hum = flow.get(\"CL22_previous_hum\");\nvar CL22_current_hum = flow.get(\"CL22_current_hum\");\n\nvar CL22_previous2_temp = flow.get(\"CL22_previous2_temp\");\nvar CL22_previous_temp = flow.get(\"CL22_previous_temp\");\nvar CL22_current_temp = flow.get(\"CL22_current_temp\");\n\nif ( (CL22_previous2_hum==CL22_previous_hum && CL22_previous_hum==CL22_current_hum) && (CL22_previous2_temp==CL22_previous_temp && CL22_previous_temp==CL22_current_temp) )\n{\n\treturn msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":750,"y":1060,"wires":[["5a923399d465c2c3"]]},{"id":"b1e9db6f6c3ed8fd","type":"api-current-state","z":"1299179d.0f43a8","name":"CL_17 Light is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.light_22","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":390,"y":460,"wires":[["267efc350ebe1719"],[]]},{"id":"648697ce8dc1bb35","type":"api-current-state","z":"1299179d.0f43a8","name":"CL_17 Light is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.light_22","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":390,"y":340,"wires":[["d46e506bf020a602"],[]]},{"id":"7535a80f6b6cc023","type":"api-current-state","z":"1299179d.0f43a8","name":"CL_17 Light is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.light_22","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":390,"y":220,"wires":[["583553aef2a7b8ac"],[]]},{"id":"8362e5c5b30db190","type":"time-range-switch","z":"1299179d.0f43a8","name":"10pm - 10am","lat":"","lon":"","startTime":"22:01","endTime":"9:59","startOffset":0,"endOffset":0,"x":320,"y":1200,"wires":[["7415b61f847562c6"],["df36788f33b22333"]]},{"id":"7415b61f847562c6","type":"api-current-state","z":"1299179d.0f43a8","name":"CL_22 Light","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.light_22","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":530,"y":1200,"wires":[["a54d62d3bffe591b"],[]]},{"id":"a54d62d3bffe591b","type":"function","z":"1299179d.0f43a8","name":"CL 22 LIGHT ON BUT SHOULD BE OFF!","func":"msg.payload = `CL 22 LIGHT ON BUT SHOULD BE OFF!`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":800,"y":1180,"wires":[["58dfe705552d12f6"]]},{"id":"58dfe705552d12f6","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":1070,"y":1180,"wires":[]},{"id":"c6cbcc21a3cc6d0d","type":"server-state-changed","z":"1299179d.0f43a8","d":true,"name":"RO Res Level over 93%","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.ultrasonic_sensor_20","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"93.0","halt_if_type":"num","halt_if_compare":"gt","output_only_on_state_change":true,"x":120,"y":1320,"wires":[["b1d37d4fb3a84a25","9ef0d4d48c2ed6bd"],[]]},{"id":"b1d37d4fb3a84a25","type":"function","z":"1299179d.0f43a8","name":"if RO level is rising","func":"var RO_previous_level = parseFloat(flow.get(\"RO_previous_level\"));\nvar RO_level = msg.payload;\n\n//ONLY ALERT ON WHOLE NUMBER CHANGES UNTIL 99.5%\nif (RO_level < 99.4) \n    RO_level = Math.floor(RO_level);\n\nflow.set(\"RO_previous_level\",RO_level);\n\nif (RO_previous_level && RO_previous_level < RO_level) {\n    msg.payload = `WATER LEVEL ${msg.payload}% AND RISING`;\n    \n    return msg;\n}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":1320,"wires":[["0620f8f221eca3d1"]]},{"id":"0620f8f221eca3d1","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":570,"y":1320,"wires":[]},{"id":"9ef0d4d48c2ed6bd","type":"function","z":"1299179d.0f43a8","d":true,"name":"output level and prev level","func":"var RO_previous_level = parseFloat(flow.get(\"RO_previous_level\"));\nvar RO_level = msg.payload;\n\n//ONLY ALERT ON WHOLE NUMBER CHANGES UNTIL 99.5%\nif (RO_level < 99.4) \n    RO_level = Math.floor(RO_level);\n\n//flow.set(\"RO_previous_level\",RO_level);\n\nmsg.payload = `RO_previous_level=${RO_previous_level}, RO_level=${RO_level}, actual=${msg.payload}`;\n\nreturn msg;\n//if (RO_previous_level && RO_previous_level < RO_level) {\n//    msg.payload = `WATER LEVEL ${msg.payload}% AND RISING`;\n//    return msg;\n//}","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":1360,"wires":[["97b706e0826770a5"]]},{"id":"97b706e0826770a5","type":"debug","z":"1299179d.0f43a8","d":true,"name":"RO Levels","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":610,"y":1360,"wires":[]},{"id":"6088d8fe5f88a1b8","type":"api-current-state","z":"1299179d.0f43a8","name":"valves_enabled is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.valves_enabled","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":360,"y":520,"wires":[["38fbaae00e3e051a"],[]]},{"id":"b2e7c70c0c6d9d90","type":"inject","z":"1299179d.0f43a8","name":"Every 6hrs","props":[{"p":"payload"}],"repeat":"21600","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":110,"y":520,"wires":[["6088d8fe5f88a1b8"]]},{"id":"38fbaae00e3e051a","type":"function","z":"1299179d.0f43a8","name":"CL Valves Are Disabled","func":"//msg.payload = `GC Ebox3 Dry: ${msg.payload}`;\n\nmsg.payload = `CL Valves Are Disabled!`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":630,"y":520,"wires":[["bb9f8186c58e3bad"]]},{"id":"bb9f8186c58e3bad","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":890,"y":520,"wires":[]},{"id":"df36788f33b22333","type":"api-current-state","z":"1299179d.0f43a8","name":"Hum Low Water 26 On","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"binary_sensor.hum_low_water_26","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":560,"y":1260,"wires":[["792ae423886bc662"],[]]},{"id":"ced14da06c31be87","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":1090,"y":1320,"wires":[]},{"id":"f21fbdd77965161c","type":"function","z":"1299179d.0f43a8","name":"CL Humidifier Is Low","func":"msg.payload = `CL Humidifier Is Low`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":880,"y":1320,"wires":[["ced14da06c31be87"]]},{"id":"792ae423886bc662","type":"subflow:dd868e2fe1910714","z":"1299179d.0f43a8","name":"","x":810,"y":1260,"wires":[["f21fbdd77965161c"]]},{"id":"0f6595f6e9a1f547","type":"server-state-changed","z":"1299179d.0f43a8","name":"hum over 71 basement dry","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.multisensor_attic_humidity","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"71.0","halt_if_type":"num","halt_if_compare":"gt","output_only_on_state_change":true,"x":135,"y":1922,"wires":[["9ce9b7e9653c4f17"],[]]},{"id":"e87b21d098b78272","type":"server-state-changed","z":"1299179d.0f43a8","name":"hum below 56 basement dry","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.multisensor_attic_humidity","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"56.0","halt_if_type":"num","halt_if_compare":"lt","output_only_on_state_change":true,"x":140,"y":1980,"wires":[["1487620a60f2aac7"],[]]},{"id":"9ce9b7e9653c4f17","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":390,"y":1920,"wires":[["7a37af4d5175bb14"]]},{"id":"7a37af4d5175bb14","type":"function","z":"1299179d.0f43a8","name":"Basemend Dry OVER 71% Hum","func":"msg.payload = `Basemend Dry OVER 71% Hum`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":630,"y":1920,"wires":[["3a733e7845d9cbd8"]]},{"id":"3a733e7845d9cbd8","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":870,"y":1920,"wires":[]},{"id":"ac97b43314173e09","type":"subflow:d3e83ea9.c31f8","z":"1299179d.0f43a8","name":"","x":430,"y":1980,"wires":[["869ab425ecc50d06"]]},{"id":"869ab425ecc50d06","type":"function","z":"1299179d.0f43a8","name":"Basemend Dry BELOW 56% Hum","func":"msg.payload = `Basemend Dry BELOW 56% Hum`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":680,"y":1980,"wires":[["8cf73c2617196019"]]},{"id":"8cf73c2617196019","type":"subflow:71a3fd81.9edc14","z":"1299179d.0f43a8","name":"","x":930,"y":1980,"wires":[]},{"id":"1487620a60f2aac7","type":"api-current-state","z":"1299179d.0f43a8","name":"if switch sonoff 2 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_02","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":280,"y":2040,"wires":[["ac97b43314173e09"],[]]},{"id":"c38c264d.5dd0c8","type":"switch","z":"b2a56d88.4d695","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":210,"y":400,"wires":[["87277b0c.5b3a68"],["98eb16a2.602398"]]},{"id":"87277b0c.5b3a68","type":"api-current-state","z":"b2a56d88.4d695","name":"If BT Work Light is Off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.work_light_02","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":383,"y":375,"wires":[["7f75c278.3e04bc"],[]]},{"id":"7f75c278.3e04bc","type":"api-call-service","z":"b2a56d88.4d695","name":"Turn BT Internal Fan On","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.switch_sonoff_03"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":613,"y":375,"wires":[[]]},{"id":"98eb16a2.602398","type":"api-current-state","z":"b2a56d88.4d695","name":"If BT Work Light is On","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.work_light_02","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":383,"y":427,"wires":[["38e7812.2ade57e"],[]]},{"id":"38e7812.2ade57e","type":"api-call-service","z":"b2a56d88.4d695","name":"Turn BT Work Light Off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.work_light_02"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":603,"y":427,"wires":[[]]},{"id":"1307e450.c7c51c","type":"alexa-home","z":"b2a56d88.4d695","d":true,"conf":"69543e7577c6ab2b","device":"115517","acknoledge":true,"name":"Work Light","topic":"","x":80,"y":400,"wires":[["c38c264d.5dd0c8"]]},{"id":"b3ffef413859f9c7","type":"inject","z":"b2a56d88.4d695","d":true,"name":"Every Minute","props":[{"p":"payload"}],"repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":60,"wires":[["886b2ca5b347a935"]]},{"id":"886b2ca5b347a935","type":"api-current-state","z":"b2a56d88.4d695","name":"If BT Root Power Is On","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_02","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":350,"y":60,"wires":[["11e61d991ee76d19"],[]]},{"id":"1a1fb5cb92a401a4","type":"api-current-state","z":"b2a56d88.4d695","name":"If BT Internal Fan Is Off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_03","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":670,"y":120,"wires":[["9eb56429915fc9ba"],[]]},{"id":"9eb56429915fc9ba","type":"api-call-service","z":"b2a56d88.4d695","name":"Turn BT Internal Fan On","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.switch_sonoff_03"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":910,"y":120,"wires":[[]]},{"id":"4e66df9839b36b75","type":"api-current-state","z":"b2a56d88.4d695","name":"If BT Internal Fan is On","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_03","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":660,"y":172,"wires":[["2cd412d54da3ee1b"],[]]},{"id":"2cd412d54da3ee1b","type":"api-call-service","z":"b2a56d88.4d695","name":"Turn BT Internal Fan Off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.switch_sonoff_03"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":890,"y":172,"wires":[[]]},{"id":"11e61d991ee76d19","type":"function","z":"b2a56d88.4d695","name":"on 5min then off 15min","func":"const now = new Date();\nconst min = now.getMinutes()\nif (min <= 4 || (min >= 19 && min <= 24) || (min >= 39 && min <= 44)) {\n    return [msg, null];\n} else {\n    return [null, msg];\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":140,"wires":[["1a1fb5cb92a401a4"],["4e66df9839b36b75"]]},{"id":"a6d45099a92e3a76","type":"server-state-changed","z":"be4e15f2722bc10d","d":true,"name":"vpd_04 in T","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.vpd_04","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","output_only_on_state_change":true,"x":90,"y":60,"wires":[["0b137810ec8acb40"]]},{"id":"0b137810ec8acb40","type":"switch","z":"be4e15f2722bc10d","name":"if VPD is less than 1.00","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"1.00","vt":"num"},{"t":"gte","v":"1.00","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":60,"wires":[["3fe092f709fa8bc0"],["8c5c72be2b324f38"]]},{"id":"5fba8c10634d5e84","type":"server-state-changed","z":"be4e15f2722bc10d","d":true,"name":"temperature04 in T","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.temperature04","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lte","output_only_on_state_change":true,"x":110,"y":220,"wires":[["8b47b2c6f6f58593"]]},{"id":"8b47b2c6f6f58593","type":"switch","z":"be4e15f2722bc10d","name":"if temp is \\n above 85.0 \\n below 85.0 \\n below 63","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"85.0","vt":"num"},{"t":"lte","v":"85.0","vt":"num"},{"t":"lt","v":"63.0","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":310,"y":220,"wires":[["983572dfd06f1f71"],["0c7d9c1b48f68095"],["75de93fcf5484bb5"]]},{"id":"3fe092f709fa8bc0","type":"api-current-state","z":"be4e15f2722bc10d","name":"if temp above 63.0","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"63.0","halt_if_type":"num","halt_if_compare":"gt","entity_id":"sensor.temperature04","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":650,"y":60,"wires":[["983572dfd06f1f71"],[]]},{"id":"0c7d9c1b48f68095","type":"api-current-state","z":"be4e15f2722bc10d","name":"if vpd_04 is above 1.01 (turn off fan)","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"1.01","halt_if_type":"num","halt_if_compare":"gte","entity_id":"sensor.vpd_04","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":710,"y":240,"wires":[["75de93fcf5484bb5"],[]]},{"id":"983572dfd06f1f71","type":"api-current-state","z":"be4e15f2722bc10d","name":"If fan is Off for T","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch_3","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":880,"y":20,"wires":[["e73a7c889b69b025"],[]]},{"id":"e73a7c889b69b025","type":"api-call-service","z":"be4e15f2722bc10d","name":"Turn T fan On","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch_3"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1040,"y":60,"wires":[[]]},{"id":"75de93fcf5484bb5","type":"api-current-state","z":"be4e15f2722bc10d","name":"If T fan is On","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch_3","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":850,"y":120,"wires":[["064fcc6affe1308a"],[]]},{"id":"064fcc6affe1308a","type":"api-call-service","z":"be4e15f2722bc10d","name":"Turn cl fan Off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch_3"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":1040,"y":160,"wires":[[]]},{"id":"8c5c72be2b324f38","type":"api-current-state","z":"be4e15f2722bc10d","name":"if temp below 85.0","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"85.0","halt_if_type":"num","halt_if_compare":"lt","entity_id":"sensor.temperature04","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":650,"y":120,"wires":[["75de93fcf5484bb5"],[]]},{"id":"7a034b247dd77365","type":"inject","z":"be4e15f2722bc10d","d":true,"name":"11:00 AM","props":[{"p":"payload"}],"repeat":"","crontab":"00 11 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":110,"y":460,"wires":[[]]},{"id":"390be66b84771fd9","type":"inject","z":"be4e15f2722bc10d","d":true,"name":"10:00 PM","props":[{"p":"payload"}],"repeat":"","crontab":"00 22 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":110,"y":360,"wires":[[]]},{"id":"923071f925455692","type":"api-current-state","z":"be4e15f2722bc10d","name":"if smart strip 1 Dehumidifier is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":760,"y":340,"wires":[["526e20b69413ecf7"],[]]},{"id":"526e20b69413ecf7","type":"api-call-service","z":"be4e15f2722bc10d","name":"set smart strip 1 Dehumidifier state on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":830,"y":380,"wires":[[]]},{"id":"4fbb3720a3ce3992","type":"api-current-state","z":"be4e15f2722bc10d","name":"if smart strip 1 Dehumidifier is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":760,"y":420,"wires":[["7f138bd6efcf39b2"],[]]},{"id":"7f138bd6efcf39b2","type":"api-call-service","z":"be4e15f2722bc10d","name":"set smart strip 1 Dehumidifier state off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":830,"y":460,"wires":[[]]},{"id":"d9f889256d06546d","type":"server-state-changed","z":"be4e15f2722bc10d","d":true,"name":"vpd_04 in t","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.vpd_04","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","output_only_on_state_change":true,"x":80,"y":400,"wires":[["ac10134f4fb380e5"]]},{"id":"ac10134f4fb380e5","type":"switch","z":"be4e15f2722bc10d","name":"if VPD is less than 1.23","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"1.23","vt":"num"},{"t":"gte","v":"1.23","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":400,"wires":[["1426d02226a3cf22"],["4fbb3720a3ce3992"]]},{"id":"1426d02226a3cf22","type":"api-current-state","z":"be4e15f2722bc10d","name":"if temp04 below 77.0","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"77.0","halt_if_type":"num","halt_if_compare":"lt","entity_id":"sensor.temperature04","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":480,"y":340,"wires":[["923071f925455692"],["4fbb3720a3ce3992"]]},{"id":"43d06adaddaaa5d4","type":"api-current-state","z":"be4e15f2722bc10d","name":"If h.pad is Off in CAB","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch_4","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":580,"y":560,"wires":[["b10a64279d8a732b"],[]]},{"id":"b10a64279d8a732b","type":"api-call-service","z":"be4e15f2722bc10d","name":"Turn h.pad On in CAB","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch_4"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":560,"wires":[[]]},{"id":"98a2a30590e11948","type":"api-current-state","z":"be4e15f2722bc10d","name":"If h.pad is On in CAB","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch_4","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":580,"y":500,"wires":[["3028cc6abcf66c6c"],[]]},{"id":"3028cc6abcf66c6c","type":"api-call-service","z":"be4e15f2722bc10d","name":"Turn h.pad Off in CAB","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch_4"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":820,"y":500,"wires":[[]]},{"id":"764506709aa8fd20","type":"server-state-changed","z":"be4e15f2722bc10d","d":true,"name":"Dome Temp in CAB","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.cab_multisensor_temperature","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lte","output_only_on_state_change":true,"x":110,"y":540,"wires":[["81fffbdfdb6982e9"]]},{"id":"81fffbdfdb6982e9","type":"switch","z":"be4e15f2722bc10d","name":"if temp is \\n above 72.0 \\n below 72.0","property":"payload","propertyType":"msg","rules":[{"t":"gte","v":"72.0","vt":"num"},{"t":"lt","v":"72.0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":540,"wires":[["98a2a30590e11948"],["43d06adaddaaa5d4"]]},{"id":"dd9fadda43a09309","type":"api-current-state","z":"be4e15f2722bc10d","name":"If stirrer is Off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch_3","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":360,"y":620,"wires":[["e9a2d31f0587c154"],["04e6d9460cdd909f"]]},{"id":"e9a2d31f0587c154","type":"api-call-service","z":"be4e15f2722bc10d","name":"Turn stirrer fan On","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch_3"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":570,"y":620,"wires":[["8e706a0ed6957132"]]},{"id":"39481df6cdb9ca8d","type":"api-current-state","z":"be4e15f2722bc10d","name":"If stirrer is On","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch_3","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":370,"y":700,"wires":[["04e6d9460cdd909f"],[]]},{"id":"04e6d9460cdd909f","type":"api-call-service","z":"be4e15f2722bc10d","name":"Turn stirrer Off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc11_smart_strip_switch_3"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":580,"y":700,"wires":[[]]},{"id":"8e706a0ed6957132","type":"delay","z":"be4e15f2722bc10d","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":600,"y":660,"wires":[["39481df6cdb9ca8d"]]},{"id":"6b8741c7ed2a5a88","type":"inject","z":"be4e15f2722bc10d","d":true,"name":"every 15 min","props":[{"p":"payload"}],"repeat":"900","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":120,"y":620,"wires":[["dd9fadda43a09309"]]},{"id":"fc80f9e01f5e1424","type":"http request","z":"be4e15f2722bc10d","name":"Camera Command","method":"GET","ret":"txt","paytoqs":"query","url":"http://192.168.1.48:3000/cam","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":970,"y":1340,"wires":[[]]},{"id":"a1fd9b66bd77811e","type":"server-state-changed","z":"be4e15f2722bc10d","d":true,"name":"VPD 04 - T","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"VPD_04","propertyType":"flow","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.vpd_04","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","output_only_on_state_change":true,"x":100,"y":1180,"wires":[["717423bef4d257b1"]]},{"id":"f472fa831a08f4f1","type":"api-current-state","z":"be4e15f2722bc10d","name":"get temp04","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.temperature_04","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":410,"y":1200,"wires":[["b8c0e54f805f6dc6"]]},{"id":"b8c0e54f805f6dc6","type":"function","z":"be4e15f2722bc10d","name":"set TEMP_04","func":"flow.set(\"TEMP_04\",msg.payload.toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":1200,"wires":[["c63bd23deeeb2daa"]]},{"id":"c63bd23deeeb2daa","type":"api-current-state","z":"be4e15f2722bc10d","name":"get hum04","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity_04","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":410,"y":1260,"wires":[["3856e531e8980960"]]},{"id":"3856e531e8980960","type":"function","z":"be4e15f2722bc10d","name":"set HUM_04","func":"flow.set(\"HUM_04\",msg.payload.toFixed(1));\n\nvar display = `VPD=${flow.get(\"VPD_04\")} TEMP=${flow.get(\"TEMP_04\")} HUM=${flow.get(\"HUM_04\")}`;\n\nmsg.payload = {display:display, enabe:1, name:\"T\"};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":1260,"wires":[["11c898d184745f36"]]},{"id":"d3b3e08879d90831","type":"server-state-changed","z":"be4e15f2722bc10d","name":"VPD 29 - CL","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.vpd_29","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","output_only_on_state_change":true,"x":90,"y":1560,"wires":[["81073040e881d26c"]]},{"id":"81073040e881d26c","type":"function","z":"be4e15f2722bc10d","name":"set VPD_22","func":"flow.set(\"VPD_29\",msg.payload.toFixed(2));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":250,"y":1560,"wires":[["e9c64317212ff332"]]},{"id":"e9c64317212ff332","type":"api-current-state","z":"be4e15f2722bc10d","name":"get temp29","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.temperature_29","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":470,"y":1540,"wires":[["b5fab4ba8e018267"]]},{"id":"b5fab4ba8e018267","type":"function","z":"be4e15f2722bc10d","name":"set TEMP_29","func":"flow.set(\"TEMP_29\",msg.payload.toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":640,"y":1540,"wires":[["1ec5978928d5632a"]]},{"id":"1ec5978928d5632a","type":"api-current-state","z":"be4e15f2722bc10d","name":"get hum29","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity_29","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":470,"y":1600,"wires":[["e6eec06ee4d17e4c"]]},{"id":"e6eec06ee4d17e4c","type":"function","z":"be4e15f2722bc10d","name":"set HUM_22","func":"flow.set(\"HUM_29\",msg.payload.toFixed(1));\n\n//var display = `VPD=${flow.get(\"VPD_17\")} TEMP=${flow.get(\"TEMP_17\")} HUM=${flow.get(\"HUM_17\")}`;\n\n//var display = `V=${flow.get(\"VPD_17\")} T=${flow.get(\"TEMP_17\")} H=${flow.get(\"HUM_17\")} ${flow.get(\"CL_1\")},${flow.get(\"CL_2\")}`;\n\n//msg.payload = {display:display, enabe:1, name:\"CL\"};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":630,"y":1600,"wires":[["35f0415b9212eaf6"]]},{"id":"b71d5b5ad19bbc7b","type":"debug","z":"be4e15f2722bc10d","name":"CL debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":760,"y":1740,"wires":[]},{"id":"e99dfb0f4293ad81","type":"server-state-changed","z":"be4e15f2722bc10d","d":true,"name":"Last CL Water 1","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.hours_since_water_01_09","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","output_only_on_state_change":true,"x":80,"y":1620,"wires":[["cb1f0cc3f5391127"]]},{"id":"dc106a14045a13ca","type":"server-state-changed","z":"be4e15f2722bc10d","d":true,"name":"Last CL Water 2","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.hours_since_water_02_09","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","output_only_on_state_change":true,"x":80,"y":1680,"wires":[["81b4ac7bdfca4580"]]},{"id":"cb1f0cc3f5391127","type":"function","z":"be4e15f2722bc10d","name":"set CL_1","func":"flow.set(\"CL_1\",msg.payload.toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":1620,"wires":[["35f0415b9212eaf6"]]},{"id":"81b4ac7bdfca4580","type":"function","z":"be4e15f2722bc10d","name":"set CL_2","func":"flow.set(\"CL_2\",msg.payload.toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":1680,"wires":[["35f0415b9212eaf6"]]},{"id":"35f0415b9212eaf6","type":"function","z":"be4e15f2722bc10d","name":"build cam command","func":"//flow.set(\"HUM_17\",msg.payload);\n\nvar display = `VPD=${flow.get(\"VPD_29\")} TEMP=${flow.get(\"TEMP_29\")} HUM=${flow.get(\"HUM_29\")}`;\n\n//var display = `V=${flow.get(\"VPD_17\")} T=${flow.get(\"TEMP_17\")} H=${flow.get(\"HUM_17\")} ${flow.get(\"CL_1\")}:${flow.get(\"CL_2\")}`;\n\n//var display = `V${flow.get(\"VPD_22\")} T${flow.get(\"TEMP_22\")} B${flow.get(\"CL_1\")}:G${flow.get(\"CL_3\")}:F${flow.get(\"CL_2\")}`;\n\nmsg.payload = {display:display, enabe:1, name:\"CL\"};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":660,"y":1680,"wires":[["b71d5b5ad19bbc7b","251636ab2b05f9a1"]]},{"id":"9f67aa8e650cac96","type":"debug","z":"be4e15f2722bc10d","name":"T debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":840,"y":1180,"wires":[]},{"id":"d015b2038e7aafdc","type":"server-state-changed","z":"be4e15f2722bc10d","name":"VPD 11 - CAB","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.vpd_11_2","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","output_only_on_state_change":true,"x":90,"y":880,"wires":[["ccb9636a4a0d27c4"]]},{"id":"ccb9636a4a0d27c4","type":"function","z":"be4e15f2722bc10d","name":"set VPD_11","func":"flow.set(\"VPD_11\",msg.payload.toFixed(2));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":250,"y":880,"wires":[["1640ee220a25018a"]]},{"id":"1640ee220a25018a","type":"api-current-state","z":"be4e15f2722bc10d","name":"get temp11","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.temperature11_2","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":410,"y":880,"wires":[["a73fdbe0656e09fa"]]},{"id":"a73fdbe0656e09fa","type":"function","z":"be4e15f2722bc10d","name":"set TEMP11","func":"flow.set(\"TEMP_11\",msg.payload.toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":880,"wires":[["547c8c884ed255b9"]]},{"id":"547c8c884ed255b9","type":"api-current-state","z":"be4e15f2722bc10d","name":"get hum11","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity11_2","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":410,"y":940,"wires":[["56e90d4ac90ff5a8"]]},{"id":"56e90d4ac90ff5a8","type":"function","z":"be4e15f2722bc10d","name":"set HUM_11","func":"flow.set(\"HUM_11\",msg.payload.toFixed(1));\n\nvar display = `VPD=${flow.get(\"VPD_11\")} TEMP=${flow.get(\"TEMP_11\")} HUM=${flow.get(\"HUM_11\")}`;\n\nmsg.payload = {display:display, enabe:1, name:\"CAB\"};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":940,"wires":[["9f67aa8e650cac96","11c898d184745f36"]]},{"id":"11a8122618d001b1","type":"inject","z":"be4e15f2722bc10d","name":"every 5 min","props":[{"p":"payload"}],"repeat":"300","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"true","payloadType":"bool","x":110,"y":2000,"wires":[["cb241c92246b08d2"]]},{"id":"a23070c70827cb4b","type":"api-current-state","z":"be4e15f2722bc10d","name":"get attic intake temp 31","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.mobile_31_temperature_31","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"TEMP_19","propertyType":"flow","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":370,"y":1960,"wires":[["dc8fb6642f1f0463"]]},{"id":"be56b6315bb2596e","type":"function","z":"be4e15f2722bc10d","d":true,"name":"set TEMP_19","func":"flow.set(\"TEMP_19\",msg.payload.toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":710,"y":1900,"wires":[[]]},{"id":"ce15c6763f9fa2ae","type":"api-current-state","z":"be4e15f2722bc10d","name":"get Closet Intake Temp 21","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.temperature_21","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"TEMP_21","propertyType":"flow","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":380,"y":2080,"wires":[["6e20cca60d2ab44b"]]},{"id":"50d1f582d84aa098","type":"function","z":"be4e15f2722bc10d","d":true,"name":"set TEMP_21","func":"flow.set(\"TEMP_21\",msg.payload.toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":710,"y":1960,"wires":[[]]},{"id":"af58097d53ce2791","type":"function","z":"be4e15f2722bc10d","name":"if Attic cooler than Closet Floor","func":"var TEMP_19 = flow.get(\"TEMP_19\"); //attic\nvar HUM_19 = flow.get(\"HUM_19\"); //attic\n\nvar TEMP_21 = flow.get(\"TEMP_21\"); //closet floor\nvar HUM_21 = flow.get(\"HUM_21\"); //closet floor\n\nvar TEMP_29 = flow.get(\"TEMP_29\"); //closet \nvar HUM_29 = flow.get(\"HUM_29\"); //closet \n\nvar LIGHT_29 = flow.get(\"LIGHT_29\"); //closet light on/off\n\nvar SILENT_NIGHT = flow.get(\"SILENT_NIGHT\"); //closet light on/off\n\nmsg.payload = `attic -> TEMP_19=${TEMP_19}, HUM_19=${HUM_19},  floor -> TEMP_21=${TEMP_21}, HUM_21=${HUM_21}, closet -> TEMP_29=${TEMP_29}, HUM_29=${HUM_29},  LIGHT_29=${LIGHT_29}`;\n\n\nif (LIGHT_29 === \"off\" && SILENT_NIGHT === \"on\") {\n    return [null, null, null, msg];\n}\n\n//IF LIGHTS OFF AND TOO COLD IN ATTIC  - USE CLOSET FLOOR\nconst tooColdInAttic = (TEMP_19 < 65.5 && TEMP_29 < 67.0 && TEMP_19 < TEMP_21);\nif (LIGHT_29 === \"off\" && tooColdInAttic) {\n    return [null, msg, null, null];\n}\n\n\n//IF LIGHTS ON AND TOO HUMID IN ATTIC - USE CLOSET FLOOR\n//  CLOSET LIGHTS ON AN OVER 65% HUM - ATTICK ABOVE 65% AND HIGHER HUM THAN FLOOR\nconst tooHumidInAtticAndLightsOn = (LIGHT_29 === \"on\" && HUM_29 > 57.0 && HUM_19 > 65.0 && HUM_19 > HUM_21);\nif (tooHumidInAtticAndLightsOn) {\n    return [null, msg, null, null];\n}\n\n//IF LIGHTS OFF AND TOO HUMID IN ATTIC - USE CLOSET FLOOR\n//  CLOSET LIGHTS ON AN OVER 55% HUM - ATTICK ABOVE 55% AND HIGHER HUM THAN FLOOR\nconst tooHumidInAtticAndLightsOff = (LIGHT_29 === \"off\" && HUM_29 > 55.0 && HUM_19 > 55.0 && HUM_19 > HUM_21);\nif (tooHumidInAtticAndLightsOff) {\n    return [null, msg, null, null];\n}\n\n\n//IF TOO HOT IN CL THEN TURN ON BOTH INTAKES\nif (TEMP_29 > 80.5 && TEMP_19 < 75.0 && TEMP_21 < 75.0) {\n    return [null, null, msg, null];\n}\n\n\n//IF ATTICK is BELOW 73.1 OR ATTICK TEMP IS BELOW FLOOR (or close enough)\nconst attickIsColderEnough = ((TEMP_19 - TEMP_21) < 4.0); //that attic less than 4.0 (was 6) deg warmer than floor\nif (TEMP_19 < 73.1 || attickIsColderEnough) {\n    return [msg, null, null, null];\n} else {\n    return [null, msg, null, null];\n}","outputs":4,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":2320,"wires":[["a1120225b9ffbf37","fc25a6169639150b","f684369126c05dd1"],["38b8eb4ef4162bac","3cb920a5fa5af1d4","04af5b4f4e955e1b"],["a1120225b9ffbf37","3cb920a5fa5af1d4","5fec9aa68ff79b32"],["fc25a6169639150b","38b8eb4ef4162bac","4c79374b4d03a6e1"]]},{"id":"38b8eb4ef4162bac","type":"api-current-state","z":"be4e15f2722bc10d","name":"if attic intake is enabled","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.mobile_31_power_31","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":790,"y":2380,"wires":[["5c945128e67bf7bf"],[]]},{"id":"5c945128e67bf7bf","type":"api-call-service","z":"be4e15f2722bc10d","name":"disable attic intake","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.mobile_31_power_31"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":830,"y":2420,"wires":[[]]},{"id":"a1120225b9ffbf37","type":"api-current-state","z":"be4e15f2722bc10d","name":"if attic intake is disabled","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.mobile_31_power_31","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":790,"y":2180,"wires":[["39c477604c600c42"],[]]},{"id":"39c477604c600c42","type":"api-call-service","z":"be4e15f2722bc10d","name":"enable attic intake","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.mobile_31_power_31"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":830,"y":2220,"wires":[[]]},{"id":"f684369126c05dd1","type":"debug","z":"be4e15f2722bc10d","name":"turn on attic fan","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":480,"y":2380,"wires":[]},{"id":"04af5b4f4e955e1b","type":"debug","z":"be4e15f2722bc10d","name":"turn off attic fan","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":480,"y":2420,"wires":[]},{"id":"3cb920a5fa5af1d4","type":"api-current-state","z":"be4e15f2722bc10d","name":"if closet intake is disabled","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.power_21","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":790,"y":2460,"wires":[["cf112c4b6cf1abe0"],[]]},{"id":"cf112c4b6cf1abe0","type":"api-call-service","z":"be4e15f2722bc10d","name":"enable closet intake","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.power_21"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":2500,"wires":[[]]},{"id":"fc25a6169639150b","type":"api-current-state","z":"be4e15f2722bc10d","name":"if closet intake is enabled","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.power_21","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":790,"y":2260,"wires":[["3330e395fa3cec83"],[]]},{"id":"3330e395fa3cec83","type":"api-call-service","z":"be4e15f2722bc10d","name":"disable closet intake","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.power_21"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":2300,"wires":[[]]},{"id":"6825927d40d40a1c","type":"server-state-changed","z":"be4e15f2722bc10d","d":true,"name":"Last CL Water 3","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.hours_since_water_03_09","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","output_only_on_state_change":true,"x":80,"y":1740,"wires":[["eb19809917f9d308"]]},{"id":"eb19809917f9d308","type":"function","z":"be4e15f2722bc10d","name":"set CL_3","func":"flow.set(\"CL_3\",msg.payload.toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":260,"y":1740,"wires":[["35f0415b9212eaf6"]]},{"id":"251636ab2b05f9a1","type":"subflow:4433b13830f60388","z":"be4e15f2722bc10d","name":"","x":890,"y":1580,"wires":[["fc80f9e01f5e1424","b10604de8070b0bf"]]},{"id":"11c898d184745f36","type":"subflow:4433b13830f60388","z":"be4e15f2722bc10d","name":"","x":950,"y":1280,"wires":[["fc80f9e01f5e1424"]]},{"id":"b10604de8070b0bf","type":"debug","z":"be4e15f2722bc10d","name":"CL 5sec debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":940,"y":1680,"wires":[]},{"id":"1d769060e4360589","type":"function","z":"be4e15f2722bc10d","d":true,"name":"set LIGHT_22","func":"flow.set(\"LIGHT_22\",msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":720,"y":2020,"wires":[[]]},{"id":"f772c1fe7912f0b8","type":"api-current-state","z":"be4e15f2722bc10d","name":"get light state","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.light_29","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"LIGHT_29","propertyType":"flow","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":340,"y":2200,"wires":[["185dbeb6f2e2f882"]]},{"id":"cb241c92246b08d2","type":"api-current-state","z":"be4e15f2722bc10d","name":"CL temp 29","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.temperature_29","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"TEMP_29","propertyType":"flow","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":330,"y":1840,"wires":[["d6e1780f7c784f4e"]]},{"id":"5fec9aa68ff79b32","type":"debug","z":"be4e15f2722bc10d","name":"turn on both","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":470,"y":2460,"wires":[]},{"id":"dc8fb6642f1f0463","type":"api-current-state","z":"be4e15f2722bc10d","name":"get attic intake hum 31","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.mobile_31_humidity_31","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"HUM_19","propertyType":"flow","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":360,"y":2020,"wires":[["ce15c6763f9fa2ae"]]},{"id":"6e20cca60d2ab44b","type":"api-current-state","z":"be4e15f2722bc10d","name":"get Closet Intake Hum 21","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity_21","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"HUM_21","propertyType":"flow","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":370,"y":2140,"wires":[["f772c1fe7912f0b8"]]},{"id":"d6e1780f7c784f4e","type":"api-current-state","z":"be4e15f2722bc10d","name":"CL hum 29","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity_29","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"HUM_29","propertyType":"flow","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":330,"y":1900,"wires":[["a23070c70827cb4b"]]},{"id":"b24ed66f92f86e4e","type":"api-current-state","z":"be4e15f2722bc10d","name":"If light_04 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.light_04","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":180,"y":1300,"wires":[["f472fa831a08f4f1"],[]]},{"id":"185dbeb6f2e2f882","type":"api-current-state","z":"be4e15f2722bc10d","name":"get silent night","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"input_boolean.silent_night","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"SILENT_NIGHT","propertyType":"flow","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":340,"y":2260,"wires":[["af58097d53ce2791"]]},{"id":"4c79374b4d03a6e1","type":"debug","z":"be4e15f2722bc10d","name":"turn on both","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":470,"y":2500,"wires":[]},{"id":"e68dd64af15ee33d","type":"server-state-changed","z":"be4e15f2722bc10d","d":true,"name":"VPD 30 - T (cam in Basement)","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"VPD_30","propertyType":"flow","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.vpd_30","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","output_only_on_state_change":true,"x":140,"y":1000,"wires":[["99829c43bcf7b6bf"]]},{"id":"81732c421c809d81","type":"api-current-state","z":"be4e15f2722bc10d","name":"get temp30","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.temperature30","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"TEMP_30","propertyType":"flow","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":410,"y":1000,"wires":[["aa4eaff2c006d27d"]]},{"id":"aa4eaff2c006d27d","type":"api-current-state","z":"be4e15f2722bc10d","name":"get hum30","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity30","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"HUM_30","propertyType":"flow","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":570,"y":1000,"wires":[["5b5f7d9308282c1f"]]},{"id":"5b5f7d9308282c1f","type":"function","z":"be4e15f2722bc10d","name":"Create Message For Cam T","func":"\nvar display = `VPD=${flow.get(\"VPD_30\")} TEMP=${flow.get(\"TEMP_30\")} HUM=${flow.get(\"HUM_30\")}`;\n\nmsg.payload = {display:display, enabe:1, name:\"T\"};\n\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":1060,"wires":[["11c898d184745f36","9f67aa8e650cac96"]]},{"id":"99829c43bcf7b6bf","type":"api-current-state","z":"be4e15f2722bc10d","name":"If switch 5 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.smart_energy_switch_5","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":200,"y":1060,"wires":[["81732c421c809d81","284f7c7850186fb0"],["e5b85e5926a35416"]]},{"id":"c1548cf06f05c808","type":"api-current-state","z":"be4e15f2722bc10d","name":"if sonoff 1 is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_01","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":620,"y":740,"wires":[["81fcc4768a49f12f"],[]]},{"id":"81fcc4768a49f12f","type":"api-call-service","z":"be4e15f2722bc10d","name":"turn on sonoff 1","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.switch_sonoff_01"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":800,"y":740,"wires":[[]]},{"id":"e5b85e5926a35416","type":"api-current-state","z":"be4e15f2722bc10d","name":"if sonoff 1 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_01","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":620,"y":800,"wires":[["c3e924e850ecbc25"],[]]},{"id":"c3e924e850ecbc25","type":"api-call-service","z":"be4e15f2722bc10d","name":"turn off sonoff 1","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.switch_sonoff_01"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":800,"y":800,"wires":[[]]},{"id":"284f7c7850186fb0","type":"switch","z":"be4e15f2722bc10d","name":"if VPD_30 is \\n above 1.2 \\n below 1.2","property":"VPD_30","propertyType":"flow","rules":[{"t":"gte","v":"1.2","vt":"num"},{"t":"lt","v":"1.2","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":780,"wires":[["c1548cf06f05c808"],["e5b85e5926a35416"]]},{"id":"f438c652937d405b","type":"api-current-state","z":"be4e15f2722bc10d","name":"if sonoff 1 is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_01","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":700,"y":2620,"wires":[["17abcf71abe3e2d8"],[]]},{"id":"17abcf71abe3e2d8","type":"api-call-service","z":"be4e15f2722bc10d","name":"turn on sonoff 1","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.switch_sonoff_01"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":880,"y":2620,"wires":[[]]},{"id":"fe9de730757ea117","type":"api-current-state","z":"be4e15f2722bc10d","name":"if sonoff 1 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_01","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":700,"y":2680,"wires":[["7c6a7de4f5fab0d3"],[]]},{"id":"7c6a7de4f5fab0d3","type":"api-call-service","z":"be4e15f2722bc10d","name":"turn off sonoff 1","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.switch_sonoff_01"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":880,"y":2680,"wires":[[]]},{"id":"e0f04dcfab5fd96f","type":"server-state-changed","z":"be4e15f2722bc10d","d":true,"name":"Temp in T less than 72","server":"1b7e4fe1.0da8e","version":4,"outputs":2,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.temperature_04","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"72","halt_if_type":"num","halt_if_compare":"lt","output_only_on_state_change":true,"x":120,"y":2660,"wires":[["5c24a56e8380c28b"],["fe9de730757ea117"]]},{"id":"5c24a56e8380c28b","type":"api-current-state","z":"be4e15f2722bc10d","name":"If T is enabled","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch_3","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":260,"y":2600,"wires":[["0a85dc96a028137f"],["fe9de730757ea117"]]},{"id":"0a85dc96a028137f","type":"api-current-state","z":"be4e15f2722bc10d","name":"If light_04 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.light_04","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":460,"y":2580,"wires":[["f438c652937d405b"],["fe9de730757ea117"]]},{"id":"717423bef4d257b1","type":"api-current-state","z":"be4e15f2722bc10d","name":"If T is enabled","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc11_smart_strip_switch_3","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":180,"y":1240,"wires":[["b24ed66f92f86e4e"],[]]},{"id":"dbe54eea447249cd","type":"server-state-changed","z":"be4e15f2722bc10d","name":"VPD 30 - BT","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"VPD_30","propertyType":"flow","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.vpd_30","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","output_only_on_state_change":true,"x":110,"y":1360,"wires":[["76a9386a95a92c15"]]},{"id":"8153461ffbaeaf63","type":"api-current-state","z":"be4e15f2722bc10d","name":"get temp30","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.temperature30","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":450,"y":1380,"wires":[["894976d3cb50a2ee"]]},{"id":"894976d3cb50a2ee","type":"function","z":"be4e15f2722bc10d","name":"set TEMP_30","func":"flow.set(\"TEMP_30\",msg.payload.toFixed(1));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":630,"y":1380,"wires":[["359537925fff05ac"]]},{"id":"359537925fff05ac","type":"api-current-state","z":"be4e15f2722bc10d","name":"get hum30","server":"1b7e4fe1.0da8e","version":3,"outputs":1,"halt_if":"","halt_if_type":"str","halt_if_compare":"is","entity_id":"sensor.humidity30","state_type":"num","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":450,"y":1440,"wires":[["d0489aaa3583deaf"]]},{"id":"d0489aaa3583deaf","type":"function","z":"be4e15f2722bc10d","name":"set HUM_30","func":"flow.set(\"HUM_30\",msg.payload.toFixed(1));\n\nvar display = `VPD=${flow.get(\"VPD_30\")} TEMP=${flow.get(\"TEMP_30\")} HUM=${flow.get(\"HUM_30\")}`;\n\nmsg.payload = {display:display, enabe:1, name:\"T\"};\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":630,"y":1440,"wires":[["11c898d184745f36"]]},{"id":"65f9136b90939520","type":"api-current-state","z":"be4e15f2722bc10d","name":"If sonoff light_04 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_04","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":200,"y":1480,"wires":[["8153461ffbaeaf63"],[]]},{"id":"76a9386a95a92c15","type":"api-current-state","z":"be4e15f2722bc10d","name":"If BT is enabled","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_08","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":180,"y":1420,"wires":[["65f9136b90939520"],[]]},{"id":"b5d75cf1bb16719e","type":"sunrise","z":"07af2ec6799331c0","name":"2hrs before sunrise to 5min before sunset","lat":"38.810937","lon":"-77.155829","start":"sunrise","end":"sunset","soff":"-120","eoff":"-5","x":180,"y":100,"wires":[["90bec02148b1c1a7"],["b8850c318b1eca35"]]},{"id":"76db963da74b0a37","type":"api-current-state","z":"07af2ec6799331c0","name":"if LED Strip is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc06106_smart_energy_switch_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":610,"y":80,"wires":[["efd6d152bb0f011a"],[]]},{"id":"efd6d152bb0f011a","type":"api-call-service","z":"07af2ec6799331c0","name":"turn LED Strip on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc06106_smart_energy_switch_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":670,"y":140,"wires":[[]]},{"id":"91295ea717699d68","type":"api-current-state","z":"07af2ec6799331c0","name":"if LED Strip is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.aeon_labs_dsc06106_smart_energy_switch_switch","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":610,"y":300,"wires":[["13f581b90d5edbc1"],[]]},{"id":"13f581b90d5edbc1","type":"api-call-service","z":"07af2ec6799331c0","name":"turn LED Strip off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.aeon_labs_dsc06106_smart_energy_switch_switch"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":670,"y":360,"wires":[[]]},{"id":"b8850c318b1eca35","type":"switch","z":"07af2ec6799331c0","name":"1 = day\\n 0 = night","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":320,"y":180,"wires":[["76db963da74b0a37"],["91295ea717699d68"]]},{"id":"90bec02148b1c1a7","type":"function","z":"07af2ec6799331c0","name":"set SunState flow state","func":"flow.set(\"SunState\",msg.payload);\nreturn msg;","outputs":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":250,"y":40,"wires":[]},{"id":"9bb6e814743bac46","type":"server-state-changed","z":"07af2ec6799331c0","d":true,"name":"lux Upstairs Strip","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"luxUpstairs","propertyType":"flow","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.cl_multisensor_luminance","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"gt","output_only_on_state_change":true,"x":100,"y":380,"wires":[["0d0d1b58ae06f8db"]]},{"id":"bf334b7a028b8be0","type":"switch","z":"07af2ec6799331c0","name":"under 18k lux\\n over 18k lux","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"18000","vt":"num"},{"t":"gte","v":"18000","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":340,"y":380,"wires":[["76db963da74b0a37","fb1dd97ee8738161"],["91295ea717699d68"]]},{"id":"0d0d1b58ae06f8db","type":"function","z":"07af2ec6799331c0","name":"if SunState flow=1","func":"if ( flow.get(\"SunState\")===1 ) return msg;\n\n//flow.set(\"SunState\",msg.payload);\n//return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":210,"y":460,"wires":[["bf334b7a028b8be0"]]},{"id":"c4b512b5068d3d57","type":"server-state-changed","z":"07af2ec6799331c0","d":true,"name":"temp T","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"tempT","propertyType":"flow","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.temperature_04","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"gt","output_only_on_state_change":true,"x":70,"y":520,"wires":[[]]},{"id":"6734135091fea4f3","type":"server-state-changed","z":"07af2ec6799331c0","d":true,"name":"hum T","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"humT","propertyType":"flow","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.humidity_04","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"gt","output_only_on_state_change":true,"x":70,"y":580,"wires":[[]]},{"id":"f9146052f528a68a","type":"function","z":"07af2ec6799331c0","name":"build cam T command","func":"var vpd = flow.get(\"vpdT\") ? flow.get(\"vpdT\") : \"\";\nvar hum = flow.get(\"humT\") ? flow.get(\"humT\") : \"\";\nvar temp = flow.get(\"tempT\") ? flow.get(\"tempT\") : \"\";\n\n\nvar display = `V=${vpd} T=${temp} H=${hum}`;\n\nif (!flow.get(\"prevDisplay\") || display !== flow.get(\"prevDisplay\")) {\n    flow.set(\"prevDisplay\", display);\n\n    msg.payload = {display:display, enabe:1, name:\"T\"};\n\n    return msg;\n}\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":320,"y":680,"wires":[["a139d229792125f1","97b753acf9faf977"]]},{"id":"04f21a0ba3fc9e3d","type":"inject","z":"07af2ec6799331c0","d":true,"name":"every 1 minute","props":[{"p":"payload"}],"repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":740,"wires":[["f9146052f528a68a"]]},{"id":"97b753acf9faf977","type":"function","z":"07af2ec6799331c0","name":"if SunState flow=1","func":"if ( flow.get(\"SunState\")===1 ) return msg;\n\n//flow.set(\"SunState\",msg.payload);\n//return msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":620,"wires":[["631818460f577fc8"]]},{"id":"631818460f577fc8","type":"http request","z":"07af2ec6799331c0","name":"Camera Command","method":"GET","ret":"txt","paytoqs":"query","url":"http://192.168.1.48:3000/cam","tls":"","persist":false,"proxy":"","authType":"","senderr":false,"x":710,"y":680,"wires":[[]]},{"id":"a139d229792125f1","type":"debug","z":"07af2ec6799331c0","name":"cam command T","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":550,"y":760,"wires":[]},{"id":"fb1dd97ee8738161","type":"function","z":"07af2ec6799331c0","name":"temp < 81\\n temp > 81","func":"if ( !flow.get(\"tempUpstairs\") || flow.get(\"tempUpstairs\") < 81.0 )  \n{\n    return [msg, null];\n} else {\n    return [null, msg];\n}","outputs":2,"noerr":0,"initialize":"","finalize":"","libs":[],"x":350,"y":300,"wires":[["76db963da74b0a37"],["91295ea717699d68"]]},{"id":"f13e09f2eb429de7","type":"sunrise","z":"07af2ec6799331c0","d":true,"name":"3hrs before sunrise to 15min after sunset","lat":"38.810937","lon":"-77.155829","start":"sunrise","end":"sunset","soff":"-180","eoff":"15","x":180,"y":920,"wires":[[],["d768a64e6db83f4c"]]},{"id":"a291117436343e47","type":"api-current-state","z":"07af2ec6799331c0","name":"if cam is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.power_12","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":570,"y":920,"wires":[["555aee8b40a6da3c"],[]]},{"id":"555aee8b40a6da3c","type":"api-call-service","z":"07af2ec6799331c0","name":"turn cam on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.power_12"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":630,"y":980,"wires":[[]]},{"id":"87ced13bfe89688b","type":"api-current-state","z":"07af2ec6799331c0","name":"if cam is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.power_12","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":570,"y":1040,"wires":[["900869151eaec9e4"],[]]},{"id":"900869151eaec9e4","type":"api-call-service","z":"07af2ec6799331c0","name":"turn cam off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.power_12"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":630,"y":1100,"wires":[[]]},{"id":"d768a64e6db83f4c","type":"switch","z":"07af2ec6799331c0","name":"1 = day\\n 0 = night","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":420,"y":980,"wires":[["a291117436343e47"],["87ced13bfe89688b"]]},{"id":"3631b1f8caee4a09","type":"server-state-changed","z":"07af2ec6799331c0","d":true,"name":"VPD T","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"vpdT","propertyType":"flow","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.vpd_04","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"gt","output_only_on_state_change":true,"x":70,"y":640,"wires":[[]]},{"id":"19a9b46ea1dcd796","type":"openweathermap","z":"8f28e16ad32e533f","name":"weather","wtype":"current","lon":"-77.155770","lat":"38.810810","city":"","country":"","language":"en","x":260,"y":180,"wires":[["0a0c054d8c1dd3ba"]]},{"id":"7c407194714a92ef","type":"inject","z":"8f28e16ad32e533f","d":true,"name":"10:10am","props":[{"p":"payload"}],"repeat":"","crontab":"10 10 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":40,"wires":[["8a1729c3d9249aa4"]]},{"id":"0a0c054d8c1dd3ba","type":"function","z":"8f28e16ad32e533f","name":"Clear Skies\\n Cloudy\\n Rainy/Cold","func":"//VALIDATE WEATHER RESULTS\nlet obj = msg.payload;\nif (!obj || !obj.weather || !obj.tempc)\n    return;\nlet weather = obj.weather;\nlet celcius = obj.tempc;\n\n//DON'T RUN IF IN 30's\nif (celcius < 4.0)\n    return;\n\n//DON'T RUN IF RAINY\nif (weather === \"Thunderstorm\")\n    return [null, null, msg];\n\nif (weather === \"Drizzle\")\n    return [null, null, msg];\n\nif (weather === \"Rain\")\n    return [null, null, msg];\n\nif (weather === \"Snow\")\n    return [null, null, msg];\n\n\n//RUN IF CLEAR OR CLOUDY\nif (weather === \"Clear\")\n    return [msg, null, null];\nelse\n    return [null, msg, null];\n","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":180,"wires":[["97d30adb0cfe5ed0"],["3076d3c46fc2c7ae"],[]]},{"id":"97d30adb0cfe5ed0","type":"api-current-state","z":"8f28e16ad32e533f","name":"if Pump 1 is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.pump1_23","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":640,"y":80,"wires":[["60afec92bceb2682"],[]]},{"id":"60afec92bceb2682","type":"api-call-service","z":"8f28e16ad32e533f","name":"turn Start Pump 1 on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.start_fill_1"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":80,"wires":[["48c3a1eed712d9b7"]]},{"id":"48c3a1eed712d9b7","type":"delay","z":"8f28e16ad32e533f","d":true,"name":"","pauseType":"delay","timeout":"11","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":670,"y":140,"wires":[["fae1ddd930a5972d"]]},{"id":"fae1ddd930a5972d","type":"api-call-service","z":"8f28e16ad32e533f","d":true,"name":"turn Start Pump 1 off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.start_fill_1"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":860,"y":140,"wires":[[]]},{"id":"3076d3c46fc2c7ae","type":"api-current-state","z":"8f28e16ad32e533f","name":"if Pump 1 is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.pump1_23","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":640,"y":200,"wires":[["bfb94da194cf056a"],[]]},{"id":"bfb94da194cf056a","type":"api-call-service","z":"8f28e16ad32e533f","name":"turn Start Pump 1 on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.start_fill_1"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":200,"wires":[["9c4bf27c8b407cb3"]]},{"id":"9c4bf27c8b407cb3","type":"delay","z":"8f28e16ad32e533f","d":true,"name":"","pauseType":"delay","timeout":"4","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":660,"y":260,"wires":[["b62205faeafe659f"]]},{"id":"b62205faeafe659f","type":"api-call-service","z":"8f28e16ad32e533f","d":true,"name":"turn Start Pump 1 off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.start_fill_1"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":860,"y":260,"wires":[[]]},{"id":"dcbe32de6e41ab3d","type":"inject","z":"8f28e16ad32e533f","name":"test","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":70,"y":180,"wires":[["8a1729c3d9249aa4"]]},{"id":"8a1729c3d9249aa4","type":"function","z":"8f28e16ad32e533f","name":"Driveway and Shed-side\\n APRIL 15th through OCTOBER 15th","func":"//ONLY RUN APRIL 15th THROUGH OCTOBER 15th\nconst d = new Date();\nlet month = (d.getMonth() + 1);\nlet day = d.getDate();\n\nif (month == 4 && day < 15)\n    return;\n\nif (month < 4 || month > 10)\n    return;\n\nif (month == 10 && day > 15)\n    return;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":210,"y":120,"wires":[["19a9b46ea1dcd796"]]},{"id":"cc6bf208eda6fd41","type":"inject","z":"8f28e16ad32e533f","name":"10am cut off","props":[{"p":"payload"}],"repeat":"","crontab":"00 10 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":320,"wires":[["e25cb856d99d51d4"]]},{"id":"e25cb856d99d51d4","type":"api-current-state","z":"8f28e16ad32e533f","name":"if Pump 1 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.pump1_23","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":280,"y":340,"wires":[["07e66da027894ee6"],[]]},{"id":"07e66da027894ee6","type":"api-call-service","z":"8f28e16ad32e533f","name":"turn Pump 1 off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.pump1_23"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":460,"y":340,"wires":[[]]},{"id":"26989f7d8f5ba90c","type":"openweathermap","z":"8f28e16ad32e533f","name":"weather","wtype":"current","lon":"-77.155770","lat":"38.810810","city":"","country":"","language":"en","x":260,"y":580,"wires":[["e16ff77ae0208924"]]},{"id":"8f1a7acc95a61e13","type":"inject","z":"8f28e16ad32e533f","name":"2:30pm","props":[{"p":"payload"}],"repeat":"","crontab":"30 14 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":460,"wires":[["eeaf2f43d127efb6"]]},{"id":"e16ff77ae0208924","type":"function","z":"8f28e16ad32e533f","name":"Clear Skies\\n Cloudy\\n Rainy/Cold","func":"//VALIDATE WEATHER RESULTS\nlet obj = msg.payload;\nif (!obj || !obj.weather || !obj.tempc)\n    return;\nlet weather = obj.weather;\nlet celcius = obj.tempc;\n\n//DON'T RUN IF IN 30's\nif (celcius < 4.0)\n    return;\n\n//DON'T RUN IF RAINY\nif (weather === \"Thunderstorm\")\n    return [null, null, msg];\n\nif (weather === \"Drizzle\")\n    return [null, null, msg];\n\nif (weather === \"Rain\")\n    return [null, null, msg];\n\nif (weather === \"Snow\")\n    return [null, null, msg];\n\n\n//RUN IF CLEAR OR CLOUDY\nif (weather === \"Clear\")\n    return [msg, null, null];\nelse\n    return [null, msg, null];\n","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":580,"wires":[["b48740e52a33c611"],["a36e83760998fcdf"],[]]},{"id":"b48740e52a33c611","type":"api-current-state","z":"8f28e16ad32e533f","name":"if Pump 2 is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.pump2_23","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":640,"y":480,"wires":[["3b246818d8dfe819"],[]]},{"id":"3b246818d8dfe819","type":"api-call-service","z":"8f28e16ad32e533f","name":"turn Start Pump 2 on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.start_fill_2"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":480,"wires":[["1aba62d88f0344f2"]]},{"id":"1aba62d88f0344f2","type":"delay","z":"8f28e16ad32e533f","d":true,"name":"","pauseType":"delay","timeout":"11","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":670,"y":540,"wires":[["c55c8135df370245"]]},{"id":"c55c8135df370245","type":"api-call-service","z":"8f28e16ad32e533f","d":true,"name":"turn Start Pump 2 off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.start_fill_2"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":860,"y":540,"wires":[[]]},{"id":"a36e83760998fcdf","type":"api-current-state","z":"8f28e16ad32e533f","name":"if Pump 2 is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.pump2_23","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":640,"y":600,"wires":[["165f5c93bdea0602"],[]]},{"id":"165f5c93bdea0602","type":"api-call-service","z":"8f28e16ad32e533f","name":"turn Start Pump 2 on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.start_fill_2"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":600,"wires":[["cf39b4ec670de0bb"]]},{"id":"cf39b4ec670de0bb","type":"delay","z":"8f28e16ad32e533f","d":true,"name":"","pauseType":"delay","timeout":"4","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":660,"y":660,"wires":[["b47b817fe6b1dbad"]]},{"id":"b47b817fe6b1dbad","type":"api-call-service","z":"8f28e16ad32e533f","d":true,"name":"turn Start Pump 2 off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.start_fill_2"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":860,"y":660,"wires":[[]]},{"id":"30ce49b112d3f436","type":"inject","z":"8f28e16ad32e533f","name":"test","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":70,"y":580,"wires":[["eeaf2f43d127efb6"]]},{"id":"eeaf2f43d127efb6","type":"function","z":"8f28e16ad32e533f","name":"Front Yard\\n APRIL 15th through OCTOBER 15th","func":"//ONLY RUN APRIL 15th THROUGH OCTOBER 15th\nconst d = new Date();\nlet month = (d.getMonth() + 1);\nlet day = d.getDate();\n\nif (month == 4 && day < 15)\n    return;\n\nif (month < 4 || month > 10)\n    return;\n\nif (month == 10 && day > 15)\n    return;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":210,"y":520,"wires":[["26989f7d8f5ba90c"]]},{"id":"b62be04443605483","type":"inject","z":"8f28e16ad32e533f","name":"3pm cut off","props":[{"p":"payload"}],"repeat":"","crontab":"00 15 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":90,"y":760,"wires":[["6203e8b37166327b"]]},{"id":"6203e8b37166327b","type":"api-current-state","z":"8f28e16ad32e533f","name":"if Pump 2 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.pump2_23","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":280,"y":760,"wires":[["aeb1f1224a881499"],[]]},{"id":"aeb1f1224a881499","type":"api-call-service","z":"8f28e16ad32e533f","name":"turn Pump 2 off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.pump2_23"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":460,"y":760,"wires":[[]]},{"id":"802cc4ccef31becc","type":"inject","z":"8f28e16ad32e533f","name":"every minute","props":[{"p":"payload"}],"repeat":"60","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":1280,"wires":[["13a10c613e230893"]]},{"id":"13a10c613e230893","type":"api-current-state","z":"8f28e16ad32e533f","name":"if Pump 4 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.pump4_23","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":280,"y":1280,"wires":[["09461088dcbe5145"],[]]},{"id":"09461088dcbe5145","type":"api-current-state","z":"8f28e16ad32e533f","name":"if res above 99.9%","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"99.9","halt_if_type":"num","halt_if_compare":"gt","entity_id":"sensor.ultrasonic_sensor_20","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":490,"y":1280,"wires":[["a5a45e7a42c124a8","6a42471cafd0f05b"],[]]},{"id":"a5a45e7a42c124a8","type":"api-call-service","z":"8f28e16ad32e533f","name":"turn Fill Pump 4 off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.start_fill_4"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":710,"y":1280,"wires":[[]]},{"id":"6a42471cafd0f05b","type":"delay","z":"8f28e16ad32e533f","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":680,"y":1340,"wires":[["def43f3e44bfc1a9"]]},{"id":"886453aa6990e0ee","type":"api-call-service","z":"8f28e16ad32e533f","name":"turn Pump 4 off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.pump4_23"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":940,"y":1280,"wires":[[]]},{"id":"def43f3e44bfc1a9","type":"api-current-state","z":"8f28e16ad32e533f","name":"double-check if Pump 4 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.pump4_23","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":890,"y":1340,"wires":[["886453aa6990e0ee"],[]]},{"id":"659360673e436d6c","type":"openweathermap","z":"8f28e16ad32e533f","name":"weather","wtype":"current","lon":"-77.155770","lat":"38.810810","city":"","country":"","language":"en","x":260,"y":1000,"wires":[["bb5da358064a41e2"]]},{"id":"1620a5e2f469188a","type":"inject","z":"8f28e16ad32e533f","d":true,"name":"12:30pm","props":[{"p":"payload"}],"repeat":"","crontab":"30 12 * * 1,3,5,6","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":880,"wires":[["3a46cc97bc846201"]]},{"id":"bb5da358064a41e2","type":"function","z":"8f28e16ad32e533f","name":"Clear Skies\\n Cloudy\\n Rainy/Cold","func":"//VALIDATE WEATHER RESULTS\nlet obj = msg.payload;\nif (!obj || !obj.weather || !obj.tempc)\n    return;\nlet weather = obj.weather;\nlet celcius = obj.tempc;\n\n//DON'T RUN IF IN 30's\nif (celcius < 4.0)\n    return;\n\n//DON'T RUN IF RAINY\nif (weather === \"Thunderstorm\")\n    return [null, null, msg];\n\nif (weather === \"Drizzle\")\n    return [null, null, msg];\n\nif (weather === \"Rain\")\n    return [null, null, msg];\n\nif (weather === \"Snow\")\n    return [null, null, msg];\n\n\n//RUN IF CLEAR OR CLOUDY\nif (weather === \"Clear\")\n    return [msg, null, null];\nelse\n    return [null, msg, null];\n","outputs":3,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":1000,"wires":[["5784d663521ca89c"],["caf92de8e26cb68f"],[]]},{"id":"5784d663521ca89c","type":"api-current-state","z":"8f28e16ad32e533f","name":"if Pump 3 is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.pump3_23","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":640,"y":900,"wires":[["79f55eb0eaa73c0a"],[]]},{"id":"79f55eb0eaa73c0a","type":"api-call-service","z":"8f28e16ad32e533f","name":"turn Start Pump 3 on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.start_fill_3"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":900,"wires":[["012409680afd71f6"]]},{"id":"012409680afd71f6","type":"delay","z":"8f28e16ad32e533f","d":true,"name":"","pauseType":"delay","timeout":"11","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":670,"y":960,"wires":[["37c0eb41119890f5"]]},{"id":"37c0eb41119890f5","type":"api-call-service","z":"8f28e16ad32e533f","d":true,"name":"turn Pump 3 off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.start_fill_3"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":960,"wires":[[]]},{"id":"caf92de8e26cb68f","type":"api-current-state","z":"8f28e16ad32e533f","name":"if Pump 3 is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.pump3_23","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":640,"y":1020,"wires":[["56ef1946a2c17dd1"],[]]},{"id":"56ef1946a2c17dd1","type":"api-call-service","z":"8f28e16ad32e533f","name":"turn Start Pump 3 on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.start_fill_3"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":840,"y":1020,"wires":[["89c562d3ef044a58"]]},{"id":"89c562d3ef044a58","type":"delay","z":"8f28e16ad32e533f","d":true,"name":"","pauseType":"delay","timeout":"4","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":660,"y":1080,"wires":[["dc265a075202b3d8"]]},{"id":"dc265a075202b3d8","type":"api-call-service","z":"8f28e16ad32e533f","d":true,"name":"turn Start Pump 3 off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.start_fill_3"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":860,"y":1080,"wires":[[]]},{"id":"dd4e9dbcd4c00780","type":"inject","z":"8f28e16ad32e533f","name":"test","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":70,"y":1000,"wires":[["3a46cc97bc846201"]]},{"id":"3a46cc97bc846201","type":"function","z":"8f28e16ad32e533f","name":"Upper Deck\\n APRIL 15th through OCTOBER 15th","func":"//ONLY RUN APRIL 15th THROUGH OCTOBER 15th\nconst d = new Date();\nlet month = (d.getMonth() + 1);\nlet day = d.getDate();\n\nif (month == 4 && day < 15)\n    return;\n\nif (month < 4 || month > 10)\n    return;\n\nif (month == 10 && day > 15)\n    return;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":210,"y":940,"wires":[["659360673e436d6c"]]},{"id":"a6e28786f1c7eb53","type":"inject","z":"8f28e16ad32e533f","name":"3pm cut off","props":[{"p":"payload"}],"repeat":"","crontab":"00 15 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":90,"y":1180,"wires":[["c827fceca0e83b2e"]]},{"id":"c827fceca0e83b2e","type":"api-current-state","z":"8f28e16ad32e533f","name":"if Pump 3 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.pump3_23","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":280,"y":1160,"wires":[["ce51d98a28ef7d92"],[]]},{"id":"ce51d98a28ef7d92","type":"api-call-service","z":"8f28e16ad32e533f","name":"turn Pump 3 off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.pump3_23"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":460,"y":1160,"wires":[[]]},{"id":"57e37d442a996dbf","type":"inject","z":"8f28e16ad32e533f","d":true,"name":"9:30am","props":[{"p":"payload"}],"repeat":"","crontab":"30 09 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":40,"wires":[["8a1729c3d9249aa4"]]},{"id":"323fa99315b63b89","type":"inject","z":"8f28e16ad32e533f","name":"10:40am cut off","props":[{"p":"payload"}],"repeat":"","crontab":"40 10 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":100,"y":360,"wires":[["e25cb856d99d51d4"]]},{"id":"beb908b7e0371345","type":"inject","z":"8f28e16ad32e533f","name":"2:45pm","props":[{"p":"payload"}],"repeat":"","crontab":"45 14 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":280,"y":880,"wires":[["3a46cc97bc846201"]]},{"id":"7ed90a3389f14ced","type":"inject","z":"8f28e16ad32e533f","name":"1pm cut off","props":[{"p":"payload"}],"repeat":"","crontab":"00 13 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":90,"y":1140,"wires":[["c827fceca0e83b2e"]]},{"id":"00cb00c3232f71f9","type":"server-state-changed","z":"8f28e16ad32e533f","name":"leak sensor 3","server":"1b7e4fe1.0da8e","version":5,"outputs":2,"exposeAsEntityConfig":"","entityId":"binary_sensor.leak_sensor_3_leak","entityIdType":"exact","outputInitially":false,"stateType":"habool","ifState":"true","ifStateType":"bool","ifStateOperator":"is","outputOnlyOnStateChange":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"},{"property":"leakAlert","propertyType":"flow","value":"Sensor 3","valueType":"str"}],"x":90,"y":1720,"wires":[["8cee702f3ed92608","c409e338b267bf7e","196cb02d7e14b3f3"],[]]},{"id":"19caa28ef2ea384e","type":"server-state-changed","z":"8f28e16ad32e533f","name":"leak sensor 2","server":"1b7e4fe1.0da8e","version":5,"outputs":2,"exposeAsEntityConfig":"","entityId":"binary_sensor.leak_sensor_2_leak","entityIdType":"exact","outputInitially":false,"stateType":"habool","ifState":"true","ifStateType":"bool","ifStateOperator":"is","outputOnlyOnStateChange":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"},{"property":"leakAlert","propertyType":"flow","value":"Sensor 2","valueType":"str"}],"x":90,"y":1580,"wires":[["c409e338b267bf7e","8cee702f3ed92608","196cb02d7e14b3f3"],[]]},{"id":"e5fb07c3e01f8a95","type":"server-state-changed","z":"8f28e16ad32e533f","name":"leak sensor 1","server":"1b7e4fe1.0da8e","version":5,"outputs":2,"exposeAsEntityConfig":"","entityId":"binary_sensor.leak_sensor_1_leak","entityIdType":"exact","outputInitially":false,"stateType":"habool","ifState":"true","ifStateType":"bool","ifStateOperator":"is","outputOnlyOnStateChange":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"},{"property":"leakAlert","propertyType":"flow","value":"Sensor 1","valueType":"str"}],"x":90,"y":1520,"wires":[["c409e338b267bf7e","8cee702f3ed92608","196cb02d7e14b3f3"],[]]},{"id":"f16e4a5c0f5f0961","type":"api-call-service","z":"8f28e16ad32e533f","name":"turn Start Fill 4 off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.start_fill_4"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":590,"y":1700,"wires":[[]]},{"id":"8cee702f3ed92608","type":"api-current-state","z":"8f28e16ad32e533f","name":"if Start Fill 4 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.start_fill_4","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":370,"y":1700,"wires":[["f16e4a5c0f5f0961","3daad01cf8ba0e9a"],[]]},{"id":"8b9241b3c85616a1","type":"api-call-service","z":"8f28e16ad32e533f","name":"turn valves_enabled off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.valves_enabled"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":610,"y":1480,"wires":[[]]},{"id":"c409e338b267bf7e","type":"api-current-state","z":"8f28e16ad32e533f","name":"if valves_enabled is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.valves_enabled","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":360,"y":1480,"wires":[["8b9241b3c85616a1","559968d3b8ad2357"],[]]},{"id":"03573f20d586d345","type":"debug","z":"8f28e16ad32e533f","name":"switch.valves_enabled","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":740,"y":1340,"wires":[]},{"id":"559968d3b8ad2357","type":"function","z":"8f28e16ad32e533f","name":"Just Disabled CL Valves","func":"//msg.payload = `GC Ebox3 Dry: ${msg.payload}`;\n\nmsg.payload = `Just Disabled CL Valves!!`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":610,"y":1420,"wires":[["83e573caae467da8"]]},{"id":"83e573caae467da8","type":"subflow:71a3fd81.9edc14","z":"8f28e16ad32e533f","name":"","x":870,"y":1420,"wires":[]},{"id":"3daad01cf8ba0e9a","type":"function","z":"8f28e16ad32e533f","name":"JUST STOPPED FILLING 40g RESERVOIR","func":"//msg.payload = `GC Ebox3 Dry: ${msg.payload}`;\n\nmsg.payload = `JUST STOPPED FILLING 40g RESERVOIR!!`;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":670,"y":1760,"wires":[["f30fae79d2265d0c"]]},{"id":"f30fae79d2265d0c","type":"subflow:71a3fd81.9edc14","z":"8f28e16ad32e533f","name":"","x":990,"y":1760,"wires":[]},{"id":"98161ba57b0a6b84","type":"server-state-changed","z":"8f28e16ad32e533f","name":"leak sensor 4","server":"1b7e4fe1.0da8e","version":5,"outputs":2,"exposeAsEntityConfig":"","entityId":"binary_sensor.leak_sensor_4_leak","entityIdType":"exact","outputInitially":false,"stateType":"habool","ifState":"true","ifStateType":"bool","ifStateOperator":"is","outputOnlyOnStateChange":true,"for":"0","forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"eventData"},{"property":"topic","propertyType":"msg","value":"","valueType":"triggerId"},{"property":"leakAlert","propertyType":"flow","value":"Sensor 4","valueType":"str"}],"x":90,"y":1640,"wires":[["c409e338b267bf7e","8cee702f3ed92608","196cb02d7e14b3f3"],[]]},{"id":"8e5c5afb3a585a7e","type":"inject","z":"8f28e16ad32e533f","name":"10:10am","props":[{"p":"payload"}],"repeat":"","crontab":"10 10 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":80,"y":420,"wires":[["eeaf2f43d127efb6"]]},{"id":"196cb02d7e14b3f3","type":"function","z":"8f28e16ad32e533f","name":"Leak Alert","func":"var display = `${flow.get(\"leakAlert\")} Leak Alert`;\n\n//msg.payload = `GC Ebox3 Dry: ${msg.payload}`;\n\nmsg.payload = display; //`Just Disabled CL Valves!!`;\n\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":1560,"wires":[["37be257f17863a3b"]]},{"id":"37be257f17863a3b","type":"subflow:71a3fd81.9edc14","z":"8f28e16ad32e533f","name":"","x":630,"y":1560,"wires":[]},{"id":"c14f3d0c72c6958a","type":"server-state-changed","z":"67dec13f44640a5d","d":true,"name":"Compost Temperature","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.multisensor_6_air_temperature","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","output_only_on_state_change":true,"x":140,"y":180,"wires":[["8ca0ed2333816dda"]]},{"id":"f67cd6945c82d35c","type":"debug","z":"67dec13f44640a5d","name":"above 65","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":500,"y":100,"wires":[]},{"id":"8ca0ed2333816dda","type":"switch","z":"67dec13f44640a5d","name":"if temp is \\n above 55.0 \\n below 55.0","property":"payload","propertyType":"msg","rules":[{"t":"gte","v":"55.0","vt":"num"},{"t":"lt","v":"55.0","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":180,"wires":[["f67cd6945c82d35c","c3dc063abaa227e6"],["388146ed5aa0a52b","c7588f18bc6c5132"]]},{"id":"388146ed5aa0a52b","type":"debug","z":"67dec13f44640a5d","name":"below 65","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":500,"y":280,"wires":[]},{"id":"c7588f18bc6c5132","type":"api-current-state","z":"67dec13f44640a5d","name":"If h.pad is Off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.power_12","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":560,"y":220,"wires":[["67fc69f58a985a0c"],[]]},{"id":"67fc69f58a985a0c","type":"api-call-service","z":"67dec13f44640a5d","name":"Turn h.pad On","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.power_12"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":780,"y":220,"wires":[[]]},{"id":"c3dc063abaa227e6","type":"api-current-state","z":"67dec13f44640a5d","name":"If h.pad is On","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.power_12","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":560,"y":160,"wires":[["afe867d46d5bbb5e"],[]]},{"id":"afe867d46d5bbb5e","type":"api-call-service","z":"67dec13f44640a5d","name":"Turn h.pad Off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.power_12"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":780,"y":160,"wires":[[]]},{"id":"a87d7bc7fce26cbb","type":"api-call-service","z":"c28a0ad8463b1d59","name":"set switch sonoff 4 off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.switch_sonoff_04"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":420,"y":700,"wires":[[]]},{"id":"1dc801730a567f64","type":"api-call-service","z":"c28a0ad8463b1d59","name":"set swith sonoff 4 on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":true,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.switch_sonoff_04"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","output_location":"","output_location_type":"none","x":420,"y":580,"wires":[[]]},{"id":"4e56ae3c30aebde8","type":"api-current-state","z":"c28a0ad8463b1d59","name":"if switch sonoff 4 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_04","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":380,"y":640,"wires":[["a87d7bc7fce26cbb"],[]]},{"id":"3eb446dbd29313e9","type":"api-current-state","z":"c28a0ad8463b1d59","name":"if switch sonoff 4 is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_04","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":380,"y":520,"wires":[["1dc801730a567f64"],[]]},{"id":"5c0614528ee054df","type":"inject","z":"c28a0ad8463b1d59","d":true,"name":"4am - Turn On","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 04 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":520,"wires":[["3eb446dbd29313e9"]]},{"id":"110c1c21065d7ced","type":"inject","z":"c28a0ad8463b1d59","d":true,"name":"10pm Turn Off","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"00 22 * * *","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":140,"y":640,"wires":[["4e56ae3c30aebde8"]]},{"id":"56c009aae69c69b3","type":"server-state-changed","z":"c28a0ad8463b1d59","name":"vpd_30 in Basement T","server":"1b7e4fe1.0da8e","version":4,"outputs":1,"for":0,"forType":"num","forUnits":"minutes","ignorePrevStateNull":false,"ignorePrevStateUnknown":false,"ignorePrevStateUnavailable":false,"ignoreCurrentStateUnknown":false,"ignoreCurrentStateUnavailable":false,"outputProperties":[{"property":"VPD_30","propertyType":"flow","value":"","valueType":"entityState"}],"exposeToHomeAssistant":false,"haConfig":[{"property":"name","value":""},{"property":"icon","value":""}],"entityidfilter":"sensor.vpd_30","entityidfiltertype":"exact","outputinitially":false,"state_type":"num","haltifstate":"","halt_if_type":"num","halt_if_compare":"lt","output_only_on_state_change":true,"x":120,"y":160,"wires":[["114b11333841165f","4b72b587dcb63b7e"]]},{"id":"a5db291985ac2c15","type":"switch","z":"c28a0ad8463b1d59","name":"if VPD is under 1.1 \\n over 1.1","property":"VPD_30","propertyType":"flow","rules":[{"t":"lt","v":"1.1","vt":"num"},{"t":"gte","v":"1.1","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":290,"y":40,"wires":[["1607bc625422786f"],["1192d2d357be0e17"]]},{"id":"1192d2d357be0e17","type":"api-current-state","z":"c28a0ad8463b1d59","name":"if temp30 above 79.0","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"79.0","halt_if_type":"num","halt_if_compare":"gt","entity_id":"sensor.temperature30","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":420,"y":140,"wires":[["1607bc625422786f"],["0f9b1619332e0d22"]]},{"id":"1607bc625422786f","type":"api-current-state","z":"c28a0ad8463b1d59","name":"if Fan is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_06","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":770,"y":60,"wires":[["377e6224d0281749"],[]]},{"id":"377e6224d0281749","type":"api-call-service","z":"c28a0ad8463b1d59","name":"turn Fan on","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.switch_sonoff_06"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":830,"y":120,"wires":[[]]},{"id":"eca467f10c71054b","type":"api-current-state","z":"c28a0ad8463b1d59","name":"if Fan is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_06","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":770,"y":180,"wires":[["10c3818ce3cc0c43"],[]]},{"id":"10c3818ce3cc0c43","type":"api-call-service","z":"c28a0ad8463b1d59","name":"turn Fan off","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.switch_sonoff_06"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":830,"y":220,"wires":[[]]},{"id":"6e15b64af382c4f7","type":"api-current-state","z":"c28a0ad8463b1d59","name":"if sonoff 1 humidifier is off","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"off","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_01","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":750,"y":300,"wires":[["9a0127b9e524aaee"],[]]},{"id":"9a0127b9e524aaee","type":"api-call-service","z":"c28a0ad8463b1d59","name":"turn on humidifier","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_on","areaId":[],"deviceId":[],"entityId":["switch.switch_sonoff_01"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":300,"wires":[[]]},{"id":"8038919845ea3c81","type":"api-current-state","z":"c28a0ad8463b1d59","name":"if sonoff 1 humidifier is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_01","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":750,"y":400,"wires":[["5f0468d19c1a1ff7"],[]]},{"id":"5f0468d19c1a1ff7","type":"api-call-service","z":"c28a0ad8463b1d59","name":"turn off humidifier","server":"1b7e4fe1.0da8e","version":5,"debugenabled":false,"domain":"switch","service":"turn_off","areaId":[],"deviceId":[],"entityId":["switch.switch_sonoff_01"],"data":"","dataType":"json","mergeContext":"","mustacheAltTags":false,"outputProperties":[],"queue":"none","x":990,"y":400,"wires":[[]]},{"id":"5d3edf59ed3d4b2b","type":"api-current-state","z":"c28a0ad8463b1d59","name":"If basement t light_04 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_04","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":500,"y":320,"wires":[["6e15b64af382c4f7"],["8038919845ea3c81"]]},{"id":"0d7c1a6a1d0f45dc","type":"switch","z":"c28a0ad8463b1d59","name":"if VPD is over 1.65 \\n under 1.65","property":"VPD_30","propertyType":"flow","rules":[{"t":"gt","v":"1.65","vt":"num"},{"t":"lte","v":"1.65","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":190,"y":300,"wires":[["5d3edf59ed3d4b2b"],["8038919845ea3c81"]]},{"id":"4b72b587dcb63b7e","type":"api-current-state","z":"c28a0ad8463b1d59","name":"if BT FL is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_08","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":130,"y":100,"wires":[["a5db291985ac2c15"],[]]},{"id":"114b11333841165f","type":"api-current-state","z":"c28a0ad8463b1d59","name":"if BT FL is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_08","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"},{"property":"data","propertyType":"msg","value":"","valueType":"entity"}],"for":0,"forType":"num","forUnits":"minutes","x":150,"y":220,"wires":[["0d7c1a6a1d0f45dc"],[]]},{"id":"6bac8f90c7d161c9","type":"api-current-state","z":"c28a0ad8463b1d59","name":"if hum30 above 55.0","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"55.0","halt_if_type":"num","halt_if_compare":"gt","entity_id":"sensor.humidity30","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","override_topic":false,"state_location":"payload","override_payload":"msg","entity_location":"data","override_data":"msg","x":420,"y":260,"wires":[["1607bc625422786f"],["eca467f10c71054b"]]},{"id":"0f9b1619332e0d22","type":"api-current-state","z":"c28a0ad8463b1d59","name":"If basement t light_04 is on","server":"1b7e4fe1.0da8e","version":3,"outputs":2,"halt_if":"on","halt_if_type":"str","halt_if_compare":"is","entity_id":"switch.switch_sonoff_04","state_type":"str","blockInputOverrides":false,"outputProperties":[{"property":"payload","propertyType":"msg","value":"","valueType":"entityState"}],"for":0,"forType":"num","forUnits":"minutes","x":440,"y":200,"wires":[["eca467f10c71054b"],["6bac8f90c7d161c9"]]}]